Added ` badgeColor ` typing for ` OptionsBottomTab ` __EoT__
[ V2 ] sideMenu options not available/do n't work __EoT__ https : //github.com/wix/react-native-navigation/pull/4105 broke a few ` sideMenu ` options . It looks like ` shouldStretchDrawer ` and ` animationVelocity ` have been elevated to ` sideMenuOptions ` ( both left and right get the same value ) , not ` sideMenuSideOptions ` ( left or right controlled ) . Is this the new method for settings these ? ` animationType ` is available but does not seem wired in . -- - # # # Environment * React Native Navigation version : 2.0.2583 * React Native version : 0.57.3 * Platform ( s ) ( iOS , Android , or both ? ) : iOS * Device info ( Simulator/Device ? OS version ? Debug/Release ? ) : All
Playground : Add example layout : FlatList __EoT__ Lists are a crucial component to almost every single app out there . This example contains a flatlist inside a bottomTab layout with a sidemenu too ( basically as complicated as a screen can get ) It uses a fake data set with 100 entries .
Expose layout in NavigationActivity __EoT__ Use Case : When exposing the layout , other android code can check what kind of layout it is and react accordingly , fx : `` ` if ( activity.getLayout ( ) instanceof BottomTabsLayout ) { // ... } `` `
Ensure parent options are applied correctly __EoT__
Add link to V2 Documentation __EoT__ Added a header to the sidebar to indicate that this is the V1.1.X documentation and added a link to the V2 docs . I know of at least one other person who waisted a few hours because they did n't realize they were looking at the wrong docs , so I thought that this header and link might be of some use .
Buttons fix __EoT__
Official redux support __EoT__ The people have spoken . Usage example : `` ` js import { Navigation } from 'react-native-navigation ' ; import { Provider } from 'react-redux ' ; import { store } from './store ' ; import PostsList from './posts/screens/PostsList ' ; export function registerScreens ( ) { Navigation.registerComponentWithRedux ( 'blog.PostsList ' , ( ) = > PostsList , Provider , store ) ; } `` `
[ v2 ] topBar missing if searchBar has focus and new route is pushed __EoT__ # # # Issue Description I have following active route : `` ` js topBar : { title : { text : 'Explorer' } , largeTitle : { visible : true } , searchBar : true , } `` ` When I click on the ` searchBar ` and afterwards click onto a item ( invokes a push ) the ` TopBar ` is missing until I swipe back . # # # Steps to Reproduce / Code Snippets / Screenshots Simple Route with ` largeTitle ` and ` searchBar ` . On this route a button with a push action to another route with ` topBar ` title . < img src= '' https : //i.imgur.com/BclLQJe.gif '' height= '' 400 '' / > -- - # # # Environment * React Native Navigation version : 2.0.2377 * React Native version : 0.55.2 * Platform ( s ) ( iOS , Android , or both ? ) : iOS * Device info ( Simulator/Device ? OS version ? Debug/Release ? ) : Simulator and Testflight Release tested
Navigation.showModal with RN Modal showing __EoT__ If a React Native Modal is showing on the screen , trying to use Navigation.showModal ( ) will crash natively with native crashlog `` ` Exception '- [ RCTModalHostViewController getLeafViewController ] : unrecognized selector sent to instance 0x -- -- -- -- ' was thrown while invoking showModal on target RNNBridgeModule with params ... `` ` Environment : * React Native Navigation version : 2.0.2412 * React Native version : 51 * Platform ( s ) ( iOS , Android , or both ? ) : iOS * Device info ( Simulator/Device ? OS version ? Debug/Release ? ) : Simulator iPhone X
Correct minor spelling mistake __EoT__ ` relase ` - > ` release `
Button refactor __EoT__
[ V2 ] Update Android Install Dependencies Docs with Multidex Fix __EoT__ I was unable to compile my android app because I use multidex this line of code forces the multidex library to be version 25.4.0 when the latest for this one is 1.0.3 : `` ` groovy if ( requested.group == 'com.android.support ' ) { details.useVersion `` 25.4.0 '' } `` ` This little fix may save some headches : `` ` groovy if ( requested.group == 'com.android.support ' & & requested.name ! = 'multidex ' ) { details.useVersion `` 25.4.0 '' } ... dependecies { ... implementation 'com.android.support : multidex:1.0.3' implementation `` com.android.support : appcompat-v7:25.4.0 '' implementation 'com.android.support : design:25.4.0' ... } `` `
[ v2 ] SideMenu is overflowing Safe Area __EoT__ < ! -- Please post questions in Stack Overflow under the react-native-navigation tag https : //stackoverflow.com/questions/tagged/react-native-navigation -- > # # # Issue Description Hey , guys . First of all : you are doing a great work here . We all appreciate your effort . I 'm developing a Sidemenu and it 's Safe Area does n't seem to work properly . I tried a lot of margin and RN 's SafeAreaView without any luck : ( It start on the top ( behind the DeviceStatusBar ) and if I swipe a little bit it shows the View correctly . # # # Steps to Reproduce / Code Snippets / Screenshots ! [ jun-22-2018 01-10-08 ] ( https : //user-images.githubusercontent.com/804994/41757606-7f85e95c-75b9-11e8-80f9-543eb191de49.gif ) If you need a sample I can write one , but I think the gif does the job , right ? Thanks for your help . -- - # # # Environment * React Native Navigation version : 2.0.2362 * React Native version : 0.55.4 * Platform ( s ) ( iOS , Android , or both ? ) : iOS * Device info ( Simulator/Device ? OS version ?
[ BREAKING ] Support RN 0.55 __EoT__ This PR introduces two build flavors to support both RN 0.51 and the newer RN 0.55.4 - see documentation for further details . closes # 3317 closes # 3313
Remove broken link in README __EoT__ A similar link would be React Native 's [ navigation guide ] ( https : //facebook.github.io/react-native/docs/0.54/navigation.html ) .
Exposed getUiImplementationProvider for people to override if needed __EoT__ Now allowing a ` UIImplementationProvider ` to be passed by overriding the ` getUIImplementationProvider ` method . Inside ` MainApplication.java ` we can now override : `` ` @ Override protected UIImplementationProvider getUIImplementationProvider ( ) { return CalendarPackage.getCustomUIImplementationProvider ( ) ; // < -- pass a ui implementation provider here. } `` ` And [ here 's the custom UIImplementation provider ] ( https : //gist.github.com/SudoPlz/23ea2dee9772cb39e1e742034cdf8b98 ) we used after all ( for fixing all our https : //github.com/wix/react-native-navigation/issues/2892 # issuecomment-393509428 related issues )
Testing new multi pr job __EoT__
allows you to show a lightbox directly after dismissing on ios __EoT__ Fixes # 462
Modal unmount e2e test __EoT__ Hi , I write a e2e test for the modal 's unmount problem on iOS . I hope this will help you guys Steps to reproduce -- -- -- -- -- -- -- -- -- - Click Show Modal Click Test Modal Lifecycle Click Dismiss didDisappear alert appears componentWillUnmount alert should appear too but event does n't firing Click Test Modal Lifecycle again Previous modal 's componentWillUnmount event triggers ! [ 2018-05-16 11 16 43 ] ( https : //user-images.githubusercontent.com/22980987/40105110-b110ff60-58fa-11e8-9102-d0168b878f2b.gif )
Update docs __EoT__ Outdated onAppLaunched part is changed I just started to a project with v2 and I realized this part of the documentation was wrong . I searched a bit and found this 2 commits : https : //github.com/wix/react-native-navigation/commit/104e3f97fdd80b8510aa03d0a8dc26ced62d11f2 https : //github.com/wix/react-native-navigation/commit/1d2680c5aa5f6577b21516b161df1cc4d930b9c3 So , that part is probably forgotten
Add iPad landscape launch image __EoT__ Add the iPad landscape launch image . Without this you get an ugly stretched portrait image when loading in landscape orientation .
Update import to < React/**.h > __EoT__ Library wont build for me ( cocoapods install ) due to this file not building . The implementation file is all commented out - is this a file we should just remove ?
Pass ActionMenuView as parent to right buttons instead of Toolbar __EoT__ Motivation : When searching for the button 's concrete TextView by label , if the title has the same text as the buttons , both views are returned .
Updated RNNSideMenuController.m __EoT__ on clicking the outside of the sideMenu area sideMenu not closing , because there is a problem in the code which i modified now
Update doc since PR was accepted __EoT__ The following https : //github.com/wix/react-native-navigation/pull/3006 implemented this functionality
Fix custom title bar issues __EoT__ ( 1 ) prevent ` customNavigationTitleView ` / ` customNavigationBarView ` / ` customNavigationComponentBackground ` from being mounted twice when ` viewWillAppear ` is being called in ` RNNRootViewController ` ( 2 ) ` prevent customNavigationTitleView ` / ` customNavigationBarView ` / ` customNavigationComponentBackground ` from being remounted every time the new will appear again .
Fix custom title bar issues __EoT__ ( 1 ) prevent ` customNavigationTitleView ` / ` customNavigationBarView ` / ` customNavigationComponentBackground ` from being mounted twice when ` viewWillAppear ` is being called in ` RNNRootViewController ` ( 2 ) ` prevent customNavigationTitleView ` / ` customNavigationBarView ` / ` customNavigationComponentBackground ` from being remounted every time the new will appear again .
V2 custom component refactor __EoT__ API changes : `` ` js { topBar : { title : { component : { name : 'navigation.playground.CustomTopBar ' , alignment : 'center ' , passProps : { } } } , background : { component : { name : 'navigation.playground.CustomTopBar ' , passProps : { } } } , rightButtons : [ { id : CUSTOM_BUTTON2 , component : { name : 'CustomRoundedButton ' , passProps : { } } } ] } } `` `
Start app __EoT__
Modal anim __EoT__
Refactored shared element transitions __EoT__
Document subtitle parameter for screen push __EoT__
android sdk fix __EoT__
Using largeTitle produces two titles __EoT__ # # # Issue Description I am using the newly introduced ( # 2593 ) option ` largeTitle ` to get the Large Title Bar . Now i get two titles in the title bar the big one ( correct ) the old small one ( not correct ) . # # # Steps to Reproduce / Code Snippets / Screenshots This is how i use the new option . `` ` const appStyle = { largeTitle : true } ; // this will start our app Navigation.startTabBasedApp ( { tabs : tabs , appStyle : appStyle } ) ; `` ` Here a screenshot of how it looks in my app : < img width= '' 405 '' alt= '' bildschirmfoto 2018-01-31 um 21 06 36 '' src= '' https : //user-images.githubusercontent.com/3503166/35645647-c1bf80b4-06cc-11e8-8533-9b5866881193.png '' > -- - # # # Environment * React Native Navigation version : 1.1.362 * React Native version : 0.52.2 * Platform ( s ) ( iOS , Android , or both ? ) : iOS * Device info ( Simulator/Device ? OS version ? Debug/Release ? ) : Simulator iOS11 Debug
[ v2 ] Disabling navigation animations __EoT__ # # # Issue Description Is it currently not possible to disable animations when pushing and popping screens or modals in v2 ? If it is , could the docs be updated ? If not , is there a timeline on this ? Thanks in advance . # # # Steps to Reproduce / Code Snippets / Screenshots n/a -- - # # # Environment * React Native Navigation version : 2.0.2095 * React Native version : 0.52.0 * Platform ( s ) ( iOS , Android , or both ? ) : iOS * Device info ( Simulator/Device ? OS version ? Debug/Release ? ) : n/a
Stack layout android __EoT__
Adds launch image for iPhone X and iPad to showSplashScreen . __EoT__ This resolves the black screen showing in between when a static launch image shows and the JS code renders your app on iOS .
Upgrade example proj to rn51 __EoT__
Implement selected and unselected toTab color __EoT__
V2 navigation bars testIDs __EoT__ Added support in testIDs for topBar and bottomTabs elements
disabled back gesture support __EoT__
setStyle to style the according TabBar __EoT__ Use ` navigator.setStyle ( { ... } ` to set the style of TabBar of the according screen at runtime for iOS and Android . Good for theming purpose . Exampe : `` ` javascript this.props.navigator.setStyle ( { tabBarButtonColor : ' # 0d0d0d ' , tabBarSelectedButtonColor : ' # ff6c33 ' , tabBarBackgroundColor : ' # ffffff ' , navigationBarColor : ' # ffffff ' , } ) ; `` `
V2 overlay __EoT__
3D Touch Preview API __EoT__ Added the preview and pop feature . It is currently implemented so the javascript API is untouched ( uses passProps ) but I would like to see if anyone has interest in this feature so we can give it some API love . To use the feature you simply call ` navigator.push ( ) ` but with additional parameter ` previewViewID ` which is a React Node . `` ` js < TouchableOpacity onPressIn= { ( ) = > this.props.navigator.push ( { screen : 'screenid ' , previewView : this.viewRef , previewActions : [ { title : 'Foo ' , style : 'selected ' , // none , selected , destructive actions : [ { title : 'Bar ' } ] , } ] , } ) / > `` ` ! [ previewandpop ] ( https : //user-images.githubusercontent.com/180773/32990015-486219dc-ccef-11e7-92f3-e69735fbd6d2.gif ) Going forward with this would include some of the next steps : - [ x ] Move previewViewID from passProps to it 's parent . - [ x ] Added some fail-safe wrappers around the added class methods - [ x ] Added preview actions ( with groups ) . - [ x ] Moved
Android broken push/pop/modal animations __EoT__
[ V2 ] android playground icons __EoT__ Just added icon . It looks prettier : )
add shouldStretchDrawer property to drawerStyle __EoT__ support [ shouldStretchDrawer ] ( http : //cocoadocs.org/docsets/MMDrawerController/0.6.0/Classes/MMDrawerController.html # //api/name/shouldStretchDrawer ) of MMDrawerController
add disabledButtonColor __EoT__ in order to set navigation button disabled color
keep style across push - iOS only __EoT__ Add the ability to choose if relevant styles properties will remember across push or not
topBarBlur for ios __EoT__
tabBarHidden for iOS __EoT__
Update README.md __EoT__
Renamed container lifecycle events __EoT__ Renamed lifecycle events from onStop/OnStart to didDisappear/didAppear respectively .
Improved Deeplink documentation __EoT__ To match the rest of the styling
remove all dependencies on babel __EoT__ My guess is we do n't need babel anymore , other than import/export everything is supported by stable version of node
Prevent back button flicker when calling resetTo __EoT__ The following occurs on iOS when calling resetTo # Before < img src= '' http : //g.recordit.co/LioSTi8bZC.gif '' / > # After < img src= '' http : //g.recordit.co/DSAhjcMR8V.gif '' / >
Remove createJSModules @ override marker - RN 0.47 compatibility __EoT__ [ ` createJSModules ` is now not required on Android ] ( https : //github.com/facebook/react-native/commit/ce6fb337a146e6f261f2afb564aa19363774a7a8 ) from RN 0.47 . This is backwards compatible according to my tests .
Fix crash with scrollViewDidEndDecelerating and RCTTextView __EoT__ See https : //github.com/wix/react-native-navigation/issues/1446 # issuecomment-319858633
Update top-level-api.md ( Added forgotten styles ) __EoT__ Added forgotten drawer style props .
Global screen visibility listener __EoT__
Contributing guidelines & docs __EoT__ Some updates to the docs , more explanation in the contributing guidelines . To be continued ...
fixed typos in v2 docs __EoT__
[ iOS ] Added fade transition animation between screens __EoT__ Fade transition animation for : - push - pop - popToRoot - resetTo for example `` ` javascript this.props.navigator.push ( { screen : 'example.ExampleScreen ' , animationType : 'fade ' } ) ; `` ` if you not specifying ` animationType ` , animation will be default .
changed this.props.id to this.props.containerId __EoT__ Containers now receive their container id under this.props.containerId instead of this.props.id . Note : js tests not passing yet
Add compatibility with react-native link __EoT__ Since ` react-native link ` adds the new packages to ` getPackages ( ) ` I added the method and return whatever it has from the ` createAdditionalReactPackages ( ) ` `` ` java protected List < ReactPackage > getPackages ( ) { return Arrays. < ReactPackage > asList ( // eg . new SvgPackage ( ) , ) ; } @ Override public List < ReactPackage > createAdditionalReactPackages ( ) { return this.getPackages ( ) ; } `` `
Fix sample code for MainActivity.java in Android Installation guide __EoT__ Forth step of Android Installation guide is about how to update MainActivity.java but sample code is for MainApplication.java
Fling collapsing react view screens __EoT__
navigator.setSubTitle ( ) support for iOS __EoT__ # Problem ` navigator.setSubTitle ( ) ` is implemented for Android but not for iOS . ` navigator.setTitle ( { subtitle } ) ` allows to change the subtitle of a navigator but omitting the title property will result in it being deleted . This PR brings feature parity between iOS and Android . # Resolution As I have **never** done any native work for iOS , I started by replicating every piece of code that involved ` setTitle ` to get a better understanding of the data flow . This approach worked but it felt like I added too much redundancy . I opted instead for piggybacking the internals of ` setSubTitle ` on ` setTitle ` by injecting ` isSetSubtitle ` into the props passed by the user to differentiate wether the title should be kept as-is or not . I do n't know if it 's a good idea to keep both methods so close together but on the other hand I have no idea where a good split might be and the two functions are already kind of intertwined ( ` setTitle ( { subtitle } ) ` ,
Edited how to return additional packages __EoT__ Docs were n't very clear on how exactly to return additional packages , i.e. , as a < ReactPackages > list [ Line 65 ] . Also changed MyApplication to MainApplication on line 54 ( if that is a default and has n't been changed by the developer ) .
Update README.md __EoT__ Add element transition gif
Migrate example app to RN 0.43.3 __EoT__
Modal context menu fix __EoT__ Fixes issues # 1095 , # 1105 , and enables ` disableIconTint ` property on Android title bar buttons .
[ Android ] Support custom icon for left nav button on TitleBar __EoT__ Support custom icon by config like : `` ` javascript leftButtons : [ { icon : require ( '../../img/navicon_menu.png ' ) , id : 'menu' } ] `` `
Shared element transition __EoT__
Add font family support on bottom tabs __EoT__ in appStyle add attribute `` ` javascript tabFontFamily : 'Avenir-Medium.ttf ' // for asset file `` ` or `` ` javascript tabFontFamily : 'sans-serif ' // for existing fonts in system `` `
Added 'bottomTabPressed ' navigation event __EoT__ Added an additional navigation event , 'bottomTabPressed ' , for the press of an already selected tab .
Fix import RCTBundleURLProvider.h __EoT__
Update installation-android.md __EoT__
pop to id ( clear top ) __EoT__
Support showing modals without animation __EoT__
dismissAllModals __EoT__
Take scaled touch slop into account when calculating if screen can co… __EoT__ …llapse
Dynamic height for CollapsingReactHeader __EoT__ This commit deprecates collapsingToolBarComponentHeight style property
Register passProps with PropsRegistry during showInAppNotification for Android __EoT__
Cleanup/unmount notification overlay on Layout.destroy ( ) __EoT__
Remove bottom tab badge when calling setTabBadge with empty object __EoT__
Fixes overlapping fab . __EoT__ This commit also introduces a tempprary fix to an issue where fab is displayed on wrong screen when switching between bottom tabs rapidly .
Send bottomTabSelected event __EoT__ The event is sent to the top most screen displayed in the current screenStack .
Remove Fab when when calling setButtons __EoT__ call setButtons with empty fab object to remove it
Added shields __EoT__ - NPM ( Version / Downloads ) - Build Status - Discord
Screen background color android __EoT__ This PR add support for ` screenBackgroundColor ` property in ` navigatorStyle ` and collapses ViewPager screen when TopTab is selected as well
Fix fab __EoT__
Intermittent test failure in Throttling pattern __EoT__ See https : //travis-ci.org/iluwatar/java-design-patterns/builds/278878833
Intermittent test failure in Throttling pattern __EoT__ See https : //travis-ci.org/iluwatar/java-design-patterns/builds/278878833
Splitter ( EIP ) __EoT__
Wire Tap ( EIP ) __EoT__
Unit of Work pattern __EoT__ http : //martinfowler.com/eaaCatalog/unitOfWork.html
Partial Response pattern __EoT__ Pattern where an API lets clients specify the structure of the response . http : //yaoganglian.com/2013/07/01/partial-response/
SonarQube reports bugs __EoT__ The project is automatically scanned with SonarQube . The static code analysis reports several blocker and critical level issues that should be fixed . https : //sonarcloud.io/project/issues ? id=com.iluwatar % 3Ajava-design-patterns & resolved=false & severities=BLOCKER % 2CCRITICAL & types=BUG
huge bitmap ignore scaling ? __EoT__ Hi I want to download and to show image from link ` http : //img.zszywka.pl/0/0126/7034/wlosy-dlugie-i-piekne.jpg ` It 's huge width=654|height=4734 : ) In documentation was written that UIL will take paramaters from ImageView or from device but in my situation it seem that UIL does n't want to scale this image . I think so because of this log warning : OpenGLRenderer : Bitmap too large to be uploaded into a texture ( 654x4734 , max=4096x4096 ) And I have to handle scaling by myself . my code : Application.java : `` ` java public static void initImageLoader ( Context context ) { DisplayImageOptions defaultOptions = new DisplayImageOptions.Builder ( ) .bitmapConfig ( Bitmap.Config.RGB_565 ) .build ( ) ; ImageLoaderConfiguration config = new ImageLoaderConfiguration .Builder ( context ) .defaultDisplayImageOptions ( defaultOptions ) .memoryCache ( new LruMemoryCache ( 2 * 1024 * 1024 ) ) .discCacheSize ( 50 * 1024 * 1024 ) .imageDownloader ( new BaseImageDownloader ( context , 2000 , 3000 ) ) .discCacheFileNameGenerator ( new Md5FileNameGenerator ( ) ) .build ( ) ; L.disableLogging ( ) ; ImageLoader.getInstance ( ) .init ( config ) ; } `` ` layout : zoom.xml : ``
What is the cause of lArgumentException : `` cacheDir '' argument must be not null ? __EoT__ I looked into the code and i think File cacheDir = StorageUtils.getCacheDirectory ( context ) ; is returning null . What would be the cause ? is it device related ? Two users got this exception with our new release that is using universal image v1.8.6 .
Bug with the PostProcessor gives recycled bitmap __EoT__ I have a ListView that display some custom views with images and these images can be repeated in the ListView . What happens is the I want to apply some effects in this images before displaying them . Since the BitmapDisplayer runs in the UI Threads and the effects I 'm applying can be slow , I 'm putting these effects in a BitmapProcessor that is registered as postProcessor . The problem is that my BitmapProcessor is receiving recycled bitmaps and it gives me a exception when I try to write another bitmap with my effects applied . I ca n't put it in the preProcessor because these same images is used with different effects in other activities . This is my configuration : `` ` java defaultDisplayImageOptions = new DisplayImageOptions.Builder ( ) .cacheInMemory ( ) .cacheOnDisc ( ) .showStubImage ( R.drawable.stub ) .build ( ) ; ImageLoaderConfiguration config = new ImageLoaderConfiguration.Builder ( getApplicationContext ( ) ) .taskExecutor ( AsyncTask.THREAD_POOL_EXECUTOR ) .taskExecutorForCachedImages ( AsyncTask.THREAD_POOL_EXECUTOR ) .threadPoolSize ( 3 ) .threadPriority ( Thread.NORM_PRIORITY - 2 ) .memoryCache ( new LRULimitedMemoryCache ( 2 * 1024 * 1024 ) ) .discCache ( new UnlimitedDiscCache (
De/Encoding for File URI image load problem __EoT__ For an image file : /storage/sdcard0/groupurchase/cache/http % 3A % 2F % 2Fd2.lashouimg.com % 2Fzt_mobile_220 % 2F201211 % 2F29 % 2F135417696321262100.jpg imageLoader tries to load an decoded file path which is incorrect : `` ` 02-25 13:20:51.085 : E/ImageLoader ( 27155 ) : java.io.FileNotFoundException : /storage/sdcard0/groupurchase/cache/http : /d2.lashouimg.com/zt_mobile_220/201211/29/135417696321262100.jpg : open failed : ENOENT ( No such file or directory ) `` ` It should keep the encoded string as it is , and read by stream . The problem is caused by imageloader code below : `` ` java final class ImageLoadingInfo { ... public ImageLoadingInfo ( String uri , ImageView imageView , ImageSize targetSize , DisplayImageOptions options , ImageLoadingListener listener , ReentrantLock loadFromUriLock ) { this.uri = Uri.encode ( uri , `` @ # & =*+-_. , : ! ? ( ) /~ ' % '' ) ; ... } } `` `
De/Encoding for File URI image load problem __EoT__ For an image file : /storage/sdcard0/groupurchase/cache/http % 3A % 2F % 2Fd2.lashouimg.com % 2Fzt_mobile_220 % 2F201211 % 2F29 % 2F135417696321262100.jpg imageLoader tries to load an decoded file path which is incorrect : `` ` 02-25 13:20:51.085 : E/ImageLoader ( 27155 ) : java.io.FileNotFoundException : /storage/sdcard0/groupurchase/cache/http : /d2.lashouimg.com/zt_mobile_220/201211/29/135417696321262100.jpg : open failed : ENOENT ( No such file or directory ) `` ` It should keep the encoded string as it is , and read by stream . The problem is caused by imageloader code below : `` ` java final class ImageLoadingInfo { ... public ImageLoadingInfo ( String uri , ImageView imageView , ImageSize targetSize , DisplayImageOptions options , ImageLoadingListener listener , ReentrantLock loadFromUriLock ) { this.uri = Uri.encode ( uri , `` @ # & =*+-_. , : ! ? ( ) /~ ' % '' ) ; ... } } `` `
Problem with landscape images __EoT__ If you have a landscape image ( with width longer than height ) , but the device is in portrait mode , the library does some wrong operations . In ImageLoader , lines 424-430 , the getImageSizeScaleTo function exchanges width with eight if the image is landscape and the devise is portrait ( and vice versa ) . In this way , if you have an image of WxH , where W > H , the image is scaled to HxW , then when the view is shown , it 's scaled again to WxH ... but the width W has the resolution of H , and the height H has the resolution W. You can see in this image what the image should looks like ( and hot the image is shown if commenting out lines 424-430 ) and how the image is shown at the moment http : //i50.tinypic.com/2dt56y1.png
One image cached in memory for different ImageViews __EoT__ When Bitmap was cached in memory cache with small size and we want to display image in big ImageView this small Bitmap would be used . Search this use-case solution .
Crash on clear cache __EoT__ The clear cache function crashes if the cache folder does n't exists . This is beacuse in DiskCache.java , line 27 cacheDir.listFiles ( ) ; returns null .
refactor : extract seal check into method and reuse __EoT__ no operational or logical change , only this refactor . i think , reusing the method `` checkIfSealed '' is a better style .
Hikari blindly overrides Connection 's readOnly and autoCommit __EoT__ # # # # Environment `` ` HikariCP version : 2.3.8 and master JDK version : 1.8.0_151 Database : PostgreSQL|MySQL|any Driver version : 9.4.1208 `` ` -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- - *Have you searched the CLOSED issues already ? How about checking [ stackoverflow ] ( https : //stackoverflow.com/search ? q=HikariCP ) ? * Yes . # # # Bug If ` readOnly ` or ` autoCommit ` are specified via the JDBC URL , HikariCP will blindly override them when calling ` setupConnection ` ( both in [ ` PoolUtilities ` ] ( https : //github.com/brettwooldridge/HikariCP/blob/2.3.x/hikaricp-common/src/main/java/com/zaxxer/hikari/pool/PoolUtilities.java # L138 ) for 2.3.x and [ ` PoolBase ` ] ( https : //github.com/brettwooldridge/HikariCP/blob/2.4.x/src/main/java/com/zaxxer/hikari/pool/PoolBase.java # L379 ) for 2.4.x and the ` dev ` branch ) . # # # Proposed Resolution Hikari should only call ` connection.setReadOnly ` and ` connection.setAutoCommit ` if the setting was directly specified .
Can HikariCP offer new `` suspend '' function that can immediately throw `` suspend “ exception . __EoT__ # # # # Environment `` ` HikariCP version : x.x.x JDK version : 1.8.0_111 Database : oracle Driver version : 2.3.13 `` ` New request : Current `` suspend '' function will block application when application calls getConnection method , which can cause whole application crashes。 Can HikariCP offer new `` suspend '' function that can immediately throw `` suspend “ exception . In some cases when database is in mantainance , we need suspend datasource temporarily which make application can still run database-fail-tolerant bussiness . Currently Only Weblogic 's datasource `` suppend '' function meets this need . -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- - *Have you searched the CLOSED issues already ? How about checking [ stackoverflow ] ( https : //stackoverflow.com/search ? q=HikariCP ) ? *
HikariProxyStatement.getGeneratedKeys does not return ProxyResultSet __EoT__ # # # # Environment `` ` HikariCP version : 2.7.2 JDK version : 1.8.0_111 Database : SqlServer Driver version : group : 'com.microsoft.sqlserver ' , name : 'mssql-jdbc ' , version : '6.2.1.jre8' `` ` -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- - *Have you searched the CLOSED issues already ? How about checking [ stackoverflow ] ( https : //stackoverflow.com/search ? q=HikariCP ) ? * I 'm using the [ requery.io ] ( requery ) library and am experiencing a connection leak when it calls : `` ` statement.getGeneratedKeys ( ) // where statement is a HikariProxyStatement `` ` Instead of returning a proxied ResultSet this seems to return the raw JDBC ResultSet . Requery then goes on later to close the connection by calling something like : `` ` Statement statement = resultSet.getStatement ( ) ; Connection connection = statement.getConnection ( ) ; resultSet.close ( ) ; statement.close ( ) ; connection.close ( )
Added a support for SQL server 's specific isolation level ( Snapshot ) __EoT__ Added a constant that represents the SQL server 's snapshot isolation level and added a case with the constant . Configuring the isolation level with Spring Boot 2 's application.yml works .
SQL state [ 0A000 ] keeps recurring , seems unrecoverable __EoT__ # # # # Environment `` ` HikariCP version : x.x.x JDK version : 1.8.0_144 Database : PostgreSQL Driver version : 9.4.1212.jre7 `` ` -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- - When doing a rolling deploy of our application ( over multiple application nodes ) . The first node to be redeployed with the new version will apply database changes through _Flyway_ . Exception : ` SQL state [ 0A000 ] ; error code [ 0 ] ; ERROR : cached plan must not change result type ; nested exception is org.postgresql.util.PSQLException : ERROR : cached plan must not change result type ` . PostgreSQL errorcode **0A000** ( FEATURE NOT SUPPORTED ) This seems to be an unrecoverable exception . But is n't listed in the SQL_ERRORS list ( ProxyConnection ) so the connection will not be closed . So the exception keeps recurring .
Fixed ClassNotFoundException when com.codahale.metrics.MetricRegistry is not in the classpath __EoT__ ClassNotFoundException is thrown during ` DataSource # getConnection ( ) ` when ` io.dropwizard.metrics : metrics-core ` is not available in the class path .
Mask password in JDBC URL __EoT__ I use HikariCP in my project and set JDBC URL with password property . I found the password in JDBC URL is not masked while directly set password is . I think it 's good to mask it as well . Could you consider to merge this change ?
Cleanup readme __EoT__ Fixes links and pretties things up .
updated README.md __EoT__ current document for minimumIdle property is a bit confusing , below is the statement If the idle connections dip below this value , HikariCP will make a best effort to add additional connections quickly and efficiently updated it to If the idle connections dip below this value and total connections in the pool are less than maximumPoolSize , HikariCP will make a best effort to add additional connections quickly and efficiently .
Restore the ability to completely bypass HikariPool.checkFailFast ( ) __EoT__ As discussed [ on the commit ] ( https : //github.com/brettwooldridge/HikariCP/commit/1587198e6ae47ead5e712ac861089bc0888dbaf7 # commitcomment-20603613 ) , with the move from ` initializationFailFast ` to ` initializationFailTimeout ` , the ability to completely skip ` HikariPool.checkFailFast ( ) ` has been lost . The ability to skip the initial check is very useful to me , however , so I 'm hoping it can be restored .
Avoid creating too many connections in bursty workloads __EoT__ See Issue # 774 for backstory . Turns out in a bursty mode where the actual work being done is short it is pretty easy to hit maxPoolSize connections . Once connections are made they are quickly cycled through so they do n't appear to age out and the pool will stay at max size while there is a consistent set of work to be done . See javadoc in middle of PoolEntryCreator for in-depth description of fix . Notes - RaceCondition test was accidently disabled , did n't actually use the pool and had no assertions to check that it was doing anything - RampUp test was racy and would fail if unlucky - Main change ended up being pretty simple but I ca n't 100 % convince myself that it is perfect . I agree it is better to make more connections than too few . - Last commit to switch getPendingQueue ( ) to use the atomic.get ( ) is optional but I think it is more accurate because in a heavily trafficed pool all of the threads are waking up and checking all of the objects (
Pool started logged even if configuration mistaken __EoT__ Hi , When there are configuration mistake , HikariCP show in the log : > mypool - Started . and throw an exception . Consequently , the pool is not started at this point and the log is misleading . I think these two lines should be reversed in HikariDataSource.java : `` ` LOGGER.info ( `` { } - Started . `` , configuration.getPoolName ( ) ) ; pool = fastPathPool = new HikariPool ( this ) ; `` `
metrics : total borrowed/created connections __EoT__ I 'm testing a move from dbcp2 to hikari . Thanks for writing another alternative for pooling . In dbcp2 i 've been monitoring my pools via JMX for borrowedCount ( the amount of times connections have been borrowed/used ) and createdCount ( the amount of times a connection is created ) . These are running counts , and i do deltas on the counts for my monitoring . I 'm wondering if we can get something like this in Hikari . Thanks .
Support multiple connections at startup __EoT__ USE CASE When we start our environment , we often start the database server on a different machine , than the application server . And then it is practically impossible to ensure that the application starts after the database . The property initializationFailFast will not help us , as it will return with a connection-pool that does not work . If for example Ebean og Hibernate starts afterwards , they will fail as they can not fetch a Connection . PROPOSED SOLUTION We set a parameter : initializationMaxAttempts Which should default to 1 ( todays functionality ) . This should say how many attempts HikariCP should perform to get the initial connections . If connection is not retrieved , then it should log clearly that connection is not coming up . ( ERROR ? )
Error when connecting to JSonar with HikariCP __EoT__ I recognize that JSonar may well be the ultimate culprit here , but when connecting I get this error : `` ` A configuration problem has occurred . Failed to initialize pool : Could not get transaction isolation level `` ` Note that I did configure TransactionIsolation override , but HikariCP should probably safely handle this if it ’ s set and also possibly log it and/or through an exception if not set . I made the following minor change to PoolBase.checkDriverSupport ( ) and it fixed this issue and everything works great with JSonar : Old : `` ` private void checkDriverSupport ( final Connection connection ) throws SQLException { if ( ! isValidChecked ) { try { if ( isUseJdbc4Validation ) { connection.isValid ( 1 ) ; } else { executeSql ( connection , config.getConnectionTestQuery ( ) , false ) ; } } catch ( Throwable e ) { LOGGER.error ( `` { } - Failed to execute '' + ( isUseJdbc4Validation ? `` isValid ( ) for connection , configure '' : `` '' ) + `` connection test query . ( { } ) '' , poolName ,
FastList is not thread-safe __EoT__ Hi @ brettwooldridge , This issue is to notify you about a concurrency bug . When multiple threads create and close ` PreparedStatements ` , ` ProxyStatement.close ( ) ` calls ` ProxyConnection.untrackStatement ( Statement ) ` multiple times with different statements . ` ProxyConnection ` then attempts to remove these from ` openStatements ` . The problem is that ` FastList ` is not thread-safe , so these concurrent removes end up throwing an ` ArrayIndexOutOfBoundsException ` . I 've created ` ConcurrentCloseConnectionTest ` to demonstrate this problem ( see # 590 ) . As we said in # 451 , we 're getting closer to our 7.0 release . We have a workaround so our CI tests pass , but we 'd like to have a real solution in place with enough time to allow for rigorous testing . Please let me know if you have any questions or need more input . Thanks ! Matt cc @ shuyangzhou
Pool Initialization Randomly Crash __EoT__ HI , I 'm investigating on some Hikari Pool crash at startup . This is not happening every time , but about 25 % of time , with no apparent external factor ( for example , there is no time slot with a higher crash rate ) . ( Hikari 2.4.3 , java version `` 1.7.0_11 '' , Java ( TM ) SE Runtime Environment ( build 1.7.0_11-b21 ) Java HotSpot ( TM ) 64-Bit Server VM ( build 23.6-b04 , mixed mode ) ) First , here is a log with Hikari debug level activated and the final crash ( I hided jdbcUrl ) : [ DEBUG ] 2016-01-27 12:30:22,858 [ main ] com.zaxxer.hikari.HikariConfig:840 - HikariPool-0 - configuration : [ DEBUG ] 2016-01-27 12:30:22,872 [ main ] com.zaxxer.hikari.HikariConfig:851 - allowPoolSuspension ... ... ... ... .false [ DEBUG ] 2016-01-27 12:30:22,873 [ main ] com.zaxxer.hikari.HikariConfig:851 - autoCommit ... ... ... ... ... ... ... .true [ DEBUG ] 2016-01-27 12:30:22,873 [ main ] com.zaxxer.hikari.HikariConfig:851 - catalog ... ... ... ... ... ... ... ... . [ DEBUG ] 2016-01-27 12:30:22,873 [ main ] com.zaxxer.hikari.HikariConfig:851 - connectionInitSql ... ... ... ... ... [ DEBUG ] 2016-01-27
Specifying both the setDataSourceClassName & jdbc url leading to connection error on localhost . __EoT__ Through this is not recommended to use both setDataSourceClassName and setJdbcUrl but I found the error message is mis-leading ( while I have sqlServerJdbcUrl to pointing to some other external ip ) `` ` public void init ( int minimum , int Maximum ) { HikariConfig config = new HikariConfig ( ) ; config.setDataSourceClassName ( `` com.microsoft.sqlserver.jdbc.SQLServerDataSource '' ) ; config.setJdbcUrl ( sqlServerJdbcUrl.get ( ) ) ; config.setAutoCommit ( true ) ; config.setMinimumIdle ( minimum ) ; config.setMaximumPoolSize ( Maximum ) ; config.setInitializationFailFast ( true ) ; ds = new HikariDataSource ( config ) ; } `` ` Error : Exception in thread `` main '' com.zaxxer.hikari.pool.PoolInitializationException : Exception during pool initialization : The TCP/IP connection to the host localhost , port 1433 has failed . Error : `` Connection refused . Verify the connection properties . Make sure that an instance of SQL Server is running on the host and accepting TCP/IP connections at the port . Make sure that TCP connections to the port are not blocked by a firewall. '' . at com.zaxxer.hikari.pool.HikariPool.initializeConnections ( HikariPool.java:581 ) at com.zaxxer.hikari.pool.HikariPool. < init > (
SQLException loses SQLState __EoT__ When Hikari throws a ` SQLException ` , for instance , if we were unable to connect to the database , the underlying ` SQLState ` value is not set . Given the following exception - `` ` scala try { .. } catch { case e : java.sql.SQLException = > println ( e.getSQLState ) // null val cause = e.getCause.asInstanceOf [ org.postgresql.util.PSQLException ] println ( cause.getSQLState ) // 08001 } `` ` The desired behavior would be for the ` SQLException ` to contain the underlying SQLState of its cause .
connection.setReadOnly ( isReadOnly ) at PoolUtilities.java:129 throws SQLFeatureNotSupportedException with Voltdb __EoT__ Looks like VoltDB does not support read-only mode . so when used with hirakicp it throws the error java.sql.SQLFeatureNotSupportedException at org.voltdb.jdbc.SQLError.noSupport ( SQLError.java:65 ) at org.voltdb.jdbc.JDBC4Connection.setReadOnly ( JDBC4Connection.java:480 ) at com.zaxxer.hikari.pool.PoolUtilities.setupConnection ( PoolUtilities.java:129 ) Wondering how to use hirakicp with data stores that do not support read-only mode
Race condition on Shutdown ? __EoT__ Hi , if I shutdown Hikari before the Pool has been fully initialized ( I guess before all the connections have been opened ) sometimes I get an IllegalSateException ` 2015.01.19 13:47:44,793 CET [ main ] DEBUG HikariPool - Before shutdown pool stats HikariPool-0 ( total=8 , inUse=0 , avail=8 , waiting=0 ) 2015.01.19 13:47:44,933 CET [ HikariCP connection filler ( pool HikariPool-0 ) ] DEBUG HikariPool - Connection attempt to database HikariPool-0 failed : ConcurrentBag has been closed java.lang.IllegalStateException : ConcurrentBag has been closed at com.zaxxer.hikari.util.ConcurrentBag.add ( ConcurrentBag.java:184 ) at com.zaxxer.hikari.pool.HikariPool.addConnection ( HikariPool.java:436 ) at com.zaxxer.hikari.pool.HikariPool.access $ 400 ( HikariPool.java:73 ) at com.zaxxer.hikari.pool.HikariPool $ 1AddConnection.run ( HikariPool.java:315 ) at java.util.concurrent.Executors $ RunnableAdapter.call ( Executors.java:471 ) at java.util.concurrent.FutureTask.run ( FutureTask.java:262 ) at java.util.concurrent.ThreadPoolExecutor.runWorker ( ThreadPoolExecutor.java:1145 ) at java.util.concurrent.ThreadPoolExecutor $ Worker.run ( ThreadPoolExecutor.java:615 ) at java.lang.Thread.run ( Thread.java:724 ) 2015.01.19 13:47:45,41 CET [ main ] DEBUG HikariPool - After shutdown pool stats HikariPool-0 ( total=0 , inUse=0 , avail=0 , waiting=0 ) ` Note the before shutting down total being 8 while my setting is ` config.setMaximumPoolSize ( 10 ) ; ` Maybe the ` shutdown ( ) ` command does not stop the `
Provide a reason as to why connection could not be retrieved __EoT__ We 've encountered the following message in a variety of scenarios : `` ` java.sql.SQLTimeoutException : Timeout after 30000ms of waiting for a connection . `` ` Unfortunately , it 's not informative as to why the connection could not be retrieved . Is the pool exhausted over the timeout interval ? Are we unable to instantiate a connection to the database ? Is no connection valid ? A better understanding as to the cause of this error would be super helpful in diagnosing transient failures .
minimum connectionTimeout value has changed , readme.md out of sync __EoT__ Similar to https : //github.com/brettwooldridge/HikariCP/pull/140 it seems the readme.md file in master indicates a minimum connectionTimeout of 100ms , while the code ( after moving this logic from HikariConfig to AbstractHikariConfig ) throws an exception if this value is under 1000ms . Was the shift to 1s intentional or a typo during porting ? Version 2.1.0 has 100ms in HikariConfig while 2.3.1 has 1000ms in AbstractHikariConfig .
Document migration plan for DataSource.getConnection ( String , String ) __EoT__ https : //github.com/brettwooldridge/HikariCP/commit/0fe27651fbe695d40ba94df90adc4b55c9f80fec deprecates ` getConnection ( String , String ) ` . Please add Javadoc ( ` @ deprecate ` tag ) that explains what users are supposed to do instead . In the commit message you talk about creating separate pools . I believe it would help users if you mention that they must use ` HikariConfig.setUsername ( ) ` and ` setPassword ( ) ` to achieve the same result .
Fix for # 214 . Handle the ` UnsupportedOperationException ` __EoT__ Handle the ` UnsupportedOperationException ` that is thrown by ` JdbcOdbcDriver.isValid ( ) ` .
Site to download the official jars __EoT__ I would like to know if you have a site where you publish the jars , instead of create them from Maven or download them from Maven Central . The releases section of GitHub only provides the releases of the code , but not the binaries : https : //github.com/brettwooldridge/HikariCP/releases
PoolUtilities static methods maintain state . Causing incorrect results for PoolUtilities : :isJdbc40Compliant __EoT__ I have two HikariCP connection pools in my application . One pool is JDBC4 compliant . The other is not . PoolUtilities is used to test for jdbc40 and jdbc41 compliance . However , it seems to try to cache the results of this test by using private static fields on the PoolUtilities class . This causes one of my two pools to have incorrect results reported by the various test methods ( i.e . PoolUtilities : :isJdbc40Compliant ) .
Connection marked as broken because of SQLSTATE ( 08003 ) __EoT__ PostgreSQL 9.3 , Hikari 2.2.5 I 'm getting random exceptions like this : `` ` 17:22:24.117 [ qtp1372269468-674 ] WARN com.zaxxer.hikari.proxy.ConnectionProxy.checkException ( ) - Connection org.postgresql.jdbc4.Jdbc4Connection @ 482c822f ( HikariPool-39 ) marked as broken because of SQLSTATE ( 08003 ) , ErrorCode ( 0 ) . org.postgresql.util.PSQLException : This connection has been closed . at org.postgresql.jdbc2.AbstractJdbc2Connection.checkClosed ( AbstractJdbc2Connection.java:843 ) at org.postgresql.jdbc2.AbstractJdbc2Connection.setAutoCommit ( AbstractJdbc2Connection.java:785 ) at com.zaxxer.hikari.proxy.ConnectionProxy.resetConnectionState ( ConnectionProxy.java:164 ) at com.zaxxer.hikari.proxy.ConnectionProxy.close ( ConnectionProxy.java:207 ) at com.realestate.backend.scope.DefaultRequestScope $ ConnectionFactory.disposeValue ( DefaultRequestScope.java:200 ) at com.realestate.backend.scope.DefaultRequestScope $ ConnectionFactory.disposeValue ( DefaultRequestScope.java:147 ) at org.bitbucket.cowwoc.pouch.LazyFactory.close ( LazyFactory.java:59 ) at com.realestate.backend.scope.DefaultRequestScope.close ( DefaultRequestScope.java:143 ) at com.realestate.backend.jersey.PouchBinder $ RequestFactory.dispose ( PouchBinder.java:50 ) at com.realestate.backend.jersey.PouchBinder $ RequestFactory.dispose ( PouchBinder.java:23 ) at org.jvnet.hk2.internal.FactoryCreator.dispose ( FactoryCreator.java:114 ) at org.jvnet.hk2.internal.SystemDescriptor.dispose ( SystemDescriptor.java:516 ) at org.glassfish.jersey.process.internal.RequestScope $ Instance.remove ( RequestScope.java:512 ) at org.glassfish.jersey.process.internal.RequestScope $ Instance.release ( RequestScope.java:529 ) at org.glassfish.jersey.process.internal.RequestScope.runInScope ( RequestScope.java:299 ) at org.glassfish.jersey.server.ServerRuntime.process ( ServerRuntime.java:254 ) at org.glassfish.jersey.server.ApplicationHandler.handle ( ApplicationHandler.java:1030 ) at org.glassfish.jersey.servlet.WebComponent.service ( WebComponent.java:373 ) at org.glassfish.jersey.servlet.ServletContainer.service ( ServletContainer.java:381 ) at org.glassfish.jersey.servlet.ServletContainer.doFilter ( ServletContainer.java:534 ) at org.glassfish.jersey.servlet.ServletContainer.doFilter ( ServletContainer.java:482 ) at org.glassfish.jersey.servlet.ServletContainer.doFilter ( ServletContainer.java:419 ) at org.eclipse.jetty.servlet.ServletHandler $ CachedChain.doFilter ( ServletHandler.java:1650 ) at org.eclipse.jetty.servlet.ServletHandler.doHandle ( ServletHandler.java:583 ) at
Failover Functionality __EoT__ It would be great if we could have the connection pool in helping make planned 'failover ' more graceful . The softEvictConnections ( ) is a good solution for synchronous replication databases ( active : active ) such as Galera . Both can accept writes at the same time . We just need to wait until all connections are closed . In MySQL world , many environments are using asynchronous replication . - In order to avoid split-brain first the connections need to be closed/killed on the 'current master ' . - Then the replication needs to be caught up - the virtual IP address is moved to the new master - the new master can now start accepting connections . It would be good to have some JMX methods that can help make this more graceful : - haltAllConnections ( ) - to stop processing database queries , queueing it on connection pool level . - getCurrentActiveConnections ( ) - to have the external tool monitor and wait until all of them are idle ( here the failover process would take place , which usually takes a couple of seconds ) - resumeAllConnections ( ) -
Hikari 2.1 : Some strange behaviors if DB is unreachable __EoT__ Although I said that Hikari 2.1 worked well for us we recently found some strange behavior if the DB is unreachable . 1 . Behavior - Pool : 0 total , 0 inUse , 0 avail , 0 wait - DB host is down ( **packets are dropped** ) - ` getConnection ( ) ` fails after ` connectionTimeout ` milliseconds - Result : The Hikari Housekeeper now prints 1 total , 1 inUse , 0 avail , 0 wait - Expected : 0 total , 0 inUse , 0 avail , 0 wait . Since getConnection ( ) threw an Exception because of ` connectionTimout ` there is no reason to keep that connection in the pool . 2 . Behavior - Pool : 1 total , 0 inUse , 1 avail , 0 wait - DB host is down ( **packets are dropped** ) - Result : ` getConnection ( ) ` **does not** timeout after ` connectionTimeout ` milliseconds . Housekeeper prints out 1 total , 1 inUse , 0 avail , 0 wait - Expected : ` getConnection ( ) ` should fail after `
hikari-java6 : NoSuchMethodError ScheduledThreadPoolExecutor.setRemoveOnCancelPolicy __EoT__ Hi , I 've upgraded from 1.40 to hikari-java6 2.0.0 , and I m getting below exception at server start up : `` ` at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference ( BeanDefinitionValueResolver.java:328 ) ... 25 more Caused by : org.springframework.beans.BeanInstantiationException : Could not instantiate bean class [ com.zaxxer.hikari.HikariDataSource ] : Constructor threw exception ; nested exception is java.lang.NoSuchMethodError : java.util.concurrent.ScheduledThreadPoolExecutor.setRemoveOnCancelPolicy ( Z ) V at org.springframework.beans.BeanUtils.instantiateClass ( BeanUtils.java:164 ) at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate ( SimpleInstantiationStrategy.java:125 ) at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor ( ConstructorResolver.java:270 ) ... 34 more Caused by : java.lang.NoSuchMethodError : java.util.concurrent.ScheduledThreadPoolExecutor.setRemoveOnCancelPolicy ( Z ) V at com.zaxxer.hikari.pool.HikariPool. < init > ( HikariPool.java:146 ) at com.zaxxer.hikari.pool.HikariPool. < init > ( HikariPool.java:99 ) at com.zaxxer.hikari.HikariDataSource. < init > ( HikariDataSource.java:80 ) at sun.reflect.NativeConstructorAccessorImpl.newInstance0 ( Native Method ) at sun.reflect.NativeConstructorAccessorImpl.newInstance ( NativeConstructorAccessorImpl.java:39 ) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance ( DelegatingConstructorAccessorImpl.java:27 ) at java.lang.reflect.Constructor.newInstance ( Constructor.java:513 ) at org.springframework.beans.BeanUtils.instantiateClass ( BeanUtils.java:148 ) `` ` This method is not available in Java 6 , it is only present from Java 7 ( [ comparison between JDK_7 and JDK_6 ] ( http : //kdt.users.sourceforge.net/java/japi/JDK_6-JDK_7.html ) ) Is there anything I should be knowing ? or this needs some fix ? Similar issue reported [ here ] ( https : //github.com/almende/eve/issues/35 )
minimumIdle=0 means no limit ? __EoT__ I just want to obtain ` HikariDataSource ` with no connections initially as backup datasources , but I found that it still reach ` maximumPoolSize ` after a while when I never invoke ` getConnection ( ) ` on this dataSource . Then I found this piece of code : `` ` java @ Override public void addBagItem ( ) { class AddConnection implements Runnable { public void run ( ) { long sleepBackoff = 200L ; final int maxPoolSize = configuration.getMaximumPoolSize ( ) ; final int minIdle = configuration.getMinimumIdle ( ) ; while ( ! isShutdown & & totalConnections.get ( ) < maxPoolSize & & ( minIdle == 0 || getIdleConnections ( ) < minIdle ) ) { if ( ! addConnection ( ) ) { quietlySleep ( sleepBackoff ) ; sleepBackoff = Math.min ( 1000L , ( long ) ( ( double ) sleepBackoff * 1.5 ) ) ; continue ; } if ( minIdle == 0 ) { break ; // This break is here so we only add one connection when there is no min . idle } } } } addConnectionExecutor.submit ( new AddConnection ( ) ) ; }
Allow a custom ExecutorService to be set for each pool __EoT__ This allows for HikariCP to be used when a SecurityManager is in place , preventing/warning of the creation of threads not using the applications main ExecutorService . One such application is BungeeCord , you can see it 's security manager [ here ] ( https : //github.com/SpigotMC/BungeeCord/blob/master/proxy/src/main/java/net/md_5/bungee/BungeeSecurityManager.java ) . Currently it 's only warning of the action . I believe Android also has a similar limitation in place . Users of the library may also want to change the ExecutorService so that they can reuse it throughout their project .
HikariPool does not implement DynamicMBean __EoT__ Hi , Java 1.8u5 HikariCP 1.3.7 Spring 4.0.3.RELEASE Upgraded from 1.3.6 to 1.3.7 of HikariCP . I now get this exception on startup : `` ` 16:12:01.258 ] [ ] [ DEVELOPMENT ] [ WARN ] [ com.zaxxer.hikari.pool.HikariMBeanElf ] [ 69 ] - Unable to register management beans . javax.management.NotCompliantMBeanException : MBean class com.zaxxer.hikari.pool.HikariPool does not implement DynamicMBean , and neither follows the Standard MBean conventions ( javax.management.NotCompliantMBeanException : Class com.zaxxer.hikari.pool.HikariPool is not a JMX compliant Standard MBean ) nor the MXBean conventions ( javax.management.NotCompliantMBeanException : com.zaxxer.hikari.pool.HikariPool : Class com.zaxxer.hikari.pool.HikariPool is not a JMX compliant MXBean ) at com.sun.jmx.mbeanserver.Introspector.checkCompliance ( Introspector.java:176 ) ~ [ na:1.8.0_05 ] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean ( DefaultMBeanServerInterceptor.java:317 ) ~ [ na:1.8.0_05 ] at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean ( JmxMBeanServer.java:522 ) ~ [ na:1.8.0_05 ] at com.zaxxer.hikari.pool.HikariMBeanElf.registerMBeans ( HikariMBeanElf.java:60 ) ~ [ HikariCP-1.3.7.jar : na ] at com.zaxxer.hikari.pool.HikariPool. < init > ( HikariPool.java:128 ) [ HikariCP-1.3.7.jar : na ] at com.zaxxer.hikari.pool.HikariPool. < init > ( HikariPool.java:91 ) [ HikariCP-1.3.7.jar : na ] at com.zaxxer.hikari.HikariDataSource. < init > ( HikariDataSource.java:69 ) [ HikariCP-1.3.7.jar : na ] at sun.reflect.NativeConstructorAccessorImpl.newInstance0 ( Native Method ) [ na:1.8.0_05 ] at sun.reflect.NativeConstructorAccessorImpl.newInstance ( NativeConstructorAccessorImpl.java:62 ) [ na:1.8.0_05 ] at sun.reflect.DelegatingConstructorAccessorImpl.newInstance (
osgi : unit tests __EoT__
Optimize code width calculation in Code39Writer __EoT__ Every code39 character has 9 bars containing 3 wide bars , and separated by a white bar . ` ( 9-3 ) *1 + 3*2 + 1 = 13 `
Rewrite DataMatrix Detector __EoT__ In DataMatrixBlackBox2TestCase , only 8 of 18 images can read without rotation . So I rewrote the detector and got better score . Main idea of this PR is moving the corner points to near the center of the corner modules because detecting transitions on the edge is not stable .
Fix QR-code hanzi segment decoder __EoT__ Some hanzi characters ( ` A560 ` to ` AAFE ` on BG2312 ) could not be decoded , by wrong border value . The new value ` 0xA00 ` means ` 0xB0A1 - 0xA6A1 ` .
Set protocol to JABBER if XMPP IM handle is found __EoT__ IMPP field can be set [ to a URI ] [ 0 ] . If that URI is of XMPP scheme set the protocol used to JABBER and drop the scheme part from the IM handle . This format is used by XMPP messengers e.g . [ Conversations.im ] [ 1 ] . [ 0 ] : https : //tools.ietf.org/html/rfc6350 # section-6.4.3 [ 1 ] : https : //github.com/siacs/Conversations/blob/master/README.md # how-does-the-address-book-integration-work
Add QRCode lenient diagonal check __EoT__ Adding diagonal check to solve # 897 to prevent false positives for centers .
Fix null pointer exception in DecodeWorker.java __EoT__ Hey , I have fixed NullPointerException however I am not able to write the test as the code that was failing consist our customers data : ( However , after this fix the library finally reads code correctly .
asterisk is n't a valid character and should not be encoded as content with Code 39 . __EoT__ the following sample content results in an unreadable barcode : *123456789 because the asterisk is the start-stop character ( special meaning , not valid in content ) the really encoded value is **123456789* . The barcode reader stops after reading the second asterisk and throw the content away .
Update Basque translation __EoT__ I 'm the original Basque translator of Barcode Scanner for Android . I 've updated the translation .
Various small encoding improvements __EoT__ A couple related improvements from https : //groups.google.com/forum/ # ! topic/zxing/iCODr5bZKHk - UPC-E , EAN-13 and EAN-8 writers should add check digit if not present , like UPC-A does . - They should all check the check digit if provided and reject the barcode if it fails - The default margin for UPC/EAN barcodes should never result in a margin less than the mandated 9 modules - Experiment with less tolerance of small quiet zones
Aztec decoder fix : return to Upper mode after U/S B/S sequence . __EoT__ Fix [ issue # 642 ] ( https : //github.com/zxing/zxing/issues/642 ) ( Aztec decoding : incorrect decoding of codes with U/S B/S ) . This is a 1-line addition to core/src/main/java/com/google/zxing/aztec/decoder/Decoder.java Add test case core/src/test/resources/blackbox/aztec-1/dlusbs.png and matching .txt Change number of test cases . The original code fails tests for core on the added test case ; the source change fixes that .
Scan via browser URL seems to cache redirect and return to wrong location __EoT__ I have developed a simple web app we use for tracking boxes at work which updates a database . The boxes all have barcodes attached . This is somewhat simplified , but for the purposes of this bug report I have two pages in the web app : - Look up a box - Add a new box On the `` add a new box '' page I have a button which links to Barcode Scanner with a URL like : http : //zxing.appspot.com/scan ? ret=https % 3A % 2F % 2Fmyserver.example.com % 2Faddbox.php % 3F % 26xid % 3D % 7BCODE % 7D On the `` look up a box '' page I have a similar button but it links to a different URL : http : //zxing.appspot.com/scan ? ret=https % 3A % 2F % 2Fmyserver.example.com % 2Flookupbox.php % 3F % 26xid % 3D % 7BCODE % 7D However , I find if I go to `` add a new box '' , scan a barcode with a particular value ( does n't seem to matter what type of barcode , I 've reproduced with
PDF417 crashing occasionally . __EoT__ When using 4.6.1 and earlier I get an occasional crash bug . It occurs with pretty much any PDF417 ( on employee badges at a place I 'm working ) , and can scan the same badge properly 90 % of the time before crashing ... so it does n't seem like a problem with the barcode ... I think the stack trace indicates that it 's an issue with the bounding box it detects around the barcode , which makes sense as it often draws the green box around the wrong place ( like on the mirror image of the correct place when held upside-down , or something like that ) ... ! [ 2014-02-20 10 36 05 ] ( https : //f.cloud.github.com/assets/2808190/2219948/daa5596e-9a47-11e3-908d-abf4d1b02129.jpg )
feature request : switching to back camera for video calls __EoT__ I have : - [ x ] searched open and closed issues for duplicates - [ x ] read https : //github.com/WhisperSystems/Signal-Android/wiki/Submitting-useful-bug-reports It is difficult to point the camera at something other than oneself during a video call using the front camera because it is hard to get oneself out of the way while seeing the screen . It would be helpful to be able to switch between the front and back camera in the call to make it easier to show one 's surroundings .
Fix # 72 : Normalize private constructors on utility classes __EoT__ Yet another lawn edging .
Use auto for event classes __EoT__ From : https : //github.com/ReactiveX/RxAndroid/pull/57 We can clean up a lot of the event classes using [ auto ] ( https : //github.com/google/auto ) .
2.x : Fix Observable.flatMap to sustain concurrency level __EoT__ If the ` Observable.flatMap ` operator run in limited concurrency mode and multiple sources completed at the same time while the operator was in its drain loop , the operator only started with one new inner source instead of trying to run replace all the completed inner sources with new ones . The solution is to count the completed sources and replenish them in a loop . * ( The ` Flowable ` variant works properly because it uses backpressure and inner source counting already to replenish those completed inner sources . The ` Observable ` does n't have backpressure so it has to emulate it via the work-in-progress counting and the secondary queue for available inner sources . ) * Fixes : # 6282
2.x : Improve the Observable/Flowable cache ( ) operators __EoT__ This PR rewrites the ` Observable.cache ` and ` Flowable.cache ` operators to allocate less and be more up-to-date algorithmically . I 've also added comments to help understand its inner workings in case someone is interested . Resolves : # 6270
Add `` error handling '' java docs section to from callable & co __EoT__ Resolves # 6179 Added JavaDocs describing the regular and canceled/disposed behavior for - ` Observable.fromCallable ( ) ` - ` Single.fromCallable ( ) ` - ` Maybe.fromAction ( ) ` - ` Completable.fromCallable ( ) ` - ` Completable.fromAction ( ) ` - ` Flowable.fromCallable ( ) ` Did not alter ` Maybe.fromCallable ( ) ` because the existing JavaDoc appears to be adequate .
2.x : explain null observer/subscriber error reports in detail from RxJavaPlugins __EoT__ This PR is related to issue [ # 6172 ] ( https : //github.com/ReactiveX/RxJava/issues/6172 ) . With these changes , all reactive types will emit detailed error message when ` onSubscribe ` hook installed using RxJavaPlugins returns null ` observer/subscriber ` : **Observable** > `` The RxJavaPlugins.onSubscribe hook returned a null Observer . Please check the handler provided to RxJavaPlugins.setOnObservableSubscribe for invalid null returns . Further reading : https : //github.com/ReactiveX/RxJava/wiki/Plugins '' **Flowable** > The RxJavaPlugins.onSubscribe hook returned a null FlowableSubscriber . Please check the handler provided to RxJavaPlugins.setOnFlowableSubscribe for invalid null returns . Further reading : https : //github.com/ReactiveX/RxJava/wiki/Plugins **Single** > The RxJavaPlugins.onSubscribe hook returned a null SingleObserver . Please check the handler provided to RxJavaPlugins.setOnSingleSubscribe for invalid null returns . Further reading : https : //github.com/ReactiveX/RxJava/wiki/Plugins **Maybe** > The RxJavaPlugins.onSubscribe hook returned a null MaybeObserver . Please check the handler provided to RxJavaPlugins.setOnMaybeSubscribe for invalid null returns . Further reading : https : //github.com/ReactiveX/RxJava/wiki/Plugins **Completable** > The RxJavaPlugins.onSubscribe hook returned a null CompletableObserver . Please check the handler provided to RxJavaPlugins.setOnCompletableSubscribe for invalid null returns . Further reading : https : //github.com/ReactiveX/RxJava/wiki/Plugins **Note : ** There
2.x : The RxJavaPlugins JavaDocs HTML should be auto-cleaned up __EoT__ Some method entries of the ` RxJavaPlugins ` JavaDocs HTML looks misaligned , just like some other components used to : ! [ image ] ( https : //user-images.githubusercontent.com/1269832/44617428-50c2b880-a862-11e8-8161-59d9ae051ffc.png ) The fix is trivial : add the respective file , ` plugins/RxJavaPlugins.html ` to the gradle code : https : //github.com/ReactiveX/RxJava/blob/2.x/gradle/javadoc_cleanup.gradle # L13 You can verify the outcome by running ` ./gradlew clean javadocCleanup ` and checking the respective file in your browser . ( Note that probably there is no way to fix the long signature displays , only those unnecessary newlines ) .
2.x : Make observeOn not let worker.dispose ( ) called prematurely __EoT__ Some operators may call ` dispose ( ) ` / ` cancel ` from ` onError ` / ` onComplete ` which could trigger a permature call to ` worker.dispose ( ) ` that was about to happen anyway . This PR prevents this by moving the operator into its disposed/cancelled state before signaling the terminal event , thus a downstream ` cancel ( ) ` / ` dispose ( ) ` call wo n't trigger this premature cleanup . Such premature cleanups may cause unwanted ` Schedulers.io ( ) ` reuse in some scenarios . Related : # 6146
2.x : Cleaunp - rename fields to upstream and downstream __EoT__ This PR cleans up the field namings and some local variable namings : - Use ` upstream ` for the connection ` Disposable ` or ` Subscription ` instead of ` d ` , ` s ` , etc. , including ` AtomicReference < * > ` declarations . - Use ` downstream ` for the consumer field name in operators instead of ` actual ` for example . - Fix one-two letter abbreviated naming to match the type , such as ` Disposable s ` - > ` Disposable d ` , etc . The ` CheckLocalVariablesInTests ` has been extended with the relevant regexp checks .
Initial clean up for Combining Observables docs __EoT__ This patch updates the style of the combining observables documentation to be similar to that of # 6131 and adds examples for most of the operators therein . Refs # 6132 . What 's left for combining observables : - documentation for ` join ` , ` groupJoin ` , and ` rxjava-joins ` - add documentation for ` concat ` , ` concatEager ` , and ` withLatestFrom `
Fixed broken link under RxJS in docs/Additional-Reading.md __EoT__ Fix outdated links in the wiki docs .
2.x : Update Readme.md about the parallel ( ) operator __EoT__ Update wording on the now standard ` parallel ( ) ` operator in the getting started . Resolves : # 6110
Add marble diagram for Single.repeatUntil operator __EoT__ Here is marble for ` repeatUntil ` operator in # 5788 ! [ repeatUntil ] ( https : //raw.githubusercontent.com/UMFsimke/RxJava/Images/Images/RepeatUntil.png ) Please let me know if I need to change anything on the diagram itself . If not , please send me URL when you upload image within the project so I can change URL for the marble in the PR .
2.x : Add Completable.takeUntil ( Completable ) operator __EoT__ This PR adds the missing dedicated ` takeUntil ` operator to ` Completable ` . ! [ image ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/Completable.takeuntil.c.png ) Previously , the same effect could be achieved via the ` ambWith ` but there are two benefits of a dedicated operator : - easier to discover based on the ` takeUntil ` operator in other types - more direct implementation unlike ` ambWith ` which is built upon an N-ary ` amb ` operator with additional overhead . There was a feature request in # 3708 some time ago but apparently the issue got closed off after ` Single.takeUntil ` was implemented .
Add marble diagrams to the Single.delay method __EoT__ Here are marbles for ` delay ` operator in # 5788 Please let me know if I need to change anything on the diagram itself . If not , please send me URL when you upload image within the project so I can change URL for the marble in the PR .
Fix links for Single class __EoT__ * Change observable.html to single.html * Delete completable.html link which does n't exist
Implement 'toString ' method for some Emitters __EoT__ When use ` .create ` method it 's unclear why ` emitter ` is null ( if call ` toString ` or observe object via debugger ) .
2.x : Small cleanups in the Scheduler class __EoT__ - Remove ` @ NonNull ` from a primitive type - Make the package-private ` PeriodicDirectTask ` final - Add ` @ NonNull ` to other fields
2.x : clarify dematerialize ( ) and terminal items/signals __EoT__ Specify in both ` Flowable ` and ` Observable ` that a terminal notification item or a regular terminal signal ends the flow . Fixes : # 5261
2.x : Fix Flowable.window ( Publisher|Callable ) upstream handling __EoT__ This PR fixes the upstream handling in ` Flowable.window ( Publisher ) ` and ` Flowable.window ( Callable < Publisher > ) ` operators to make sure if both the main output and the inner windows have been cancelled , the upstream is also cancelled . Related : # 5887 , # 5881 . In addition , the Jacoco code coverage has been updated to 0.8.0 mainly due to the [ automatic filtering of difficult-to-impossible code paths ] ( https : //github.com/jacoco/jacoco/releases/tag/v0.8.0 ) .
2.x : Remove unnecessary comment from Observable.timeInterval ( TimeUnit ) __EoT__
2.x : Improve the wording of the Maybe.fromCallable JavaDoc __EoT__ This PR improves the wording and details of the ` Maybe.fromCallable ` operator 's JavaDoc .
2.x : More Observable marbles , 01/10-a __EoT__ More marbles for ` Observable ` : - [ retry ( int ) ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/retry.o.n.png ) - [ retry ( BiFunction ) ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/retry.o.ne.png ) - [ retry ( Predicate ) ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/retry.o.e.png ) - [ retry ( int , Predicate ) ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/retry.o.nfe.png ) - [ retryUntil ( BooleanSupplier ) ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/retryUntil.o.png ) - [ share ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/publishRefCount.o.png ) - [ switchMapSingle ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/switchMapSingle.o.png ) - [ switchMapSingleDelayError ] ( https : //raw.github.com/wiki/ReactiveX/RxJava/images/rx-operators/switchMapSingleDelayError.o.png ) Images in https : //github.com/ReactiveX/RxJava/issues/5319 # issuecomment-356560596 .
2.x : Upgrade to Reactive Streams 1.0.2 final __EoT__ Reactive Streams 1.0.2 just went final .
2.x : Subject NPE fixes , add UnicastProcessor TCK __EoT__ This PR adds the ` Subject.refCount ( ) ` and ` FlowableProcessor.refCount ( ) ` that capture the upstream 's ` Disposable ` / ` Subscription ` and disposes/cancels them if the number of ` Observer ` s/ ` Subscriber ` s decreases to zero . The Reactive-Streams TCK and thus other implementations may expect such behavior from a ` Processor ` implementation and this wrapper is required to pass the TCK tests . While implementing the TCK tests , it turned out the ` null ` -handling of the ` Subject ` s and ` FlowableProcessor ` s were not following the Reactive-Streams specification . They have to throw a ` NullPointerException ` immediately and not turn them into NPEs for the downstream . These classes and the tests have been fixed as well . Their error messages have been uniformed too .
2.x : RxJavaPlugins unwrapRunnable __EoT__ Hi , RxJava2 version : [ 2.1.6 ] It is reference to https : //github.com/ReactiveX/RxJava/issues/5733
2.x : fix javadoc for ConnectableFlowable and others __EoT__ Some javadoc fixes for ConnectableFlowable , GroupedFlowable and FlowableAutoConnect
2.x : make parallel ( ) a fusion-async-boundary __EoT__ The ` parallel ( ) ` supports front-fusion but since the operator is almost always followed by the separate ` runOn ` operator , the parallel version of the ` observeOn ` operator , such front-fusion should be considered a ` BOUNDARY ` -type fusion just like with ` observeOn ` . A ` requestFusion ` with ` BOUNDARY ` tells the upstream operator ( s ) that when fused , their actions would be executed behind an async boundary and possibly on an unwanted thread . Operators , such as ` map ` and ` doOnNext ` , who are generally expected to be thread-confined , can then refuse to fuse , restoring the traditional queue hopping behavior ( ` source - > queue - > op - > queue - > op - > queue - > consumer ` ) . Reported in # 5676 . /cc @ smaldini & @ simonbasle
2.x : add onTerminateDetach to Single and Completable __EoT__ This PR adds the ` onTerminateDetach ` operator to ` Single ` and ` Completable ` . It was available on ` Flowable ` , ` Observable ` and ` Maybe ` already . Plus : - Fixes the javadoc for ` Maybe.onTerminateDetach ` - Adds unit tests for verifying terminal events do release references with ` Maybe ` as well . Their non-existence came up on [ StackOverflow ] ( https : //stackoverflow.com/questions/46397082/disposablecompletableobserver-leaking-activity-even-though-im-clearing-composit ? noredirect=1 # comment79870549_46397082 ) . **Update** Turns out the downstream 's ` actual ` references were not cleared in ` Maybe ` after all . Updated the PR to ensure that in all 3 of them and improved coverage .
2.x : Fix Observable.concatMapEager queueing of source items __EoT__ This PR fixes the wrong queue type in ` Observable.concatMapEager ` to be the ` SpscLinkedArrayQueue ` instead of the ` SpscArrayQueue ` ( the latter basically ignored items from the main source when it got full - a remnant from its bounded ` Flowable ` cousin ) . Unit tests added that ensure both ` Flowable ` and ` Observable ` variants work properly . Reported in : # 5608
Implement LambdaConsumerIntrospection __EoT__ Followup from # 5569 , and allows you to introspect if the resulting observer has missing error consumption and subsequently supplies a default ( throwing ) one .
2.x : fix ReplayProcessor backpressure and NotificationLite emission bug __EoT__ This PR upgrades the replaying algorithms of the ` ReplayProcessor ` to the standard queue-drain and as an added effect , fixes a request-emission race where the internal ` NotificationLite.complete ` could be emitted to the consumers .
FlowableWithLatestFrom forgets request __EoT__ The following scenario did not work with FlowableWithLatestFrom : Flowable < ? > result = source.combineWithLatest ( other , someCombiner ) - client subscribe to the result stream - source stream emits - other stream emits - source stream emits expected result : result stream emits the combined event actual result : result stream does not emit anything
combineLatest ( Iterable < Publisher < > > , Function < > ) not emitting on empty iterable __EoT__ I am using RxJava 2.10 and operator io.reactivex.Flowable # combineLatest ( java.lang.Iterable < ? extends org.reactivestreams.Publisher < ? extends T > > , io.reactivex.functions.Function < ? super java.lang.Object [ ] , ? extends R > ) but I 've seen this behavior in 1.x as well . Overload of combineLatests ( and combineLatestsDelayError ) that takes Iterable of Publishers is not emitting any items and 'combiner ' function passed to it is not called when iterable is empty . For this operator I would expect it to scale linearly , that is : - If I pass Iterable of size 2 as a first argument I expect an Array of size 2 to be passed to combiner function - If I pass Iterable of size 1 as a first argument I expect an Array of size 1 to be passed to combiner function - If I pass Iterable of size 0 as a first argument I expect an Array of size 0 to be passed to combiner function
Remove @ NonNull annotation in Consumer method parameter __EoT__ This fixes # 5442
2.x : attempt to fix a few time-sensitive tests . __EoT__ As of lately , the Travis CI runs much slower than usual and causes some time-sensitive tests to fail for some reason . This PR tries to figure out why this happens .
2.x : add subscribeOn overload to avoid same-pool deadlock with create __EoT__ This PR adds an overload to ` subscribeOn ` that exposes the existing feature to optionally request on the same scheduler where the subscription happened . This is necessary to avoid same-pool deadlock when the upstream contains ` create ` logic that blocks the emission thread , preventing any scheduled request to get through and leading to excess buffering or dropping data excessively . By not scheduling the request , it can directly update the emitter 's request tracking and let the emitter continue . Formerly , the existing ` subscribeOn ` automatically disabled scheduling the requests if the immediate upstream was a ` FlowableCreate ` . However , if there were operators between ` create ` and ` subscribeOn ` ( as often happening on Android with composing the schedulers at the end of the chain ) , the ` subscribeOn ` operator run in scheduled request mode by default . This change allows specifying this behavior through the new overload and thus distance between the ` create ` and ` subscribeOn ` operators no longer matters . ( Note that 1.x already has this overload .
2.x : add tryOnError to create/XEmitter API __EoT__ This PR adds the ` tryOnError ` method to the various ` Emitter ` types used in the ` create ` operators that allows the developer to avoid the ` UndeliverableException ` in case a cancellation is racing with the emission of an error . The return value indicates a success of the delivery ; in case of ` false ` , the developer can decide to log/drop the specific error if that makes sense for him/her .
2.x : improve coverage of some classes ( no functional changes ) __EoT__ Improve the coverage of some classes , plus re-add the unit test that validates the ` StrictSubscriber ` . Only test changes , no functional changes .
Correct documented return type of Single # flatMapObservable Function argument __EoT__ The argument of ` Single # flatMapObservable ` clearly states that it is expecting a ` Function ` which returns an ` ObservableSource ` but the documentation contradicts that .
Correct java doc for refCount ( ) return type . v2.0.7 __EoT__ Java doc for ` ConnectableObservable.refCount ( ) ` says it returns a ` Flowable ` , but it should be ` Observable `
Removes all anonymous inner classes __EoT__ This is a what left to complete [ this one ] ( https : //github.com/ReactiveX/RxJava/pull/5174 ) : - Removes all AICs - Issue [ # 5150 ] ( https : //github.com/ReactiveX/RxJava/issues/5150 )
2.x : improve BaseTestConsumer with awaitCount & timeout __EoT__ This PR enhances the timeout detection and reporting of the ` TestSubscriber ` / ` TestObserver ` base class ` BaseTestConsumer ` : - ` awaitCount ( int atLeast [ , Runnable waitStrategy [ , timeout ] ] ) ` : wait until at least the given amount of onNext events have been observed or the upstream terminated . - Enhance ` awaitX ` methods to set a ` timeout ` flag . - Show the ` timeout ! ` string in the assertion failures set by the ` awaitX ` methods . - Show the ` disposed ! ` string in the assertion failures if the consumer has been cancelled/disposed . - ` assertTimeout ` and ` assertNoTimeout ` to assert explicitly after an ` awaitX ` method . - ` isTimeout ` and ` clearTimeout ` to check and clear the flag status . In addition , the internal array that collects the items has been replaced with a new custom ` List ` implementation : ` VolatileSizeArrayList ` that makes sure ` size ( ) ` is a volatile read and happens before the committing the size in
2.x : fix scan ( seed , f ) to emit accumulated values asap __EoT__ For performance reasons , the ` scan ` delayed the emission of accumulated items by one which worked well with sources that pushed new items frequently . Unfortunately , if the source stopped emitting ( without completion ) , the very last accumulated item was stuck and no way to get it out of ` scan ` . I considered this type of use being rare but apparently I was wrong . The PR changes ` scan ` to emit accumulated items , including the initial seed , as soon as there is request for it . The operator now uses a stable-prefetch queue-drain found throughout other operators such as ` observeOn ` . Remark : sadly , request trickery such as capturing the first ` request ` call , emitting the seed and then requesting n - 1 does n't work because if the ` request ( ) ` call itself happens from another thread and the source is empty , the ` onNext ` and ` onComplete ` could run concurrently . Reported in # 5089
2x : Removed documentation leftover __EoT__ ... that wrongly states that the error will be swallowed . As discussed in # 5036
2.x : fix cross-boundary invalid fusion with observeOn , flatMap & zip __EoT__ When ` flatMap ` and ` zip ` fuses its sources , it was possible one of the async source polls on another source which executed boundary-sensitive operators ( ` map ` , ` filter ` ) on the wrong thread . For clarity , here is a diagram showing the execution flow of a classical and fused setup : ! [ image ] ( https : //cloud.githubusercontent.com/assets/1269832/21883621/536a123c-d8b0-11e6-9a7a-b6deb2ffb26b.png ) In the classical flow , everything is push and when flatMap collects the available elements , all side-effects happened inside ` map ` . In the fused flow , there are no queues and the onNext call is an indication to ` poll ( ) ` on the sources inside ` flatMap ` ( or zip ) . If the first source triggers onNext , that source is correctly polled and ` map ` executes on the right thread . However , when the flatMap continues to collect other available elements , it polls on the other source and executes that ` map ` still on the first scheduler , despite that source having its own scheduler specified
Improve compose ( ) generics __EoT__ Resolves # 4950 I tested and built with the added tests on Java 6 , 7 , and 8 . Not sure if you want to keep them in before merging since they 're not really functional in nature , just there to make sure they compile .
2.x : add subjects for Single , Maybe and Completable __EoT__ This PR adds 3 new subject types : ` SingleSubject ` , ` MaybeSubject ` and ` CompletableSubject ` . Their purpose is to provide an imperative way to multicast 0-1-error events as well as cache these events for later observers . They are thread-safe by design and there is no need for a serialized wrapper unlike the other ` Subject ` s .
2.x : doAfterNext - prevent post-error calls to consumer __EoT__ This PR * prevents further calls to the consumer if an error has been thrown
2.x : dedicated reduce ( ) op implementations __EoT__ This PR adds dedicated operator implementations to - ` Flowable.reduce ( seed , reducer ) ` ( returns ` Single ` ) , - ` Flowable.reduceWith ( seedSupplier , reducer ) ` ( returns ` Single ` ) , - ` Observable.reduce ( reducer ) ` ( returns ` Maybe ` ) , - ` Observable.reduce ( seed , reducer ) ` ( returns ` Single ` ) and - ` Observable.reduceWith ( seedSupplier , reducer ) ` ( returns ` Single ` ) instead of using ` scan ( ) .takeLast ( 1 ) ` ( ` Flowable.reduce ( reducer ) ` already had a dedicated operator ) . Comparison ( Celeron 1005M , 4GB RAM , Windows 7 x64 , Java 8u112 , JMH 1.16 ) : ! [ image ] ( https : //cloud.githubusercontent.com/assets/1269832/20644317/a411f9ba-b430-11e6-8fa7-0db5195f4ddd.png ) The new ` ReducePerf ` benchmark does a simple sum over a list of integer values . Unfortunately , this creates a lot of garbage for longer sequences ( plus the CPU/RAM is not really suited for such benchmarks ; the ` flowMaybe ` lines should be roughly the same since the code
2.x : fix Flowable.concatMapEager hang due to bad request management __EoT__ ` Flowable.concatMapEager ` 's drain loop when encountering a finished inner jumped back to the beginning of the loop but disregarded the potentially changed request amount and just stopped emitting . The fix is to use the typical request management approach of reading the current request at the beginning of the loop and then committing the emission amount before trying to leave the loop . Related : # 4620 In addition ` TestHelper.assertError ` has been changed to attach the whole unexpected exception to the ` AssertionError ` .
New 2.x marble diagrams __EoT__ Adds some new marble diagrams and adjusts some for operators that now return Single/Maybe/Completable where they used to return Observable in 1.x .
2.x : coverage , fixes , cleanup 10/15-1 __EoT__ - improve coverage of ` Observable ` operators - remove unnecessary code paths - fix ` publish ( Function ) ` latecommer behavior - remove ` bufferSize ` overloads of ` publish ` as there is no need to buffer anything for an ` Observable ` - simplify ` Observable.publish `
2.x : coverage , cleanup fixes 10/14-1 __EoT__ - improve coverage of ` Observable ` operators - remove impossible or unused code paths - fix ` Observable.flatMap ` 's dispose behavior and error accumulation
2.x : CompositeException fix order of Exceptions __EoT__ After looking at # 4692 I found a few more exceptions which were passed in the wrong order to CompositeException .
2.x : coverage and cleanup 10/04-1 __EoT__ - Improve coverage - remove unused , unnecessary or impossible code paths - fix order of inner exceptions in the reported ` CompositeException ` in various operators - ` Maybe.ignoreElement ( ) ` now returns ` Completable `
2.x : fix Mockito 2.1 changes using deprecated API of its own __EoT__ ` anyListOf ( ) ` is deprecated in Mockito 2.1.0-RC.2 and the GitHub diff ca n't show such uses . ( In addition , there was a missing ` serialVersionUID ` in another PR . )
2.x : Replace 'resource ' observers with plain 'disposable ' observers in tests . __EoT__ This makes the resource observers unused internally and I 'm curious as to whether they deserve to stick around in the public API . Any thoughts ?
2.x : Sync behaviour between UnicastProcessor & UnicastSubject + add a few test cases __EoT__
2.x : add most relevant ~100 operators ' Reactive-Streams TCK tests __EoT__ This PR adds about ~100 Reactive-Streams Test Compatibility Kit ( TCK ) tests of RxJava 's most relevant operators and operation modes . The PR also contains a behavior fix for ` unsubscribeOn ` that now stops propagating events if the cancelled because it may take arbitrary time for the scheduled cancellation to reach the upstream which generally keeps emitting in the meantime .
2.x : Fix MaybeTimber by using scheduler and unit __EoT__ Also one question why does ` CompletableTimer ` check ` if ( ! sd.isDisposed ( ) ) { ` before replacing but SingleTimer does not ? I adjusted MaybeTimber to SingleTimer so I did n't add the check there either . However I feel like this should be consistent , can you elaborate which one is wanted ?
2.x : more cleanup and fixed checker , Maybe.takeUntil __EoT__ - Fix missed javadoc mistakes , fix the checker that hid those mistakes in instance methods ' javadoc due to a bug - add ` Maybe.takeUntil `
2.x : PublishSubject enhance NPE when onNext ( null ) is called __EoT__
2.x : Adjust some JavaDoc in Emitters __EoT__
2.x : Remove trailing whitespace __EoT__ Removed them like this : ` find . -type f -name `` *.java '' | xargs sed -i `` -e's/ [ \t ] * $ // ' `` $ 1 '' ` I think it 's best to review this locally or by appending ` ? w=1 ` to this URL to let GitHub ignore white space changes .
2.x : reduce blockingX overhead , move internal observers to common pkg __EoT__ This PR compacts the ` blockingX ` operators by extending ` CountDownLatch ` and implementing ` SingleObserver ` , ` CompletableObserver ` and ` MaybeObserver ` with the necessary blocking await mechanics . Benchmark comparison ( i7 4770 , Windows 7 x64 , Java 8u102 ) : ! [ image ] ( https : //cloud.githubusercontent.com/assets/1269832/18291535/868c4d6a-7488-11e6-99f7-43415f79e5e4.png ) In addition , the internal package ` subscribers.single ` and ` subscribers.completable ` has been removed and the classes moved into ` io.reactivex.internal.observers ` package . The old blocking enum helpers were removed as well . The ` BlockingSingleSubscriber ` and ` BlockingSingleObserver ` abstract classes have been renamed to ` BlockingBaseX ` to avoid name confusion ( they have nothing to do with the ` Single ` type ) .
2.x : rename emitters # isCancelled to # isDisposed __EoT__ Renames Observable/Single/CompletableEmitter # isCancelled to # isDisposed . This now causes a bit of a weird situation where most ( not all ) Emitter classes implement ` Disposable ` as well , so both interfaces expose the same ` # isDisposed ` method . Before the ` # isCancelled ` methods were basically just calling ` # isDisposed ` or had the same implementation . Suggestions on how to improve this ?
2.x : Add doOnEvent to Single & Completable __EoT__
Fix typo Javadocs TestObserver __EoT__
2.x : coverage and fixes 9/03-2 __EoT__ - enable fusion with ` Observable.map ` - remove impossible branches in some classes - add more tests to cover tool classes - fix ` Observable.range ( ) ` entering regular emission if fusion-drain is interrupted - fix ` FullArbiter ` and ` ObservableFullArbiter ` not cancelling/disposing the incoming Subscription/Disposable in some cases
2.x : start reimplementing Maybe with up-to-date javadoc , tests and algo __EoT__ This PR reimplements the ` Maybe ` with more up-to-date algorithms ( the original was a copy-paste of some older Single and Completable code it seems ) and adds javadoc and tests along the way . Not all operators have been rewritten yet ( and no placeholders ) . Early adopters should refer to the ` toX ` methods on the base reactive types . The PR also adds the ` RxJavaPlugins ` hooks to support ` Maybe ` . In addition , I 've fixed javadoc mistakes in the other base reactive types ( referring to the wrong types ) .
2.x collect - handle post terminal events __EoT__ Just looking at moving some recent 1.x bug fixes and tests over to 2.x . This is my first PR in 2.x so before I proceed adding more tests from 1.x ( to this PR ) I want to get some feedback on my approach . In particular in the test ` testCollectorFailureDoesNotResultInTwoErrorEmissions ` is the ` Flowable ` creation method ok ?
2.x : add missing ops , cleanup , fusion fixes __EoT__ Notable changes : - Implement ` concatEager ` and its variants - Implement ` onTerminateDetach ` - Implement ` distinctUntilChanged ( BiPredicate ) ` - Replace ` EmptyDisposable.INSTANCE ` with ` Disposables.empty ( ) ` due to clash with fusion ( sending an INSTANCE tells a fusion-enabled source to not expect onNext values yet the test still send those - this was a problem with EmptySubscription.INSTANCE a while back too ) . Also added javadoc warning about its use - add ` ObservableScalarXMap ` optimization to ` Observable.xMap ( Function ) ` and their operator 's ` subscribeActual ` - Make ` ObservableJust ` ` ScalarCallable ` and sync-fuseable with ` ScalarDisposable ` ( similar to ` Flowable.just ( ) ` ) - Make ` Observable.bufferSize ( ) ` public for convenience . - Fix ` flatMap ` fused ` Callable ` handling - Renamed ` Objects ` to ` ObjectHelper ` to avoid accidental bad imports of ` java.util.Objects ` of Java 8 .
2.x : Avoid potential NPE when onError throws . __EoT__ t2 was only initialized if canceling threw an exception . In the happy path it would have never been initialized so when onError threw the call to suppress ( ) would NPE .
Add missing @ Test annotation __EoT__ This annotation has been accidentally omitted when resolving a conflict during the merging of : 96feb27e1b90cb93a64295de077cffb1a7d9ea9b and 98cccec27252f30578cd3cf1b7aeddcb9837a2fd into : d6bf9d15c6802c74d8e5a3fc4f908a2d01d3d335 We made PRs for both versions 1.x and 2.x . We found the missing annotation while processing RxJava 's git repository using a tool for structured code merge that we 're developing as part of the Envision IDE : www.pm.inf.ethz.ch/research/envision.html
2.x : Extract 'WithUpstream ' interfaces . __EoT__ This allows use with types that do not extend directly from their base stream types .
2.x : Skip static factories when converting between stream types . __EoT__ Also rename Publisher- > Completable factory method and operator implementation to match other stream types .
2.x : Normalize empty and never sources . __EoT__
2.x : Rename source/publisher wrapper class to more semantic 'from ' name . __EoT__
2.x : Promote lift implementations to top-level types . __EoT__
2.x : Observable.range fix Exception message __EoT__
2.x : Functional interfaces now throw __EoT__ It had a bit of a cascading effect .
2.x : enable scalar and async fuseable sources and intermediates __EoT__ This PR enables operator fusion for scalar and knowingly single-element sources . There are no fusion-consumers yet .
2.x : fix flaky tests __EoT__ This PR should fix some test timing out otherwise sensitive to thread hiccups . # 4138 # 4109 # 4054
2.x : convert Observable OnSubscribe to direct implementation __EoT__ First part of converting the OnSubscribe operators of ` Observable ` into direct implementors of ` Observable ` - saves allocation . Do n't worry about the unnecessary parenthesis , will be removed in a future PR .
2.x : More uses of SubscriptionHelper . __EoT__
2.x : first step switching to the reduced-allocation architecture __EoT__ This is the first step towards the new architecture where operator implementations are themselves of the base type instead of a 2-3 layer indirection as in 1.x . This PR removes the instance field ` onSubscribe ` from the base reactive classes and introduces ` subscribeActual ` to be overridden with the custom operator logic now on . Existing operators are still working through the classical OnSubscribe/Lift indirection and will be updated in subsequent PRs . Naming and existence of ` subscribeActual ` is up for ( post-merge ) discussion . To recap , the method is needed so that the default ` subscribe ` method can be made final and ensure plugin hooks can be called ( once available ) . The method is protected and only affects operator implementors that chose to extend the base reactive classes directly . The alternative is to leave ` subscribe ` abstract and add a hook to every operator method ( for example , see [ this ] ( https : //github.com/reactor/reactive-streams-commons/blob/master/src/main/java/rsc/publisher/Px.java # L50 ) and [ this ] ( https : //github.com/reactor/reactive-streams-commons/blob/master/src/main/java/rsc/publisher/Px.java # L162 ) .
Bug in OnSubscribeFromIterable unsubscribed child logic __EoT__ Hello The code is missing an additional check for child unsubscription after calling the iterator next method . This is needed when using in conjunction with operators like take , that unsubscribes itself in the onNext method . Regards
TrampolineScheduler NullPointerException __EoT__ There is an issue in TrampolineScheduler on 0.20.4 where it can throw a NullPointerException in InnerCurrentThreadScheduler ` enqueue ( Action0 action , long execTime ) ` `` ` java private Subscription enqueue ( Action0 action , long execTime ) { if ( innerSubscription.isUnsubscribed ( ) ) { return Subscriptions.empty ( ) ; } PriorityQueue < TimedAction > queue = QUEUE.get ( ) ; final TimedAction timedAction = new TimedAction ( action , execTime , COUNTER_UPDATER.incrementAndGet ( TrampolineScheduler.this ) ) ; queue.add ( timedAction ) ; if ( wip.getAndIncrement ( ) == 0 ) { do { queue.poll ( ) .action.call ( ) ; } while ( wip.decrementAndGet ( ) > 0 ) ; return Subscriptions.empty ( ) ; } else { // queue was n't empty , a parent is already processing so we just add to the end of the queue return Subscriptions.create ( new Action0 ( ) { @ Override public void call ( ) { PriorityQueue < TimedAction > _q = QUEUE.get ( ) ; if ( _q ! = null ) { _q.remove ( timedAction ) ; } } } ) ; } } `` ` The Exception happens on ` queue.poll (
Exception Doc Comments __EoT__ Sorry for the copy & paste , but that shows all doc comments for exceptions . My proposal would be to make the descriptions uniform and start each with `` Represents ... '' ~~CompositeException~~ ~~An Exception that is a composite of one or more other Exceptions.~~ CompositeException Represents an an exception that is a composite of one or more other Exceptions . ~~MissingBackpressureException MissingBackpressureException indicates that a Subscriber or operator attempted to apply reactive pull backpressure to an Observable that does not implement it.~~ MissingBackpressureException Represents an exception that indicates that a Subscriber or operator attempted to apply reactive pull backpressure to an Observable that does not implement it . ~~OnErrorFailedException Used to re-throw errors thrown from Observer.onError ( Throwable ) .~~ OnErrorFailedException Represents an exception used to re-throw errors thrown from Observer.onError ( Throwable ) . ~~OnErrorNotImplementedException Used to re-throw Observer.onError ( Throwable ) when an implementation does n't exist~~ . OnErrorNotImplementedException Represents and exception used to re-throw Observer.onError ( Throwable ) when an implementation does n't exist . OnErrorThrowable Represents a Throwable that an Observable might notify its subscribers of , but that then can be handled by an operator that is designed to
RxScala Bug __EoT__ `` ` scala def wrap [ T ] ( src : Observable [ T ] ) : Observable [ T ] = { Observable ( subscriber = > { println ( `` subscribed '' ) subscriber.add ( src.subscribe ( x = > subscriber.onNext ( x ) , e = > subscriber.onError ( e ) , ( ) = > subscriber.onCompleted ( ) ) ) } ) } `` ` works but this crashes `` ` scala def wrap [ T ] ( src : Observable [ T ] ) : Observable [ T ] = { Observable ( subscriber = > { println ( `` subscribed '' ) subscriber.add ( src.subscribe ( subscriber ) ) } ) } `` `
Operator : DefaultIfEmpty __EoT__ http : //msdn.microsoft.com/en-us/library/hh229332 ( v=vs.103 ) .aspx http : //msdn.microsoft.com/en-us/library/hh229624 ( v=vs.103 ) .aspx
Operator : SkipWhile __EoT__ http : //msdn.microsoft.com/en-us/library/hh229685 ( v=vs.103 ) .aspx http : //msdn.microsoft.com/en-us/library/hh211631 ( v=vs.103 ) .aspx
Operator : Interval __EoT__ http : //msdn.microsoft.com/en-us/library/hh229027 ( v=vs.103 ) .aspx http : //msdn.microsoft.com/en-us/library/hh228911 ( v=vs.103 ) .aspx
Update androidx to 1.0.0-rc02 __EoT__
kt generation files with package name ` in ` Do n't automatically add tilda and hence compilation fails __EoT__ # # Overview - If we have a package name with ` in ` build fails # # # Expected - Generated files should automatically have Tilda appended # # # Actual - The package name does n't have Tilda appended so that builds do n't fail # # Environment -- v 3.0.1 on Kotlin file ( MainActivity.kt )
@ OnNeverAskAgain not being called __EoT__ Annotating a method with @ OnNeverAskAgain is not called . What is called is the method annotated with @ OnPermissionDenied . I think the generated code conditions checks are incorrect . `` ` java static void onRequestPermissionsResult ( BaseActivity target , int requestCode , int [ ] grantResults ) { switch ( requestCode ) { case REQUEST_INITIALIZESCANNING : // this would always be true if the permission was denied and on never ask again if ( ! PermissionUtils.hasSelfPermissions ( target , PERMISSION_INITIALIZESCANNING ) ) { target.showDenied ( ) ; return ; } if ( PermissionUtils.verifyPermissions ( grantResults ) ) { target.initializeScanning ( ) ; } else { if ( ! PermissionUtils.shouldShowRequestPermissionRationale ( target , PERMISSION_INITIALIZESCANNING ) ) { target.showNeverAsk ( ) ; // this is NEVER called } else { target.showDenied ( ) ; } } break ; default : break ; } } `` ` Thanks . Great work BTW .
TinkerMultidexConfigTask : FileNotFoundException ( manifest_keep.txt ) __EoT__ 异常类型：编译异常 **tinker版本：1.9.0** gradle版本：4.1 **Android gradle plugin版本：3.0.0** 是否使用热更新SDK：否 系统：Mac & Windows 说明： 使用以下几种操作，会遇到此异常 1 . Android Studio 3.0 中，直接执行**菜单栏中的 rebuild project**，出错 2 . 在Android Studio 的Gradle Task管理栏中，先执行 clean，再执行 assembleDebug，出错 3 . 终端中先执行gradle clean 再执行 gradle assembleDebug，出错（其实和2是一样的） 有两种情况可以编译通过 1 . Androig Gradle plugin 使用 3.0.0，执行Android Studio**菜单栏中的clean**，任务完全执行结束后，直接run，是可以的。 2 . Androig Gradle plugin 使用低于3.0.0的版本，比如 2.3.3，是正常的 堆栈/日志： **重点部分：** : Android_Client : generateDebugAssets : Android_Client : mergeDebugAssets : Android_Client : tinkerProcessDebugMultidexKeep try update tinker multidex keep proguard file with /Users/vilsteven/WorkSpace/Android_TCTravel/Android_Client/build/intermediates/tinker_intermediates/tinker_multidexkeep.pro FAILED FAILURE : Build failed with an exception . * What went wrong : Execution failed for task ' : Android_Client : tinkerProcessDebugMultidexKeep ' . > java.io.FileNotFoundException : /Users/vilsteven/WorkSpace/Android_TCTravel/Android_Client/build/intermediates/multi-dex/debug/manifest_keep.txt ( No such file or directory ) 。。。 Caused by : java.io.FileNotFoundException : /Users/vilsteven/WorkSpace/Android_TCTravel/Android_Client/build/intermediates/multi-dex/debug/manifest_keep.txt ( No such file or directory ) at com.tencent.tinker.build.gradle.task.TinkerMultidexConfigTask.updateTinkerProguardConfig ( TinkerMultidexConfigTask.groovy:114 ) at org.gradle.internal.reflect.JavaMethod.invoke ( JavaMethod.java:73 ) **完整：** : Android_Client : splitsDiscoveryTaskDebug : Android_Client : tinkerProcessDebugManifest tinker add tinker_id_44273a4 to your AndroidManifest.xml /Users/vilsteven/WorkSpace/Android_TCTravel/Android_Client/build/intermediates/manifests/full/debug/AndroidManifest.xml tinker gen AndroidManifest.xml in build/intermediates/tinker_intermediates/AndroidManifest.xml : Android_Client : tinkerProcessDebugResourceId apply resource mapping file /app-debug-1102-10-11-38-R.txt is illegal , just ignore : Android_Client : compileDebugNdk NO-SOURCE : Android_Client : mergeDebugShaders : Android_Client : compileDebugShaders : Android_Client : generateDebugAssets : Android_Client : mergeDebugAssets : Android_Client :
bug fix , change filed_methods to field_methods __EoT__
DISCOVERY : Fix RollingUpgradeTests __EoT__ * Do n't manually manage min master nodes * Regarding the issue asking to use file based discovery : This already happens . We are passing the transportURIs in a hacky way via the node property and they are written to the discovery file in ` 6.5 ` and newer so I do n't think we have to do anything about that here . * Remove some dead code * Closes # 35178
ILM API ref edits __EoT__ Pulled the common pieces out into shared files and edited for consistency .
Move compression config to ConnectionProfile __EoT__ This is related to # 34483 . It introduces a namespaced setting for compression that allows users to configure compression on a per remote cluster basis . The ` transport.tcp.compress ` remains as a fallback setting . If ` transport.tcp.compress ` is set to true , then all requests and responses are compressed . If it is set to false , only requests to clusters based on the ` cluster.remote.cluster_name.transport.compress ` setting are compressed . However , after this change regardless of any local settings , responses will be compressed if the request that is received was compressed .
RollupDocumentationIT.testStartRollupJob fails __EoT__ https : //elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=debian/42/console `` ` 12:57:00 ERROR 0.36s | RollupDocumentationIT.testStartRollupJob < < < FAILURES ! 12:57:00 > Throwable # 1 : org.elasticsearch.client.ResponseException : method [ DELETE ] , host [ http : // [ : :1 ] :52535 ] , URI [ /_xpack/rollup/job/job_1 ] , status line [ HTTP/1.1 500 Internal Server Error ] 12:57:00 > { `` task_failures '' : [ { `` task_id '' :8905 , '' node_id '' : '' FhzPJ_ibQoS6vX9AbmETzA '' , '' status '' : '' INTERNAL_SERVER_ERROR '' , '' reason '' : { `` type '' : '' illegal_state_exception '' , '' reason '' : '' Could not delete job [ job_1 ] because indexer state is [ STOPPING ] . Job must be [ STOPPED ] before deletion . `` } } ] , '' acknowledged '' : false } 12:57:00 > at __randomizedtesting.SeedInfo.seed ( [ 8485FBE4F308CC81 : EB88BE3030DD61E3 ] :0 ) 12:57:00 > at org.elasticsearch.client.RestClient $ SyncResponseListener.get ( RestClient.java:687 ) 12:57:00 > at org.elasticsearch.client.RestClient.performRequest ( RestClient.java:218 ) 12:57:00 > at org.elasticsearch.client.documentation.RollupDocumentationIT.deleteRollupJobs ( RollupDocumentationIT.java:437 ) 12:57:00 > at org.elasticsearch.client.documentation.RollupDocumentationIT.wipeRollup ( RollupDocumentationIT.java:417 ) 12:57:00 > at java.lang.Thread.run ( Thread.java:748 ) `` ` Reproduce line ( though does not repro locally )
[ TEST ] Cleanup FileUserPasswdStoreTests __EoT__ The file realm has not supported custom filenames/locations since at least 5.0 , but this test still tried to configure them . Remove all configuration of file locations , and cleaned up a few other warnings and deprecations
Scripting : Add back lookup vars in score script __EoT__ The lookup vars under params ( namely _fields and _source ) were inadvertently removed when scoring scripts were converted to using script contexts . This commit adds them back , along with deprecation warnings for those that should not be used .
[ ILM ] rolling upgrade tests __EoT__ This is a re-boot of the previous PR against ` index-lifecycle ` that needed to be reverted due to CI bwc issues . https : //github.com/elastic/elasticsearch/pull/32828 original description : > Adds basic rolling upgrade tests to check that lifecycles are still recognizable between rolling cluster upgrades and managed indices stay managed . > > This is a placeholder for discussing types of checks so they are ready once we backported The commit was cherry-picked and updated to reflect the change from [ minimum_age to min_age ] ( https : //github.com/elastic/elasticsearch/pull/35058 ) . https : //github.com/elastic/elasticsearch/pull/35058
Apply ` ignore_throttled ` also to concrete indices __EoT__ Today we only apply ` ingore_throttled ` to expansions from wildcards , date math expressions and aliases . Yet , this is tricky since we might have resolved certain expressions in pre-filter steps like security . It 's more consistent to apply this logic to all expressions including concrete indices . Relates to # 34354
SQL : Upgrade jline to version 3.8.2 __EoT__ Upgrade jline to version 3.8.2
[ ilm ] change remove-policy-from-index http method from DELETE to POST __EoT__ The remove-ilm-from-index API was using the DELETE http method to signify that something is being removed . Although , metadata about ILM for the index is being deleted , no entity/resource is being deleted during this operation . POST is more in line with what this API is actually doing , it is modifying the metadata for an index . cc @ bmcconaghy
Include realm type in Security Realm setting keys __EoT__ This moves all Realm settings to an Affix definition . However , because different realm types define different settings ( potentially conflicting settings ) this requires that the realm type become part of the setting key . Thus , we now need to define realm settings as : xpack.security.authc.realms : file.file1 : order : 0 native.native1 : order : 1
Add dedicated step for checking shrink allocation status __EoT__ This adds a new step for checking whether an index is allocated correctly based on the rules added prior to running the shrink step . It also fixes a bug where for shrink we are not allowed to have the shards relocating for the shrink step . This also allows us to simplify AllocationRoutedStep and provide better feedback in the step info for why either the allocation or the shrink checks have failed . Resolves # 34938
Refactor : Remove unused settings from transport action CTOR __EoT__ As settings are not used in the transport action constructor , this removes the passing of the settings in all the transport actions . Thanks to some internet free train ride two days ago , I found this ` TODO ` to remove the ` Settings ` from the transport actions CTOR , as it was passed but then unused and dug my way through the codebase to remove it . As it is somewhat hard to keep in sync , I 'd appreciate a quick note , if it makes sense to keep/review or we can close this one , whatever is preferred .
Use single netty event loop group for transports __EoT__ Currently we create a new netty event loop group for client connections and all server profiles . Each new group creates new threads for io processing . This means 2 * num of processors new threads for each group . A single group should be able to handle all io processing ( for the transports ) . This also brings the netty module inline with what we do for nio . Additionally , this PR renames the worker threads to be the same for netty and nio .
[ ILM ] Fix race condition in test __EoT__ Previously , testRunStateChangePolicyWithNextStep asserted that the ClusterState before and after running the steps were equal . The test only passed due to a race condition : The latch would be triggered by the step execution , but the cluster state update thread would continue running the next stepbefore committing the change to the cluster state . This allowed the test to read the old cluster state and pass the equality check about 99.99 % of the time . The test now waits for the new cluster state to be committed by checking that it is _not_ equal to the old cluster state . This should resolve this flaky test issue .
analysis icu rest test fails : analysis_icu/10_basic/Normalization* __EoT__ Reproduce : `` ` ./gradlew plugins : analysis-icu : check `` ` ( remember to remove the blacklist from ` build.gradle ` , tests were muted ) `` ` Suite : org.elasticsearch.index.analysis.IcuClientYamlTestSuiteIT 1 > [ 2018-11-02T04:23:04,231 ] [ INFO ] [ o.e.i.a.IcuClientYamlTestSuiteIT ] [ test ] [ yaml=analysis_icu/10_basic/Tokenizer ] before test 1 > [ 2018-11-02T04:23:04,279 ] [ INFO ] [ o.e.i.a.IcuClientYamlTestSuiteIT ] [ test ] initializing REST clients against [ http : // [ : :1 ] :44335 ] 1 > [ 2018-11-02T04:23:04,491 ] [ INFO ] [ o.e.i.a.IcuClientYamlTestSuiteIT ] [ test ] initializing client , minimum es version [ 7.0.0-alpha1 ] , master version , [ 7.0.0-alpha1 ] , hosts [ http : // [ : :1 ] :44335 ] 1 > [ 2018-11-02T04:23:04,652 ] [ INFO ] [ o.e.i.a.IcuClientYamlTestSuiteIT ] [ test ] [ yaml=analysis_icu/10_basic/Tokenizer ] after test 1 > [ 2018-11-02T04:23:04,662 ] [ INFO ] [ o.e.i.a.IcuClientYamlTestSuiteIT ] [ test ] [ yaml=analysis_icu/10_basic/Normalization filter ] before test 1 > [ 2018-11-02T04:23:04,686 ] [ INFO ] [ o.e.i.a.IcuClientYamlTestSuiteIT ] [ test ] [ yaml=analysis_icu/10_basic/Normalization filter ] after test 1 > [ 2018-11-02T04:23:04,690 ] [ INFO ] [ o.e.i.a.IcuClientYamlTestSuiteIT ] [
ingest : add common options to each processor 's documentation __EoT__ * adds ` if ` , ` on_failure ` , ` ignore_failure ` , and ` tag ` to table for each processor part of # 33188 -- -- -- -- -- - Example rendered processor : < img width= '' 600 '' alt= '' image '' src= '' https : //user-images.githubusercontent.com/976291/47797362-325eba80-dcf4-11e8-9191-9bcfb713c2c8.png '' > EDIT : update example
SQL : Improve painless script generated from ` IN ` __EoT__ Replace standard ` || ` and ` == ` painless operators with ` or ` and ` eq ` null safe alternatives from ` InternalSqlScriptUtils ` . Follow up to # 34750
[ DOCS ] Updates monitoring diagram __EoT__ This PR updates the diagram in https : //www.elastic.co/guide/en/elasticsearch/reference/master/configuring-metricbeat.html to align with the changes in https : //github.com/elastic/stack-docs/pull/134
XPack/HLRC request/response compatibility tests __EoT__ Actually we do n't have any validation for the compatibility of XPack requests/responses and HLRC implementation of those requests/responses . This PR is to fill this gap _note_ : while we have ` xpack/protocol ` these tests could not be run due to jar hell . Relates to # 34451
DISCOVERY : Cleanup AbstractDisruptionTestCase __EoT__ * Make the internal test cluster manage minimum master nodes where we used the default of ( nodes / 2 + 1 ) before * Manually set master nodes in the cases where we did n't use the default * Remove use of the ` NodeConfigurationSource ` indirection * Relates # 33675
rename CRUD api REST path prefix _ilm to _ilm/policy __EoT__ This PR renames the CRUD APIS for ILM GET _ilm/ < policy > , _ilm - > _ilm/policy/ < policy > , _ilm/policy PUT _ilm/ < policy > - > _ilm/policy/ < policy > DELETE _ilm/ < policy > - > _ilm/policy/ < policy > closes # 34929 .
median absolute deviation agg __EoT__ This commit adds a new single value metric aggregation that calculates the statistic called median absolute deviation , which is a measure of variability that works on more types of data than standard deviation Our calculation of MAD is approximated using t-digests . In the collect phase , we collect each value visited into a t-digest . In the reduce phase , we merge all value t-digests , then create a t-digest of deviations using the first t-digest 's median and centroids For # 26681 Still writing the docs , but wanted to get feedback on the code
SQL : test for https : //github.com/elastic/elasticsearch/issues/30054 bug __EoT__ The issue was happening when only a nested field column was ` SELECT ` ed and it was a bug in ES code . This PR adds a test to check the fix holds . I have also activated another test which was muted in the early days when discussion were taking place regarding dot handling in SQL . Related to https : //github.com/elastic/elasticsearch/issues/30054
HLRC : DRY up remaining CRUD docs __EoT__ This further applies the pattern set in # 34125 to reduce copy-and-paste in the multi-document CRUD portion of the High Level REST Client docs . It also adds line wraps to snippets that are too wide to fit into the box when rendered in the docs , following up on the work started in # 34163 .
NETWORK : Align Behaviour of NettyChan setSoLinger __EoT__ * All other implementations only set SO_LINGER if the channel is still open and throw ` IOException ` on failure , the Netty one should do the same I found this in # 34665 and it 's probably worth aligning behaviour here ?
[ ILM ] Convert Explain request to new HLRC classes __EoT__ Converts ` ExplainLifecycleRequest ` to use Validatable . Relates to https : //github.com/elastic/elasticsearch/issues/33100
[ Style ] Remove line length violations from ingest actions __EoT__ Removes all line length violations from ingest actions to get rid the need for checkstyle suppression in this package . Parent issue : https : //github.com/elastic/elasticsearch/issues/34884
Fix LineLength Check Suppressions : index.fielddata __EoT__ * Fix linelength suppressions in index.fielddata * Some lines that were too long were dead code = > Removed them and all code that became dead because of it * Relates # 34884
[ TEST ] HLRC : Expand failure messages in API checks __EoT__ For the assertions in the `` testApiNamingConventions '' test that check the API contract , this change adds details of the method that was being checked , and the intent of the assertion ( the API contract )
Lowercase static final DeprecationLogger instance names __EoT__ After discussing on the team 's FixItFriday , we concluded that static final instance variables that are mutable should be lowercased . Previously , DeprecationLogger was uppercased more frequently than lowercased . As described in https : //google.github.io/styleguide/javaguide.html # s5.2.4-constant-names related # 34872
document the search context is freed if the scroll is not extended __EoT__ The ` fetchPhaseShouldFreeContext ` returns true when there is a scroll context but the scroll parameter is null , thus freeing the search context . https : //github.com/elastic/elasticsearch/blob/183c32d4c39948e037a7fb44dccf31ab0d60d3c3/server/src/main/java/org/elasticsearch/search/SearchService.java # L491
Add 6.6.0 version to master __EoT__ This commit adds the 6.6.0 version constant to the master branch , and adapts the VersionTests .
remove index.lifecycle.skip setting __EoT__ With the introduction of _ilm/stop and _ilm/start APIs , the use cases where one would only target a select group of indices to start/stop has been reduced . Since there is no strong use-case for skipping specific indices , it is best to remove this functionality and only adding if later desired , with the hopes of keeping things more simple .
Logging : tests : clean up logging __EoT__ Replace internal deprecated calls to ` Loggers.getLogger ( Class ) ` with direct calls to log4j ` LogManager.getLogger ( Class ) ` Relates to : # 32174
SQL : Fix edge case : ` < field > IN ( null ) ` __EoT__ Handle the case when ` null ` is the only value in the list so that it 's translated to a ` MatchNoDocsQuery ` . Followup to : # 34750
ingest : document fields that support templating __EoT__ This change also updates many of the examples to use ecs as the example . Some additional minor improvements are also included . Part of # 33188
TESTING.asciidoc fix examples using forbidden annotation __EoT__ ` @ Nightly ` has been added to the forbidden test annotations : https : //github.com/elastic/elasticsearch/blob/237650e9c054149fd08213b38a81a3666c1868e5/buildSrc/src/main/resources/forbidden/es-test-signatures.txt # L24 guaranteeing that no tests can be annotated as ` @ Nightly ` . This PR removes any examples containing ` @ Nightly ` , so that contributors do not try to implement , filter or run nightly tests .
Enable docs tests to have tear down snippet __EoT__ This commit adds the ability for docs tests to add a tear down snippet . This snippet will be converted to a tear down section of the generated REST tests .
Migrate wait for pending tasks helper to server __EoT__ In some of our X-Pack REST tests we have to wait for pending tasks to complete . We are now needing this functionality in ESRestTestCase for the docs tests where we run against X-Pack features . This commit moves the helper method that we have in X-Pack to ESRestTestCase , and removes duplicate logic from waiting for rollup tasks to complete .
HLRC : ML % s/Boolean is/Boolean get/g __EoT__ Replaces ` Boolean is ` with ` Boolean get ` for requests . Also changes ` DeleteDatafeedRequest # force ` to be ` Boolean ` and updates ` DeleteDatafeedRequest # ( get|set ) Force ` accordingly closes # 33374
SQL : Introduce support for NULL values __EoT__ Make SQL aware of missing and/or unmapped fields treating them as NULL Make _all_ functions and operators null-safe aware , including when used in filtering or sorting contexts Add missing and null-safe doc value extractor Modify dataset to have null fields spread around ( in groups of 10 ) Enforce missing last and unmapped_type inside sorting Consolidate Predicate templating and declaration Add support for Like/RLike in scripting Introduce early schema declaration for CSV spec tests : to keep the doc snippets in place , introduce schema : : prefix to declare the CSV schema upfront . Fix # 32079
[ Docs ] Add _cache/clear parameter examples __EoT__ Add example for selectively clearing just the request , query or fielddata cache and for selectively clearing the cache for specific fields . Closes # 34287
Amazon plugins : Wrap at 140 columns __EoT__ Applies our standard column wrapping to the ` discovery-ec2 ` and ` repository-s3 ` plugins .
Rename and deprecated ` prefix ` logfile audit setting names __EoT__ # 31931 Changed the format of the logfile audit log . It is no longer formed by prefix fields followed by key value fields , it is all formed by key value fields only ( JSON format ) . Consequently , the following settings , which toggled some of the prefix fields , should be renamed : audit.logfile ~.prefix~.emit_node_host_address audit.logfile ~.prefix~.emit_node_host_name audit.logfile ~.prefix~.emit_node_name The _prefix_ variants have been deprecated ( in 7.0 also ? ) in favor of the variants lacking the _prefix._ . The setting ` audit.logfile.prefix.emit_node_id ` which has not seen the release light has simply been renamed to ` audit.logfile.emit_node_id ` . Relates # 31931 ( should have been considered there ) .
Replace Streamable w/ Writeable in RoleDescriptor __EoT__ This commit replaces usage of Streamable with Writeable within the RoleDescriptor class ( and inner classes ) . Relates : # 34389
Disc : Move AbstractDisruptionTC to filebased D. __EoT__ * Move to file based discovery in ` AbstractDisruptionTestCase ` * Do n't use the ordinals of the unicast hosts at config time , use them when actually starting the cluster and only write the nodes whose id is in the unicast host array to the discovery file * Remove all code paths in ` ClusterDiscoveryConfiguration ` that become unused due to not using it for configuration in ` AbstractDisruptionTestCase ` anymore * Relates # 33675
Introduce index settings version __EoT__ This commit introduces settings version to index metadata . This value is monotonically increasing and is updated on settings updates . This will be useful in cross-cluster replication so that we can request settings updates from the leader only when there is a settings update .
SCRIPTING : Move Aggregation Script Context to its own class __EoT__ WIP
ListenableFuture should preserve ThreadContext __EoT__ ListenableFuture may run a listener on the same thread that called the addListener method or it may execute on another thread after the future has completed . Whenever the ListenableFuture stores the listener for execution later , it should preserve the thread context which is what this change does .
[ CCR ] Change unfollow API 's privilege scheme __EoT__ Unfollow should be allowed / disallowed on a per index level instead of cluster level . Also renamed ` create_follow_index ` index privilege to ` manage_follow_index ` privilege and include unfollow and close APIs .
[ DOCS ] Removes beta label from composite aggregation __EoT__
Docs : DRY up CRUD docs __EoT__ This further applies the pattern set in # 34125 to reduce copy-and-paste in the single document CRUD portion of the High Level REST Client docs . It also adds line wraps to snippets that are too wide to fit into the box when rendered in the docs , following up on the work started in # 34163 .
Small fixes to the HLRC watcher documentation . __EoT__ * Make sure to use the new docs style for 'ack watch ' . * Replace 'document ' with 'watcher ' in page names .
Add support for 'ack watch ' to the HLRC . __EoT__ Addresses part of # 29827 .
Adds trace logging to IndicesRequestCache __EoT__ This change adds trace level logging to ` IndicesrrequestCache ` with the primary aim of helping to identify the cause of the failures in https : //github.com/elastic/elasticsearch/issues/32827 . The cache will log at trace level when a cache hit or miss occurs including the reader version and the cache key . Note that this change adds a ` cacheKeyRenderer ` which supplies a human readable String of the cache key since the actual cache key itself is a ` BytesReference ` containing the wire protocol serialised form of the request . Logging is also added for the case where a search timeout occurs and fr that reason the cache entry is invalidated .
Fix logging of cluster state update descriptions __EoT__ In # 28941 we changed the computation of cluster state task descriptions but this introduced a bug in which we only log the empty descriptions ( rather than the non-empty ones ) . This PR fixes that bug .
Fix use of hostname in Windows service __EoT__ To pass the HOSTNAME envrionment variable to the Windows service , we have to add some command line flags to the service invocation . Namely , we have to specify that we are passing HOSTNAME variable , and we will pass for it the value of % % COMPUTERNAME % % . This ensures that if the hostname is changed , we pick this up the next time that the service is started . This change is needed for the service now that we use the HOSTNAME as the default node name .
Updated link to kafka-elasticsearch-consumer project __EoT__ < ! -- Thank you for your interest in and contributing to Elasticsearch ! There are a few simple things to check before submitting your pull request that can help with the review process . You should delete these items from your submission , but they are here to help bring them to your attention . -- > - Have you signed the [ contributor license agreement ] ( https : //www.elastic.co/contributor-agreement ) ? - Have you followed the [ contributor guidelines ] ( https : //github.com/elastic/elasticsearch/blob/master/CONTRIBUTING.md ) ? - If submitting code , have you built your formula locally prior to submission with ` gradle check ` ? - If submitting code , is your pull request against master ? Unless there is a good reason otherwise , we prefer pull requests against master and will backport as needed . - If submitting code , have you checked that your submission is for an [ OS that we support ] ( https : //www.elastic.co/support/matrix # show_os ) ? - If you are submitting this code for a class then read our [ policy ] ( https : //github.com/elastic/elasticsearch/blob/master/CONTRIBUTING.md # contributing-as-part-of-a-class ) for that
Add Gradle attributes to CI jobs __EoT__ CI already has a change to take these parameters into so we can host differences like these in the feature branches . ` GRADLE_TASK= '' build '' ` will find it 's way to master too .
Change CCR stats endpoint to be index-centric __EoT__ This commit modifies the CCR stats endpoint for indices to be / { index } /_ccr/stats . This makes this endpoint consistent with other index-centric endpoints like indices stats . Relates # 32350
[ Docs ] remove double words __EoT__ removes double wording Note : Afaik internal docs , not published outside of github
Handle null SSLSessions during invalidation __EoT__ The SSLService invalidates SSLSessions when there is a change to any of the underlying key or trust material . However , this invalidation code did not check for a null SSLSession being returned from the context and assumed that the context would always return a non-null object . The return of a null object is possible in all versions , but JDK11 seems to return them more often due to changes for TLS 1.3 . There are a number of reasons that we get a id of a session but the context returns null when the session with that id is requested . Some of the reasons for this are : * Session was evicted by session cache * Session has timed out * Session has been invalidated by another caller To handle this , the SSLService now checks if the value is null before calling invalidate on the SSLSession . Closes # 32124
Rename CCR APIs __EoT__ Rename : * POST ` / { index } /_ccr/create_and_follow ` to PUT ` / { index } /_ccr/follow ` * ` / { index } /_ccr/unfollow ` to ` / { index } /_ccr/pause_follow ` * ` / { index } /_ccr/follow ` to ` / { index } /_ccr/resume_follow ` Relates to # 33931
Logging : Drop Settings from security logger get calls __EoT__ ` Settings ` is no longer required to get a ` Logger ` and we went to quite a bit of effort to pass it to the ` Logger ` getters . This removes the ` Settings ` logger lookups from the security and x-pack : core .
ingest : correctly measure chained pipeline stats __EoT__ Prior to this change when a pipeline processor called another pipeline , only the stats for the first processor were recorded . The stats for the subsequent pipelines were ignored . This change properly accounts for pipelines irregardless if they are the first or subsequently called pipelines . This change moves the state of the stats from the IngestService to the pipeline itself . Cluster updates are safe since the pipelines map is atomically swapped , and if a cluster update happens while iterating over stats ( now read directly from the pipeline ) a slightly stale view of stats may be shown . -- -- -- -- -- -- - With the following setup : `` ` PUT _ingest/pipeline/mypipeline1 { `` processors '' : [ { `` pipeline '' : { `` pipeline '' : `` mypipeline2 '' } } ] } PUT _ingest/pipeline/mypipeline2 { `` processors '' : [ { `` pipeline '' : { `` pipeline '' : `` mypipeline3 '' } } ] } PUT _ingest/pipeline/mypipeline3 { `` processors '' : [ { `` rename '' : { `` field '' : `` a '' , `` target_field
XContentBuilder to handle BigInteger and BigDecimal __EoT__ Although we allow to index BigInteger and BigDecimal into a keyword field , source filtering on these fields would fail as XContentBuilder was not able to deserialize BigInteger and BigDecimal to json . This modifies XContentBuilder to allow to handle BigInteger and BigDecimal . Closes # 32395
INGEST : Tests for Drop Processor __EoT__ * UT for behavior of dropped callback and drop processor * Moved drop processor to ` server ` project to enable this test ( otherwise I would 've had to add code for a dummy processor that returns ` null ` in the server tests for testing the callback ... moving the proc seemed more reasonable : ) ) * Simple IT * Relates # 32278
SQL : Prevent StackOverflowError when parsing large statements __EoT__ Catch StackOverflowError exception and return a descriptive message to the client . This prevents large statement from killing the cluster . Fixes : # 32942
[ DOCS ] clarify the meaning of 'type ' parameter for custom analyzer __EoT__ Hello dear sirs , This pull request is to improve the docs on the meaning of ` type ` parameter on the custom analyzer doc page . It closes # 33456 . The ` ./gradlew : docs : check ` finished successfully . I also tried to run doc build scripts from [ elastic/docs ] ( https : //github.com/elastic/docs ) but did n't succeed ( there were errors I could not figure how to solve ) . Please tell me if this is useful anyhow , and I am open for suggestions . Thank you !
Add a deprecation warning in the type query documentation . __EoT__
[ DOCS ] Removed Homebrew installation section __EoT__ Brew install is not currently supported .
Propagate max_auto_id_timestamp in peer recovery __EoT__ Today we do n't store the auto-generated timestamp of append-only operations in Lucene ; and assign -1 to every index operations constructed from LuceneChangesSnapshot . This looks innocent but it generates duplicate documents on a replica if a retry append-only arrives first via peer-recovery ; then an original append-only arrives via replication . Since the retry append-only ( delivered via recovery ) does not have timestamp , the replica will happily optimize the original request while it should not . This change transmits the max auto-generated timestamp from the primary to replicas before translog phase in peer recovery . This timestamp will prevent replicas from optimizing append-only requests if retry counterparts have been processed . Relates # 33656 Relates # 33222 - I labeled this non-issue since this is an unreleased bug .
Track max seq_no of updates or deletes on primary __EoT__ This PR is the first step to use seq_no to optimize indexing operations . The idea is to track the max seq_no of either update or delete ops on a primary , and transfer this information to replicas , and replicas use it to optimize indexing plan for index operations ( with assigned seq_no ) . The max_seq_no_of_updates on primary is initialized once when a primary finishes its local recovery or peer recovery in relocation or being promoted . After that , the max_seq_no_of_updates is only advanced internally inside an engine when processing update or delete operations . Relates # 33656
HLRC : ML start data feed API __EoT__ Adds ML Start data feed API call to the HLRC Relates to # 29827
Add OneStatementPerLineCheck to Checkstyle rules __EoT__ This change adds the OneStatementPerLineCheck to our checkstyle precommit checks . This rule restricts the number of statements per line to one . The resoning behind this is that it is very difficult to read multiple statements on one line . People seem to mostly use more than one statement per line in short lambdas and switch statements in our code base , but just going through the necessary changes this rule enforces already uncovered some actual problems in randomization in test code , so I think its worth it .
Introduce a ` search_throttled ` threadpool __EoT__ Today all searches happen on the search threadpool which is the correct behavior in almost any case . Yet , there are exceptions where for instance searches searches should be passed through a single-thread threadpool to reduce impact on a node . This change adds a index-private setting that allows to mark an index as throttled for searches and forks off all non-stats searcher access to this threadpool for indices that are marked as ` index.search.throttled `
Core : Default node.name to the hostname __EoT__ Changes the default of the ` node.name ` setting to the hostname of the machine on which Elasticsearch is running . Previously it was the first 8 characters of the node id . This had the advantage of producing a unique name even when the node name is n't configured but the disadvantage of being unrecognizable and not being available until fairly late in the startup process . Of particular interest is that it is n't available until after logging is configured . This forces us to use a volatile read whenever we add the node name to the log . Using the hostname is available immediately on startup and is generally recognizable but has the disadvantage of not being unique when run on machines that do n't set their hostname or when multiple elasticsearch processes are run on the same host . I believe that , taken together , it is better to default to the hostname . 1 . Running multiple copies of Elasticsearch on the same node is a fairly advanced feature . We do it all the as part of the elasticsearch build for testing but we make
Delete custom index if the only contained job is deleted __EoT__ When deleting the last job from an index , we should drop the index instead of the individual results files . Closes # 30075
[ Tests ] Nudge wait time in RemoteClusterServiceTests __EoT__ This test occasionally fails in ` testCollectSearchShards ` waiting on what seems to be a search request to a remote cluster for one second . Given that the test fails here very rarely I suspect maybe one second is very rarely not enough so we could fix it by increasing the max wait time slightly . Closes # 33852
Fixing assertions in integration test __EoT__ Follow up to # 33584 . Fixes the Monitoring integration test to not expect the fields removed in # 33584 . TBH , I 'm not sure how # 33584 went green without this fix !
HLRC : Delete ML calendar __EoT__ For # 29827
TESTS : Set SO_LINGER = 0 for MockNioTransport __EoT__ * Prevents lingering sockets in TIME_WAIT piling up during test runs and leading to port collisions that manifest as timeouts * Fixes # 32552
MINOR : Remove Some Dead Code in Scripting __EoT__ * Method override for mock filter script is redundant ( parent is the same method ) * The is default check method is not used in ScriptType * The removed fields on ExpressionSearchScript are unused
Watcher : Use Bulkprocessor in HistoryStore/TriggeredWatchStore __EoT__ Currently a watch execution results in one bulk request , when the triggered watches are written into the that index , that need to be executed . However the update of the watch status , the creation of the watch history entry as well as the deletion of the triggered watches index are all single document operations . This can have quite a negative impact , once you are executing a lot of watches , as each execution results in 4 documents writes , three of them being single document actions . This commit switches to a bulk processor instead of a single document action for writing watch history entries and deleting triggered watch entries . However the defaults are to run synchronous as before because the number of concurrent requests is set to 0 . This also fixes a bug , where the deletion of the triggered watch entry was done asynchronously . However if you have a high number of watches being executed , you can configure watcher to delete the triggered watches entries as well as writing the watch history entries via bulk requests . The triggered watches deletions should
Dependencies : Update javax.mail in watcher to 1.6.2 __EoT__
Corrected aggregation name to match the example __EoT__ Corrected aggregation name from intraday_return to hat_prices to match the aggregation name provided in the example
TESTS : Fix Concurent Remote Connection Updates __EoT__ * Same fix idea as in 10666a4 to prevent background threads trying to reconnect after the tests are done from throwing ` ExecutionCancelledException ` and breaking the test * Closes # 30714
Keep CCR REST API specification with all of X-Pack __EoT__ This commit moves the CCR REST API specification out of the CCR sub-project to locate them with the rest of the REST API specifications for X-Pack .
Expose retries for CCR fetch failures __EoT__ This commit exposes the number of times that a fetch has been tried to the CCR stats endpoint , and to CCR monitoring .
[ ML ] Allow overrides for some file structure detection decisions __EoT__ This change modifies the file structure detection functionality such that some of the decisions can be overridden with user supplied values . The fields that can be overridden are : - charset - format - has_header_row - column_names - delimiter - quote - should_trim_fields - grok_pattern - timestamp_field - timestamp_format If an override makes finding the file structure impossible then the endpoint will return an exception .
[ TESTS ] Disable specific locales for RestrictedTrustManagerTest __EoT__ Disable specific Thai and Japanese locales as Certificate expiration validation fails due to the date parsing of BouncyCastle ( that manifests in a FIPS 140 JVM as this is the only place we use BouncyCastle ) . Added the locale switching logic here instead of subclassing ESTestCase as these are the only tests that fail for that local and JVM combination . Resolves # 33081
Resync fails to notify on unavaiable exceptions __EoT__ We fail to notify the resync listener if the resync replication hits a shard unavailable exception . Moreover , we no longer need to swallow these unavailable exceptions . Relates # 31179 Closes # 33613
Add migration note for remote cluster settings __EoT__ The remote cluster settings ` search.remote . * ` have been renamed to ` cluster.remote . * ` and are automatically upgraded in the cluster state on gateway recovery , and on put . This commit adds a note to the migration docs for these changes .
Enable global checkpoint listeners to timeout __EoT__ In cross-cluster replication , we will use global checkpoint listeners to long poll for updates to a shard . However , we do not want these polls to wait indefinitely as it could be difficult to discern if the listener is still waiting for updates versus something has gone horribly wrong and cross-cluster replication is stuck . Instead , we want these listeners to timeout after some period ( for example , one minute ) so that they are notified and we can update status on the following side that cross-cluster replication is still active . After this , we will immediately enter back into a poll mode . To do this , we need the ability to associate a timeout with a global checkpoint listener . This commit adds this capability . Relates # 32696
Forbid negative ` weight ` in Function Score Query __EoT__ Relates to # 31927
Preserve cluster settings on full restart tests __EoT__ Today the full cluster restart tests do not preserve cluster settings on restart . This is a mistake because it is not an accurate reflection of reality , we do not expect users to clear cluster settings when they perform a full cluster restart . This commit makes it so that all full cluster restart tests preserve settings on upgrade . Relates # 33537 , relates # 33575 , relates # 33577
Renames lifecycle to policy in rest-api-spec __EoT__
Add script_filter tokenfilter __EoT__ This will allow users to filter out terms using scripted predicates , rather than having to write Java code and wiring things up via analysis plugins .
[ Test ] Remove duplicate method in TestShardRouting __EoT__ TestShardRouting contains two methods with the same parameters , but in different order ( last two params ) : `` ` public static ShardRouting newShardRouting ( ShardId shardId , String currentNodeId , boolean primary , RecoverySource recoverySource , ShardRoutingState state ) { } public static ShardRouting newShardRouting ( ShardId shardId , String currentNodeId , boolean primary , ShardRoutingState state , RecoverySource recoverySource ) { } `` ` This pull request removes one of the method and also fixes some typos .
[ CCR ] Delay auto follow license check __EoT__ so that we 're sure that there are auto follow patterns configured Otherwise we log many warnings in case someone is running with basic or gold license and has not used the ccr feature : `` ` [ elasticsearch ] [ 2018-09-10T09:58:12,633 ] [ INFO ] [ o.e.n.Node ] [ node-0 ] started [ elasticsearch ] [ 2018-09-10T09:58:12,704 ] [ INFO ] [ o.e.g.GatewayService ] [ node-0 ] recovered [ 0 ] indices into cluster_state [ elasticsearch ] [ 2018-09-10T09:58:12,790 ] [ INFO ] [ o.e.c.m.MetaDataIndexTemplateService ] [ node-0 ] adding template [ .watches ] for index patterns [ .watches* ] [ elasticsearch ] [ 2018-09-10T09:58:12,847 ] [ INFO ] [ o.e.c.m.MetaDataIndexTemplateService ] [ node-0 ] adding template [ .watch-history-9 ] for index patterns [ .watcher-history-9* ] [ elasticsearch ] [ 2018-09-10T09:58:12,877 ] [ INFO ] [ o.e.c.m.MetaDataIndexTemplateService ] [ node-0 ] adding template [ .triggered_watches ] for index patterns [ .triggered_watches* ] [ elasticsearch ] [ 2018-09-10T09:58:12,922 ] [ INFO ] [ o.e.c.m.MetaDataIndexTemplateService ] [ node-0 ] adding template [ .monitoring-logstash ] for index patterns [ .monitoring-logstash-6-* ] [ elasticsearch ] [ 2018-09-10T09:58:12,969 ] [ INFO ] [ o.e.c.m.MetaDataIndexTemplateService ]
Add infrastructure to upgrade settings __EoT__ In some cases we want to deprecate a setting , and then automatically upgrade uses of that setting to a replacement setting . This commit adds infrastructure for this so that we can upgrade settings when recovering the cluster state , as well as when such settings are dynamically applied on cluster update settings requests . This commit only focuses on cluster settings , index settings can build on this infrastructure in a follow-up .
move ILM client objects from protocol to client __EoT__ pretty straightforward migration ( assuming this is correct )
Logging : Configure the node name when we have it __EoT__ Change the logging infrastructure to handle when the node name isn't available in ` elasticsearch.yml ` . In that case the node name is not available until long after logging is configured . The biggest change is that the node name logging no longer fixed at pattern build time . Instead it is read from a ` SetOnce ` on every print . If it is unset it is printed as ` unknown ` so we have something that fits in the pattern . On normal startup we do n't log anything until the node name is available so we never see the ` unknown ` s but we will see if if something fails catastrophically before the we 've recovered the node id or if you set the log level to DEBUG or TRACE . Closes # 32793
Upgrade to a Lucene 8 snapshot __EoT__ The main benefit of the upgrade for users is the search optimization for top scored documents when the total hit count is not needed . However this optimization is not activated in this change , there is another [ issue ] ( https : //github.com/elastic/elasticsearch/issues/33028 ) opened to discuss how it should be integrated smoothly . Some comments about the change : * < del > I muted some tests in FieldSubsetReaderTests , they are fixed in another [ pr ] ( https : //github.com/elastic/elasticsearch/pull/33261 ) . < del > * Tests that can produce negative scores have been adapted but we need to forbid them completely : https : //github.com/elastic/elasticsearch/issues/33309 Closes # 32899
Introduce private settings __EoT__ This commit introduces the formal notion of a private setting . This enables us to register some settings that we had previously not registered as fully-fledged settings to avoid them being exposed via APIs such as the create index API . For example , we had hacks in the codebase to allow index.version.created to be passed around inside of settings objects , but was not registered as a setting so that if a user tried to use the setting on any API then they would get an exception . This prevented users from setting index.version.created on index creation , or updating it via the index settings API . By introducing private settings , we can continue to reject these attempts , yet now we can represent these settings as actual settings . In this change , we register index.version.created as an actual setting . We do not cutover all settings that we had been treating as private in this pull request , it is already quite large due to moving some tests around to account for the fact that some tests need to be able to set the index.version.created . This can be done in a
TESTS+DISTR . : Fix testIndexCheckOnStartup Flake __EoT__ * Ignore all ` RuntimeException ` since random file corruption triggers other RTE in addition to the randomly caught one * In the reported case it throws `` java.lang.IllegalArgumentException : Illegal field number : -65281 '' * - > It 's probably fine to just suppress here instead of trying to foresee+catch all possible exceptions that a randomly corrupted file can trigger ? * closes # 33345
Fix extractjar task ci __EoT__ I do n't see anything wrong with how the task is being set up . I suspect there 's a race condition with Gradle 's lazy task configuration as we have seen before , but instead spending all the time tracking it down , it makes more sense to move this to an integration test instead . Closes # 33201
Fixes SecurityIntegTestCase so it always adds at least one alias __EoT__ ` SecurityIntegTestCase.createIndicesWithRandomAliases ` could randomly fail because its not gauranteed that the randomness of which aliases to add to the ` IndicesAliasesRequestBuilder ` would always select at least one alias to add . This change fixes the problem by keeping track of whether we have added an alias to teh request and forcing the last alias to be added if no other aliases have been added so far . Closes # 30098 Closes # 33123
[ CCR ] Removed custom follow and unfollow api 's response classes __EoT__ and made those actions use AcknowledgedResponse instead . These response classes did not add any value and in that case just AcknowledgedResponse should be used . I also changed the formatting of methods to take one line per parameter in FollowIndexAction.java and UnfollowIndexAction.java files to make reviewing diffs in the future easier .
Lazy evaluate java9home __EoT__ So that the env var has to be set only if really needed and not at config time . will add a test to make sure this does n't happen again in a subsequent PR .
MINOR : Remove Dead Code from PathTrie __EoT__ * The array size checks are redundant since the array sizes are checked earlier in those methods too * The removed methods are just not used anywhere
TEST : Access cluster state directly in assertSeqNos __EoT__ Some AbstractDisruptionTestCase tests start failing since we enabled assertSeqNos ( in # 33130 ) . They fail because the assertSeqNos assertion queries cluster stats while the cluster is disrupted or not formed yet . This commit switches to use the cluster state and shard stats directly from the test cluster . Closes # 33251
HLRC : add client side RefreshPolicy __EoT__ With the switch to client side request and response objects , we need a client side version of RefreshPolicy . This change adds a client side version of RefreshPolicy along with a method to add it to the parameters of a request . The existing method to add WriteRequest.RefreshPolicy to the parameters of a request is now deprecated .
HLRC : Add Lifecycle delete to the HLRC __EoT__ Adds support for Lifecycle deletion to the Java High-Level Rest Client . Also includes some stopgap measures to support using the new Client package structure which should be replaced once the structure refactoring is complete . Relates to # 33100
Fix forbidden apis on FIPS __EoT__ - third party audit detects jar hell with JDK so we disable it - jdk non portable in forbiddenapis detects classes being used from the JDK ( for fips ) that are not portable , this is intended so we don't scan for it on fips . - different exclusion rules for third party audit on fips Closes # 33179
INGEST : Add Pipeline Processor __EoT__ * Adds Processor capable of invoking other pipelines * Closes # 31842 Example : Put inner and outer pipeline ( with new processor ) : `` ` PUT _ingest/pipeline/inner-pipeline { `` description '' : `` inner pipeline '' , `` processors '' : [ { `` set '' : { `` field '' : `` foo '' , `` value '' : `` bar '' } } , { `` set '' : { `` field '' : `` baz '' , `` value '' : `` blub '' } } ] } PUT _ingest/pipeline/outer-pipeline { `` description '' : `` outer pipeline '' , `` processors '' : [ { `` pipeline '' : { `` pipeline '' : `` inner-pipeline '' } } ] } `` ` Add document : `` ` POST /myindex/1 ? pipeline=outer-pipeline { `` field '' : `` value '' } `` ` Works : `` ` POST /myindex/_search { } `` ` = > `` ` { `` took '' : 30 , `` timed_out '' : false , `` _shards '' : { `` total '' : 1 , `` successful '' : 1 , ``
HLRC : create base timed request class __EoT__ There are many requests that allow the user to set a few timeouts on . This class will allow requests impl 'd in HLRC to extend from , and allow users to set those values without significant work to add them to every request .
REST high-level client : add reindex API __EoT__ Relates to # 27205
Fix ShardFollowNodeTask.Status equals and hash code __EoT__ These were broken when fetch exceptions were introduced to the status object but equals and hash code were not updated then . This commit addresses that .
APM server monitoring __EoT__ This PR : * Adds an ` apm_system ` built-in role with privileges to call the bulk Monitoring API , analogous to the ` beats_system ` built-in role . * Adds an ` apm_system ` built-in user with the ` apm_system ` role , analogous to the ` beats_system ` built-in user .
TEST : resync operation on replica should acquire shard permit __EoT__ This change makes sure that resync operations on replicas in the test framework are executed under shard permits as the production code .
Make CCR QA tests build again __EoT__ Welp , I broke this . I merged a change to auto-discover the CCR QA tests by making : x-pack : plugin : ccr : check auto-discover the check tasks in the qa sub-project . Yet , the check tasks for these sub-projects did not depend on the necessary test tasks ( as we were previously doing this directly from the ccr build file . This commit fixes this ! Relates # 33027
Remove unsupported Version.V_5_* __EoT__ This change removes the es 5x version constants and their usages .
[ Rollup ] Return empty response when aggs are missing __EoT__ If a search request does n't contain aggs ( or an empty agg object ) , we should just retun an empty response . This is how the normal search API works if you specify zero hits and empty aggs . The existing behavior throws an exception because it tries to send an empty msearch . Closes # 32256
Fixes shrink action to remove single ndoe allocation __EoT__ This change fixes the shrink action so when the shrink is performed we remove the single node allocation fromt eh shard allocation filtering settings . Without this fix replicas can not be allocated after we have performed the shrink and we can not make progress with the rest of the shink aciton . This change also fixes a bug in the explain API where the maste node timeout was being set to null if it was n't provided instead of using its default value causing a NPE
Allow engine to recover from translog upto a seqno __EoT__ This change allows an engine to recover from its local translog up to the given seqno . The extended API can be used in these use cases : 1 . When a replica starts following a new primary , it resets its index to the safe commit , then replays its local translog up to the current global checkpoint ( see # 32867 ) . 2 . When a replica starts a peer-recovery , it can initialize the start_sequence_number to the persisted global checkpoint instead of the local checkpoint of the safe commit . A replica will then replay its local translog up to that global checkpoint before accepting remote translog from the primary . This change will increase the chance of operation-based recovery . I will make this in a follow-up . Relates # 32867 /cc @ bleskes
move ESLoggerFactory usage to LogManager __EoT__ Work done in # 32513 has deprecated the old constructor in favor of log4j2 's LogManager
Build : Rework shadow plugin configuration __EoT__ This reworks how we configure the ` shadow ` plugin in the build . The major change is that we no longer bundle dependencies in the ` compile ` configuration , instead we bundle dependencies in the new ` bundle ` configuration . This feels more right because it is a little more `` opt in '' rather than `` opt out '' and the name of the ` bundle ` configuration is a little more obvious . As an neat side effect of this , the ` runtimeElements ` configuration used when one project depends on another now contains exactly the dependencies needed to run the project so you no longer need to reference projects that use the shadow plugin like this : `` ` testCompile project ( path : ' : client : rest-high-level ' , configuration : 'shadow ' ) `` ` You can instead use the much more normal : `` ` testCompile `` org.elasticsearch.client : elasticsearch-rest-high-level-client : $ { version } '' `` `
[ ML ] Change close job API to accept payload body vs just query params __EoT__ As it stands right now , calls against ` _xpack/ml/anomaly_detectors/ < job_id > /_close ` accept only query parameters for ` force ` , ` timeout ` , and ` allow_no_jobs ` . This endpoint is the odd one out as the rest of the ` POST ` endpoints expect those options inside the request payload . We should add the support for a payload body with those options and deprecate the query param utilization . This does change the client facing contract , so care should be taken when this change is released .
HLRC : ML Close Job __EoT__ Adds the ML Close Job API to the HLRC . Relates to # 29827
Use settings from the context in BootstrapChecks __EoT__ instead of passing them in the constructor . See https : //github.com/elastic/elasticsearch/pull/32903 # pullrequestreview-146812329
[ DOCS ] Splits the users API documentation into multiple pages __EoT__ The Users API documentation ( https : //www.elastic.co/guide/en/elasticsearch/reference/master/security-api-users.html ) currently contains information about multiple APIs ( get , delete , put , etc ) . This PR splits that information across multiple pages , mirroring the layout of the machine learning APIs and OpenAPI output . This layout change was discussed briefly in # 32635 ( comment ) . Related to https : //github.com/elastic/elasticsearch/pull/32794 and https : //github.com/elastic/elasticsearch/pull/32797
For filters aggregations , make sure that rewrites preserve other_bucket . __EoT__ Addresses # 32834 .
migrate allocate action pojo/xcontent to xpack.protocol __EoT__ This splits out the AllocateAction into some parts xpack-protocol so that it can be re-usable in the client .
HLRC : adding machine learning delete job __EoT__ This adds the DELETE Job call for the Machine Learning client in the HLRC . Relates to # 29827
Remove passphrase support from reload settings API __EoT__ We do not support passphrases on the secure settings storage ( the keystore ) . Yet , we added support for this in the API layer . This commit removes this support so that we are not limited in our future options , or have to make a breaking change . Relates # 32691
Update network-host.asciidoc __EoT__ Minor correction . Two words were mixed up in documentation .
HLRC : adding machine learning open job __EoT__ Adds the Machine Learning Open Job API . Relates to # 29827
Use generic AcknowledgedResponse instead of extended classes __EoT__ This removes custom Response classes that extend ` AcknowledgedResponse ` and do nothing , these classes are not needed and we can directly use the non-abstract super-class instead . While this appears to be a large PR , no code has actually changed , only class names have been changed and entire classes removed .
[ Rollup ] [ Test ] Force a stop to save rollup state before continuing __EoT__ We only upgrade the ID when the state is saved in one of four scenarios : - when we reach a checkpoint ( every 50 pages ) - when we run out of data - when explicitly stopped - on failure The test was relying on the pre-upgrade to finish , save state and then the post-upgrade to start , hit the end of data and upgrade ID . THEN get the new doc and apply the new ID . But I think this is vulnerable to timing issues . If the pre-upgrade portion shutdown before it saved the state , when restarting we would run through all the data from the beginning with the old ID , meaning both docs would still have the old scheme . This change makes the pre-upgrade wait for the job to go back to STARTED so that we know it persisted the end point . Post-upgrade , it stops and restarts the job to ensure the state was persisted and the ID upgraded . That _should_ rule out the above timing issue . I think . :
HLRC : migration get assistance API __EoT__ The request and response classes have been extracted from ` IndexUpgradeInfoAction ` into top-level classes , and moved to the protocol jar . The ` UpgradeActionRequired ` enum is also moved . Relates to # 29827
: x-pack : qa : full-cluster-restart fails with SecurityException : Keystore has been corrupted or tampered with on FIPS JVM __EoT__ Relevant log `` ` 18:02:02 > Task : x-pack : qa : full-cluster-restart : with-system-key : v6.3.3-SNAPSHOT # oldClusterTestCluster # node0.addToKeystore # xpack.watcher.encryption_key 18:02:02 Task ' : x-pack : qa : full-cluster-restart : with-system-key : v6.3.3-SNAPSHOT # oldClusterTestCluster # node0.addToKeystore # xpack.watcher.encryption_key ' is not up-to-date because : 18:02:02 Task has not declared any outputs despite executing actions . 18:02:02 at sun.security.provider.JavaKeyStore.engineLoad ( JavaKeyStore.java:658 ) 18:02:02 at sun.security.provider.JavaKeyStore $ JKS.engineLoad ( JavaKeyStore.java:56 ) 18:02:02 at sun.security.provider.KeyStoreDelegator.engineLoad ( KeyStoreDelegator.java:224 ) 18:02:02 at sun.security.provider.JavaKeyStore $ DualFormatJKS.engineLoad ( JavaKeyStore.java:70 ) 18:02:02 at java.security.KeyStore.load ( KeyStore.java:1445 ) 18:02:02 Starting process 'command '/var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual & & linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT # oldClusterTestCluster node0/elasticsearch-6.3.3-SNAPSHOT/bin/elasticsearch-keystore '' . Working directory : /var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual & & linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT # oldClusterTestCluster node0/cwd Command : /var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual & & linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT # oldClusterTestCluster node0/elasticsearch-6.3.3-SNAPSHOT/bin/elasticsearch-keystore add-file xpack.watcher.encryption_key /var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual & & linux/x-pack/qa/full-cluster-restart/src/test/resources/system_key 18:02:02 Successfully started process 'command '/var/lib/jenkins/workspace/elastic+elasticsearch+master+matrix-java-periodic/ES_BUILD_JAVA/java11/ES_RUNTIME_JAVA/java8fips/nodes/virtual & & linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT # oldClusterTestCluster node0/elasticsearch-6.3.3-SNAPSHOT/bin/elasticsearch-keystore '' 18:02:02 warning : ignoring JAVA_TOOL_OPTIONS=-Dfile.encoding=UTF8 18:02:02 at sun.security.util.AnchorCertificates $ 1.run ( AnchorCertificates.java:61 ) 18:02:02 at sun.security.util.AnchorCertificates $ 1.run ( AnchorCertificates.java:52 ) 18:02:02 at java.security.AccessController.doPrivileged ( Native Method ) 18:02:02 at sun.security.util.AnchorCertificates. < clinit > (
Core : Fix Java Time DateFormatter printers __EoT__ A bug in the test suite prevented to properly check that all date formatters printed the date the same way like joda time does . This fixes the test and thus also a fair share of formats , that now use the strict parser for printing . Also , now all date parsers are using UTC as their default time zone .
Use nio driven http client for testing __EoT__ This is related to # 27260 . This commit replaces the netty driven http client ( Netty4HttpClient ) with one that is driven by ( NioHttpClient ) . This client exists in the test package and is used for making http requests .
Make sure that field collapsing supports field aliases . __EoT__ This component of the search request was n't covered by the original field alias PR . Addresses # 32623 .
serialize suggestion responses as named writeables __EoT__ This is still in-progress but I wanted to get it up for some feedback . I think the exact location of where some things ( e.g . response fields ) should go in the class hierarchy still needs to be cleaned up , as well as xcontent generation/parsing . The test coverage also probably could use some work . The first stage of this will make suggestion responses named writeables and adapt CustomSuggesterIT accordingly , and then the second stage will move that test to an example plugin and make it a rest integration test . This is related to https : //github.com/elastic/elasticsearch/issues/26585 Suggestion responses were previously serialized as streamables which made writing suggesters in plugins with custom suggestion response types impossible . This commit makes them serialized as named writeables and provides a facility for registering a reader for suggestion responses when registering a suggester . This also makes Suggestion responses abstract , requiring a suggester implementation to provide its own types . Suggesters which do not need anything additional to what is defined in Suggest.Suggestion should provide a minimal subclass .
[ Rollup ] Remove builders from GroupConfig __EoT__
[ TEST ] Allow tests to run in FIPS JVM __EoT__ * Change SecurityNioHttpServerTransportTests to use PEM key and certificate files instead of a JKS keystore so that this tests can also run in a FIPS 140 JVM ( These tests were not in master when # 31666 was merged ) * Do not attempt to run cases with ssl.verification_mode NONE in SessionFactoryTests when run in a FIPS 140 JVM
Fix race between replica reset and primary promotion __EoT__ We 've recently seen a number of test failures that tripped an assertion in IndexShard ( see issues linked below ) , leading to the discovery of a race between resetting a replica when it learns about a higher term and when the same replica is promoted to primary . This PR fixes the race by distinguishing between a cluster state primary term ( called pendingPrimaryTerm ) and a shard-level operation term . The former is set during the cluster state update or when a replica learns about a new primary . The latter is only incremented under the operation block , which can happen in a delayed fashion . It also solves the issue where a replica that 's still adjusting to the new term receives a cluster state update that promotes it to primary , which can happen in the situation of multiple nodes being shut down in short succession . In that case , the cluster state update thread would call ` asyncBlockOperations ` in ` updateShardState ` , which in turn would throw an exception as blocking permits is not allowed while an ongoing block is in
[ CI ] LocateFunctionProcessorDefinitionTests.testTransform fails reproducibly __EoT__ The following command reproduces a failure for me : `` ` ./gradlew : x-pack : plugin : sql : test \ -Dtests.seed=4A8AA83AF664106A \ -Dtests.class=org.elasticsearch.xpack.sql.expression.function.scalar.string.LocateFunctionProcessorDefinitionTests \ -Dtests.method= '' testTransform '' \ -Dtests.security.manager=true \ -Dtests.locale=fi \ -Dtests.timezone=Pacific/Apia `` ` This failure occurred here : https : //elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=amazon/2593/console The stack trace from this failure looks like this : `` ` SqlIllegalArgumentException [ Null children are not allowed ] at __randomizedtesting.SeedInfo.seed ( [ 4A8AA83AF664106A:40610098D380C967 ] :0 ) at org.elasticsearch.xpack.sql.tree.Node. < init > ( Node.java:43 ) at org.elasticsearch.xpack.sql.expression.function.scalar.processor.definition.ProcessorDefinition. < init > ( ProcessorDefinition.java:30 ) at org.elasticsearch.xpack.sql.expression.function.scalar.string.LocateFunctionProcessorDefinition. < init > ( LocateFunctionProcessorDefinition.java:24 ) at org.elasticsearch.xpack.sql.tree.NodeInfo $ 5.innerTransform ( NodeInfo.java:182 ) at org.elasticsearch.xpack.sql.tree.NodeInfo.transform ( NodeInfo.java:59 ) at org.elasticsearch.xpack.sql.tree.Node.transformNodeProps ( Node.java:245 ) at org.elasticsearch.xpack.sql.tree.Node.transformPropertiesOnly ( Node.java:225 ) at org.elasticsearch.xpack.sql.expression.function.scalar.string.LocateFunctionProcessorDefinitionTests.testTransform ( LocateFunctionProcessorDefinitionTests.java:66 ) at sun.reflect.NativeMethodAccessorImpl.invoke0 ( Native Method ) at sun.reflect.NativeMethodAccessorImpl.invoke ( NativeMethodAccessorImpl.java:62 ) at sun.reflect.DelegatingMethodAccessorImpl.invoke ( DelegatingMethodAccessorImpl.java:43 ) at java.lang.reflect.Method.invoke ( Method.java:498 ) at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke ( RandomizedRunner.java:1713 ) at com.carrotsearch.randomizedtesting.RandomizedRunner $ 8.evaluate ( RandomizedRunner.java:907 ) at com.carrotsearch.randomizedtesting.RandomizedRunner $ 9.evaluate ( RandomizedRunner.java:943 ) at com.carrotsearch.randomizedtesting.RandomizedRunner $ 10.evaluate ( RandomizedRunner.java:957 ) at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate ( StatementAdapter.java:36 ) at org.apache.lucene.util.TestRuleSetupTeardownChained $ 1.evaluate ( TestRuleSetupTeardownChained.java:49 ) at org.apache.lucene.util.AbstractBeforeAfterRule $ 1.evaluate ( AbstractBeforeAfterRule.java:45 ) at org.apache.lucene.util.TestRuleThreadAndTestName $
Add licensing enforcement for FIPS mode __EoT__ This commit adds licensing enforcement for FIPS mode through the use of a bootstrap check , a node join validator , and a check in the license service . The work done here is based on the current implementation of the TLS enforcement with a production license . The bootstrap check is always enforced since we need to enforce the licensing and this is the best option to do so at the present time .
Scripting : Fix painless compiler loader to know about context classes __EoT__ This commit fixes the painless compiler classloader to know about the classes from the script context . This fixes an issue when a custom context is used from a plugin which caused a ClassNotFoundException for the script class and its factory classes .
Increase max chunk size to 256Mb for repo-azure __EoT__ * upgrade azure storage to 8.0.0 * adjust MAX_CHUNK_SIZE to 256Mb Closes # 12448 Note : Despite of Azure SDK has its own internal chunking - it is limited here to chunking on ES level up to max single Azure chunk size ( =256Mb ) . Moving to Azure chunking requires more testing and could be done in follow up PR .
stop throwing an IllegalStateException for unrecognized steps __EoT__ Since the reason for a step not being found in a registry may be due to staleness of the registry between it and the cluster state , we do not want to throw an IllegalStateException . Staleness is something that will be self-healing after follow-up applications of the cluster state updates , so this is a recoverable issue that should log a warning instead of throwing an exception Closes # 32181 .
Fix AutoIntervalDateHistogram.testReduce random failures __EoT__ Closes # 32215 . Couple of bugs were uncovered during investigation : 1 . ` RoundingsInfo ` were inconsistent between the test and implementation . To fix this , I refactored the tests to fetch roundings from the implementation . 2 . In generating the expected result , the test was not correctly respecting innerIntervals in rounding . Since re-using the logic from the ` AutoDateHistogramAggregator ` is a fairly large refactor , I 've replicated some of the logic in the ` testReduce ` method . Can be reproduced using steps in # 32215 , I also tested a number of times with different seeds to convince myself I did n't break other things .
Make get all app privs requires `` * '' permission __EoT__ The default behaviour for `` GetPrivileges '' is to get all application privileges . This should only be allowed if the user has access to the `` * '' application .
Switch security spi example to new style Requests __EoT__ In # 29623 we added ` Request ` object flavored requests to the low level REST client and in # 30315 we deprecated the old ` performRequest ` s . This changes all calls in the ` x-pack/qa/security-example-spi-extension ` project to use the new versions .
Removes redundent NORELEASES and ObjectParserUtils __EoT__
TESTS : Move netty leak detection to paranoid level __EoT__ Set leak detection to paranoid . The performance hit is not measurable IMO and it allows us to catch leaks like # 32296 quicker ( close to 100 % of leaks should be caught instead of leaks making tests flaky with this ) . Marking this as ` v7.0.0 ` for now because it ca n't be merged to ` 6.x ` until # 32342 is fixed or else it will fail ` 6.x ` 100 % of the time .
Painless : Clean Up PainlessClass Variables __EoT__ Removes the variables name , clazz , and type as they are unnecessary . Renames staticMembers - > staticFields , members - > fields , getters - > getterMethodHandles , and setters - > setterMethodHandles .
Security : revert to old way of merging automata __EoT__ This commit reverts to the pre-6.3 way of merging automata as the change in 6.3 significantly impacts the performance for roles with a large number of concrete indices . In addition , the maximum number of states for security automata has been increased to 100,000 in order to allow users to use roles that caused problems pre-6.3 and 6.3 fixed . As an escape hatch , the maximum number of states is configurable with a setting so that users with complex patterns in roles can increase the states with the knowledge that there is more memory usage .
Introduce fips_mode setting and associated checks __EoT__ Introduce ` xpack.security.fips_mode.enabled ` setting ( default false ) When it is set to true , a number of Bootstrap checks are performed : - Check that Secure Settings are of the latest version ( 3 ) - Check that no JKS keystores are configured - Check that compliant algorithms ( PBKDF2 family ) are used for password hashing
Allow Integ Tests to run in a FIPS-140 JVM __EoT__ Necessary changes for running Integration tests in a FIPS-140 JVM . The main drive for change is that JKS keystores can not be used for ` KeyManagerFactory # init ( ) ` so we should use the relevant key and certificate instead for creating all relevant SSLContexts . - Mute : x-pack : qa : sql : security : ssl : integTest entirely as it can not run in FIPS 140 JVM until the SQL CLI supports key/cert . ( It currently supports only Keystores for the key configuration and it 's not trivial to support reading private keys without depending either on BouncyCastle ( Non FIPS version ) or X-Pack ( ` PEMUtils ` ) - Set default JVM keystore/truststore password in top level build script for all integTest tasks in a FIPS 140 JVM as that JVM will be using a BCFKS keystore which will be password protected . - Changed top level x-pack build script to use keys and certificates for trust/key material when spinning up clusters for IT Depends on # 31666
Fix a test bug around nested aggregations and field aliases . __EoT__ This issue affected both ` NestedAggregatorTest ` and ` ReverseNestedAggregatorTest ` .
[ test ] package pre-install java check __EoT__ This recreates a test that was added to the bats packaging tests in # 31343 but did n't make it over to the java project during when the linux package tests were ported in # 31943 When packages are installed but can not locate the java executable , they should fail with a descriptive message
Fail shard if IndexShard # storeStats runs into an IOException __EoT__ Fix for https : //github.com/elastic/elasticsearch/issues/29008 . There are two places that I 'm not sure about , I 've marked them TODO . Based on previous pull request https : //github.com/elastic/elasticsearch/pull/29078 , which can be closed if this one goes through .
INGEST : Make a few Processors callable by Painless __EoT__ * Extracted a few stateless String processors as well as the json processor to static methods and whitelisted them in Painless
Make sure that field aliases count towards the total fields limit . __EoT__
Switch rolling restart to new style Requests __EoT__ In # 29623 we added ` Request ` object flavored requests to the low level REST client and in # 30315 we deprecated the old ` performRequest ` s . This changes all calls in the ` qa/rolling-upgrade ` project to use the new versions .
Fix multi level nested sort __EoT__ Multi level nested sort produces an invalid parent filter that contains a required clause at the wrong level . This can lead to document picking values from other documents . This change fixes this bug by removing the child query entirely from the parent filter . Multi level nested sort now creates a single parent query that match the level of documents that needs to be sorted and a child query that contains the nested filters at the deepest level ( where the sort field exists ) . This change also ensures that we cache only nested type filters in the bitset filter cache . ( https : //github.com/elastic/elasticsearch/issues/31783 ) Supersedes # 31776 Closes # 31554 Closes # 32130 Closes # 31783
Ensure that field aliases can not be used in multi-fields . __EoT__
Handle missing values in painless __EoT__ Throw an exception for doc [ 'field ' ] .value if this document is missing a value for the field . After deprecation changes have been backported to 6.x , make this a default behaviour in 7.0 Closes # 29286
Detect and prevent configuration that triggers a Gradle bug __EoT__ As we found in # 31862 , this can lead to a lot of wasted time as it 's not immediatly obvius what 's going on . Givent how many projects we have it 's getting increasingly easier to run into gradle/gradle # 847 .
[ test ] port linux package packaging tests __EoT__ Add packaging tests for the linux package distributions to the java test project and remove them from bats . Most of the tests that lived in 30_deb_package.bats and 40_rpm_package.bats are applicable to both package types and are combined into a single type of test case . Others are separated out into separate cases to make their intent more clear For # 26741
Add more contexts to painless execute api __EoT__ This change adds two contexts the execute scripts against : * SCORE_SCRIPT : Allows to run scripts in a score script context . This context is used in ` function_score ` query 's script function , * FILTER_SCRIPT : Allows to run scripts in a filter script context . This context is used in the ` script ` query . In both contexts a index name needs to be specified and a sample document . The document is needed to create an in-memory index that the script can access via the ` doc [ ... ] ` and other notations . The index name is needed because a mapping is needed to index the document . Examples : `` ` POST /_scripts/painless/_execute { `` script '' : { `` source '' : `` doc [ 'field ' ] .value.length ( ) '' } , `` execute_context '' : { `` score '' : { `` document '' : { `` field '' : `` four '' } , `` index '' : `` my-index '' } } } `` ` Returns : `` ` { `` result '' : 4 } ``
A replica can be promoted and started in one cluster state update __EoT__ When a replica is fully recovered ( i.e. , in ` POST_RECOVERY ` state ) we send a request to the master to start the shard . The master changes the state of the replica and publishes a cluster state to that effect . In certain cases , that cluster state can be processed on the node hosting the replica *together* with a cluster state that promotes that , now started , replica to a primary . This can happen due to cluster state batched processing or if the master died after having committed the cluster state that starts the shard but before publishing it to the node with the replica . If the master also held the primary shard , the new master node will remove the primary ( as it failed ) and will also immediately promote the replica ( thinking it is started ) . Sadly our code in IndexShard did n't allow for this which caused [ assertions ] ( https : //github.com/elastic/elasticsearch/blob/13917162ad5c59a96ccb4d6a81a5044546c45c22/server/src/main/java/org/elasticsearch/index/seqno/ReplicationTracker.java # L482 ) to be tripped in some of our tests runs .
[ DOCS ] Update TLS on Docker for 6.3 __EoT__ Remove references to the ` platinum ` image and add a self-generated trial licence to the example for TLS on Docker . Fixes elastic/elasticsearch-docker # 176
[ ML ] Move analyzer dependencies out of categorization config __EoT__ The ML config classes will shortly be moved to the X-Pack protocol library to allow the ML APIs to be moved to the high level REST client . Dependencies on server functionality should be removed from the config classes before this is done . This change is entirely about moving code between packages . It does not add or remove any functionality or tests .
Fix put mappings java API documentation __EoT__ The current docs of the [ put-mapping Java API ] ( https : //www.elastic.co/guide/en/elasticsearch/client/java-api/master/java-admin-indices.html # java-admin-indices-put-mapping ) is currently broken . In its current form , it creates an index and uses the whole mapping definition given as a JSON string as the type name . Since we did n't check the index created in the IndicesDocumentationIT , this went unnoticed so far . This change adds test to catch this error to the documentation test , changes the documentation so it works correctly now and adds an input validation to PutMappingRequest # buildFromSimplifiedDef ( ) which was used internally to reject calls where no mapping definition is given . Closes # 31906
put LIMIT 10 to the SQL query __EoT__ < ! -- Thank you for your interest in and contributing to Elasticsearch ! There are a few simple things to check before submitting your pull request that can help with the review process . You should delete these items from your submission , but they are here to help bring them to your attention . -- > - Have you signed the [ contributor license agreement ] ( https : //www.elastic.co/contributor-agreement ) ? - Have you followed the [ contributor guidelines ] ( https : //github.com/elastic/elasticsearch/blob/master/CONTRIBUTING.md ) ? - If submitting code , have you built your formula locally prior to submission with ` gradle check ` ? - If submitting code , is your pull request against master ? Unless there is a good reason otherwise , we prefer pull requests against master and will backport as needed . - If submitting code , have you checked that your submission is for an [ OS that we support ] ( https : //www.elastic.co/support/matrix # show_os ) ? - If you are submitting this code for a class then read our [ policy ] ( https : //github.com/elastic/elasticsearch/blob/master/CONTRIBUTING.md # contributing-as-part-of-a-class )
[ Rollup ] Replace RollupIT with a ESRestTestCase version __EoT__ The old RollupIT was a node IT , and flaky for a number of reasons . This new version is an ESRestTestCase and should be a little more robust . It shoould also be easier to add more varied tests in the future with this setup . This was added to the multi-node QA tests as that seemed like the most appropriate location . It did n't seem necessary to create a whole new QA module . Note : The only test that was ported was the `` Big '' test for validating a larger dataset . The rest of the tests are represented in existing yaml tests . Closes # 31258 Closes # 30232 Related to # 30290
Correct spelling of AnalysisPlugin # requriesAnalysisSettings __EoT__ This is a public helper method in an API that plugin authors are encouraged to use , so we need to deprecate the method name in 6.x and only remove it in master .
Convert Version to Java - clusterformation part1 __EoT__ - This allows to move all all .java files from the groovy source set - @ colings86 , this will prevent eclipse from tangling up in this setup . I tested it and eclipse shows no problems now . - make it possible to use Version from clusterformation Java code There is no change in functionality . There are also some additional tests for Version .
Add Expected Reciprocal Rank metric __EoT__ This change adds Expected Reciprocal Rank ( ERR ) as a ranking evaluation metric as descriped in : Chapelle , O. , Metlzer , D. , Zhang , Y. , & Grinspan , P. ( 2009 ) . Expected reciprocal rank for graded relevance . Proceeding of the 18th ACM Conference on Information and Knowledge Management . https : //doi.org/10.1145/1645953.1646033 ERR is an extension of the classical reciprocal rank to the graded relevance case and assumes a cascade browsing model . It quantifies the usefulness of a document at rank ` i ` conditioned on the degree of relevance of the items at ranks less than ` i ` . ERR seems to be gain traction as an alternative to ( n ) DCG , so it seems like a good metric to support . Also ERR seems to be the default optimization metric used for training in RankLib , a widely used learning to rank library . Relates to # 29653
SQL : Support for escape sequences __EoT__ Enhance grammar to allow JDBC/ODBC escape sequences , namely - date , time and timestamp { d `` } , { t `` } and { ts `` } - guid { guid `` } - LIKE escape { escape `` } - scalar function { fn } Fix # 31883
ingest : date_index_name processor template resolution __EoT__ This change adds support for template snippet ( e.g . ` { { foo } } ` ) resolution in the date_index_name processor . The following configuration options will now resolve a templated value if so configured : * index_name_prefix ( e.g `` index_name_prefix '' : `` myindex- ` { { foo } } ` - '' ) * date_rounding ( e.g . `` date_rounding '' : `` ` { { bar } } ` `` ) * index_name_format ( e.g . `` index_name_format '' : `` ` { { baz } } ` `` ) Example : `` ` POST _ingest/pipeline/_simulate { `` pipeline '' : { `` processors '' : [ { `` date_index_name '' : { `` field '' : `` @ timestamp '' , `` index_name_prefix '' : `` myindex- { { event_type } } - '' , `` date_rounding '' : `` { { index-period } } '' , `` index_name_format '' : `` { { index_format } } '' } } ] } , `` docs '' : [ { `` _source '' : { `` @ timestamp '' : `` 2018-07-04T12:00:00.000Z '' , `` event_type ''
[ X-Pack ] Beats centralized management : security role + licensing __EoT__ Resolves # 30493 . This PR adds : * a built-in role , ` beats_admin ` that provides unfettered access to the ` .management-beats ` index . The purpose of this index is to store configuration and other peripheral information to make the Beats Centralized Management feature work . * licensing-related logic for the Beats Centralized Management feature .
Painless : Restructure Definition/Whitelist __EoT__ Changes look long , but it 's just a combination of renaming several different related classes . The following changes are made : * Create lookup package * rename Definition to PainlessLookup and move to lookup package * rename Definition.Method to PainlessMethod * rename Definition.MethodKey to PainlessMethod * rename Definition.Field to PainlessField * rename Definition.Struct to PainlessClass * rename Definition.Cast to PainlessCast * rename Whitelist.Struct to WhitelistClass * rename Whitelist.Constructor to WhitelistConstructor * rename Whitelist.Method to WhitelistMethod * rename Whitelist.Field to WhitelistField
Check timeZone argument in AbstractSqlQueryRequest __EoT__ I think it 's not to judge whether timeZone is null .
Fix profiling of ordered terms aggs __EoT__ This change fixes the profiling of ` terms ` aggregation ordered by a sub aggregation . Closes # 22123
Do not return all indices if a specific alias is requested via get aliases api . __EoT__ If a get alias api call requests a specific alias pattern then indices not having any matching aliases should not be included in the response . This is a second attempt to fix this ( first attempt was # 28294 ) . The reason that the first attempt was reverted is because when xpack security is enabled then index expression ( like * or _all ) are resolved prior to when a request is processed in the get aliases transport action , then ` MetaData # findAliases ` ca n't know whether requested all where requested since it was already expanded in concrete alias names . This change now adds an additional field to the request calss that keeps track whether all aliases where requested . Closes # 27763
Get snapshot rest client cleanups __EoT__ This is a followup to # 31537 . It makes a number of changes requested by a review that came after the PR was merged . These are mostly cleanups and doc improvements .
Test : Do not remove xpack templates when cleaning __EoT__ At the end of every ` ESRestTestCase ` we clean the cluster which includes deleting all of the templates . If xpack is installed it 'll automatically recreate a few templates every time they are removed . Which is slow . This change stops the cleanup from removing the xpack templates . It cuts the time to run the docs tests more than in half and it probably saves a bit more time on other tests as well .
[ ML ] Limit ML filter items to 10K __EoT__ Add hard limit to the number of items a filter may have . This serves to protect from excessive overhead due to the filters taking too much memory or lookups becoming too expensive .
[ DOCS ] Add missing get mappings docs to HLRC __EoT__ This commit adds the high-level rest client docs for the get mappings API that was added in # 30889
DOC : Add examples to the SQL docs __EoT__ Wip on the documentation examples . Put the tests into a separate suite to help with clarity and isolation . The existing tests have different CVS tests ( that include data type among other things ) which are not relevant for the docs . Also moved the library dataset into the test suite . Additionally , used the same output from CLI in the JDBC test suite ( a different PR should eliminate the JdbcTestUtils output entirely and only use the ` CliFormatter ` ) . Once the infrastructure is in place , adding the examples goes quite smooth . I also like the SQL with table approach since it 's easier to read ( and applicable for all consumers - REST , JDBC , CLI ) .
Implemented XContent serialisation for GetIndexResponse __EoT__ This PR does the server side work for adding the Get Index API to the REST high-level-client . A follow up would be the client side changes .
[ DOCS ] Check for Windows and *nix file paths __EoT__ Occasional failures of the Docs snippet tests have happened on Windows recently where the error is a ML job can not be created because one with the same name already exists . ML jobs are supposed to be cleaned up after if the tests is an ML test based on the condition ` testName.contains ( `` ml/ '' ) ` See https : //elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/1724/console https : //elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-windows-compatibility/1721/console Looking at the test output : `` ` 1 > [ 2018-06-27T20:58:22,546 ] [ INFO ] [ o.e.s.XDocsClientYamlTestSuiteIT ] [ test { yaml=en\ml\functions/geo/line_78 } ] : after test ... ... some other none ML tests 1 > [ 2018-06-27T20:58:24,079 ] [ INFO ] [ o.e.s.XDocsClientYamlTestSuiteIT ] [ test { yaml=en\ml/aggregations/line_26 } ] : before test < -- this test fails because the last ML test was not cleaned up properly `` ` The difference is ` ml\ ` vs ` ml/ ` and the jobs are not cleaned up after the first test . ` XPackRestIT ` already contains the same check for Windows and *nix path separators .
[ ML ] Validate ML filter_id __EoT__ Like job and datafeed ids , the filter id should be validated with the same rules to avoid document ids that can be problematic .
Fix syntax errors in get-snapshots docs __EoT__ This is related to # 31537 . It fixes two syntax errors that are breaking the docs build .
Let the description match the example __EoT__
Correct integTest enable logic __EoT__ Run xPack plugin integration tests when not on oss distro
Upgrade gradle wrapper to 4.8 __EoT__ Switch to gradle 4.8 as discussed in # 31230 . Includes : - workaround Gradle issues - fix the test task replacement that broke in 4.8 and add a sanity check to detect if it happens again - add the possibility to compare build artifacts from builds . Useful to check that the changes to the build script did not cause untended changes for the artifacts . This is enabled with a property . Not strictly Gradle 4.8 but included here as some of the work was done in conjunction with JDK 11 : - javadoc corrections for problems detected by the newer version of doclint - rule in Gradle to always run test before integTest if both are available . Does not include : - remove usage of features deprecated in 4.8
Add support for switching distribution for all integration tests __EoT__ Allow using the ` tests.distribution ` property for telling integration tests which distribution to use . If the property is not present , integration tests for plugins will use ` integ-test-zip ` , qa integration tests will default to ` oss-zip ` , and x-pack qa to ` zip ` . When the property is present , integration tests will always honor it , meaning that integration tests will be skipped if they can not run against the specific distribution . e.x . we wo n't run ` x-pack/qa ` with ` -Dtests.distribution=oss-zip ` because we ca n't honor that , ignoring the property and running them with ` zip ` would just duplicate the work . TODO : - [ x ] make use of ` tests.distribution ` for plugins to switch distribution these run against - [ x ] add an info level log to mention which distribution was used when starting up the cluster - [ x ] skip the ` x-pack/plugins/build.gradle ` ( top level ) integration tests if distribution is not ` zip ` - [ x ] skip ` xpack-qa ` tests if `
QA : Create xpack yaml features __EoT__ This creates a YAML test `` features '' that indices if the cluster being tested has xpack installed ( ` xpack ` ) or if it does *not* have xpack installed ( ` no_xpack ` ) . It uses those features to centralize skipping a few tests that fail if xpack is installed . The plan is to use this in a followup to skip docs tests that require xpack when xpack is not installed . We *plan* to use the declaration of required license level on the docs page to generate the required ` skip ` . Closes # 30933 .
Close xcontent parsers ( partial ) __EoT__ I 'm working through the codebase trying to close every instance where we leave an XContentParser open ... there are a lot of them . I will follow with separate PR 's that enforce that we close XContentParsers . I recommend viewing this PR with & w=1 . If there 's too much here , I 'm happy to break it up into multiple different PRs . Relates # 30692
Correct the assertion arguments order __EoT__ Minor clean up PR that fixes the order of the assertion arguments ( high level REST client project )
[ DOCS ] Move sql to docs __EoT__ Related to https : //github.com/elastic/elasticsearch/issues/30665 This PR moves the content from x-pack/docs/en/sql to docs/reference/sql
Core : Combine doExecute methods in TransportAction __EoT__ TransportAction currently contains 2 doExecute methods , one which takes a the task , and one that does not . The latter is what some subclasses implement , while the first one just calls the latter , dropping the given task . This commit combines these methods , in favor of just always assuming a task is present .
Adds an API to remove ILM from an index completely __EoT__ The removal will only happen if the index is not in the shrink action I am not convinced the endpoint ` PUT { index } /_index_lifecycle/remove_policy ` is right here . It feels like this should be an endpoint with a DELETE method . I also think it might be misleading since the endpoint does more than remove the policy , it removes all ILM settings from the index . So maybe it would be better to have the endpoint as ` DELETE { index } /_index_lifecycle ` instead ? I also wonder if the set policy endpoint should actually be ` PUT { index } /_index_lifecycle/policy/ { policy_name } ` instead of the current ` PUT ` { index } /_index_lifecycle/set_policy/ { policy_name } ` ?
Docs : Add ccr to the cat thread pool doc test __EoT__ Since # 31251 , we use the default distribution to test docs . With this distribution , the cat thread-pool response will include the ccr thread-pool . This commit adjusts ` /_cat/thread_pool ` doc to include ccr . Relates # 31251
Docs : Advice for reindexing many indices __EoT__ Folks tend to want to be able to make a single ` _reindex ` call to migrate many indices . You *can* do that and we even have an example of how to do that in the docs but it is n't always a good idea . This change adds some advice to the docs : generally you want to make one reindex call per index . Closes # 22920
Make release notes ignore the ` > test-failure ` label . __EoT__ This label is uninteresting for release notes .
Docs : Use the default distribution to test docs __EoT__ Switch the docs tests from the ` oss-zip ` distribution to the ` zip ` distribution which contains x-pack . This should allow us to fold the x-pack docs into the oss ones . You can continue to run the docs tests with the oss distribution with ` ./gradlew -p docs -Dtests.distribution=oss-zip ` . Relates to # 30665 .
Expose lucene 's RemoveDuplicatesTokenFilter __EoT__ This will be useful in combination with the multiplexer in https : //github.com/elastic/elasticsearch/pull/31208
SQL : Fix rest endpoint names in node stats __EoT__ Fixes wrong name for the sql translate endpoint and makes rest endpoint names in stats more consistent .
Rankeval : Fold template test project into main module __EoT__ This change moves tests in ` smoke-test-rank-eval-with-mustache ` into the main ranking evaluation module by declaring that the integration testing cluster requires the ` lang-mustache ` plugin . This avoids having to maintain the qa project for only one basic test suite .
[ Docs ] Remove reference to repository-s3 plugin creating an S3 bucket __EoT__ Closes # 30910
Describe how to add a plugin in Dockerfile __EoT__ When installing a plugin , people need to add the ` -- batch ` option . It 's better to document it as it could be a common use case .
Test : Remove broken yml test feature __EoT__ The ` requires_replica ` yaml test feature has n't worked for years . This is what happens if you try to use it : `` ` > Throwable # 1 : java.lang.NullPointerException > at __randomizedtesting.SeedInfo.seed ( [ E6602FB306244B12:6E341069A8D826EA ] :0 ) > at org.elasticsearch.test.rest.yaml.Features.areAllSupported ( Features.java:58 ) > at org.elasticsearch.test.rest.yaml.section.SkipSection.skip ( SkipSection.java:144 ) > at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test ( ESClientYamlSuiteTestCase.java:321 ) `` ` None of our tests use it .
Set analyzer version in PreBuiltAnalyzerProviderFactory __EoT__ instead of lamda that creates the analyzer . Relates to # 31143
Modify pipelining handlers to require full requests __EoT__ Currently the http pipelining handlers seem to support chunked http content . However , this does not make sense . There is a content aggregator in the pipeline before the pipelining handler . This means the pipelining handler should only see full http messages . Additionally , the request handler immediately after the pipelining handler only supports full messages . This commit modifies both nio and netty4 pipelining handlers to assert that an inbound message is a full http message . Additionally it removes the tests for chunked content .
Use armored input stream for reading public key __EoT__ This was silly ; Bouncy Castle has an armored input stream for reading keys in ASCII armor format . This means that we do not need to strip the header ourselves and base64 decode the key . This had problems anyway because of discrepancies in the padding that Bouncy Castle would produce and the JDK base64 decoder was expecting . Now that we armor input/output the whole way during tests , we fix all random failures in test cases too . Closes # 30900
REST hl client : adjust wait_for_active_shards param in cluster health __EoT__ The default wait_for_active_shards is NONE for cluster health , which differs from all the other API in master , hence we need to make sure to set the parameter whenever it differs from NONE ( 0 ) . The test around this also had a bug , which is why this was not originally uncovered . Note that this PR targets master only as in 6.x the problem was resolved while backporting , given that other already supported API already have a different default there , which also helped uncovering the issue . This change also aligns the ` setRandomWaitForActiveShards ` with the existing corresponding method from 6.x . Relates to # 29331
REST high-level Client : remove deprecated API methods __EoT__ This PR removes all the API methods that accept a ` Header ` varargs argument , in favour of the newly introduced API methods that accept a ` RequestOptions ` argument . Relates to # 31069
SyncedFlushResponse to implement ToXContentObject __EoT__ The response currently implements ToXContentFragment although the only time it 's used it is supposed to print out a complete object rather than a fragment . Note that this is the client version of the response , used only in the high-level client .
Remove some line length supressions __EoT__ Sporadic service commit that removes some Checkstyle suppresions that are no longer needed . Opening the PR mainly to get a clean CI run .
Move ESIndexLevelReplicationTestCase to test framework __EoT__ Other components might benefit from the testing infra provided by ESIndexLevelReplicationTestCase . This commit moves it to the test framework .
Move default location of dependencies report __EoT__ This commit moves the default location of the full dependencies report to be under the reports directory to align it with the location for the dependenciesInfo task output .
MLT query : missing documentation for ` fail_on_unsupported_field ` __EoT__ https : //github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java # L798 ` fail_on_unsupported_field ` is not documented https : //www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html
Remove extraneous references to 'tokenized ' in the mapper code . __EoT__ These are likely left over from when there were three options for the ` index ` mapping ( ` no ` , ` analyzed ` , and ` not_analyzed ` ) .
Add support for ignore_unmapped to geo sort __EoT__ Adds support for ` ignore_unmapped ` parameter in geo distance sorting , which is functionally equivalent to specifying an ` unmapped_type ` in the field sort . Closes # 28152
Use a ` _recovery_source ` if source is omitted or modified __EoT__ Today if a user omits the ` _source ` entirely or modifies the source on indexing we have no chance to re-create the document after it has been added . This is an issue for CCR and recovery based on soft deletes which we are going to make the default . This change adds an additional recovery source if the source is disabled or modified that is only kept around until the document leaves the retention policy window . This change adds a merge policy that efficiently removes this extra source on merge for all document that are live and not in the retention policy window anymore . it 's not fully tested and needs some cleanups but I wanted to put it out here for discussion .
Pass main class by environment variable on Windows __EoT__ A previous refactoring of the CLI scripts migrated all of the CLI tools to shell to a common script , elasticsearch-cli . This approach is fine in Bash where it is easy to tear arguments apart but it does n't work so well on Windows where quoting is insane . To avoid having to tear the arguments apart to separate the first argument to elasticsearch-cli from the remaining arguments , we instead choose a strategy where we can avoid tearing the arguments apart . To do this , we will instead pass the main class by an environment variable and then we can pass the arguments straight through . This will let us avoid awful quoting issues on Windows . This is the Windows side of that effort and the Bash side was in a previous commit . Relates # 31058
[ DOCS ] Moves X-Pack setup to docs __EoT__ Related to https : //github.com/elastic/elasticsearch/issues/30665 This PR copies the x-pack/docs/en/setup contents to docs/reference/setup folder in the elasticsearch repo . It also removes some pages and images that are no longer used and adds info about the minimum required subscription level for testing purposes .
Add check for feature aware implementations __EoT__ This commit adds a check that any class in X-Pack that is a feature aware custom also implements the appropriate mix-in interface in X-Pack . These interfaces provide a default implementation of FeatureAware # getRequiredFeature that returns that x-pack is the required feature . By implementing this interface , this gives a consistent way for X-Pack feature aware customs to return the appopriate required feature and this check enforces that all such feature aware customs return the appropriate required feature . Relates # 31020
Replace exact numDocs by soft-del count in SegmentCommitInfo __EoT__ This PR adapts/utilizes recent enhancements in Lucene-7.4 : 1 . Replaces exactNumDocs by the soft-deletes count in SegmentCommitInfo . This enhancement allows us to back out changes introduced in # 30228 . 2 . Always configure the soft-deletes field in IWC
Change ObjectParser exception __EoT__ ObjectParser should throw XContentParseExceptions , not IAE . A dedicated parsing exception can includes the place where the error occurred . Closes # 30605
Transport client : Do n't validate node in handshake __EoT__ This is related to # 30141 . Right now in the transport client we open a temporary node connection and take the node information . This node information is used to open a permanent connection that is used for the client . However , we continue to use the configured transport address . If the configured transport address is a load balancer , you might connect to a different node for the permanent connection . This causes the handshake validation to fail . This commit removes the handshake validation for the transport client .
Enabling testing against an external cluster __EoT__ Today when executing REST tests we take full responsibility for cluster configuration . Yet , there are use cases for brining your own cluster to the REST tests . This commit is a small first step towards that effort by skipping creating the cluster if the tests.rest.cluster and test.cluster system properties are set . In this case , the user takes full responsibility for configuring the cluster as expected by the REST tests . This step is by no means meant to be perfect or complete , only a baby step .
[ docs ] explainer for java packaging tests __EoT__ Follow up from https : //github.com/elastic/elasticsearch/pull/30734
ScatterDataSet.copy ( ) misses some relevant values __EoT__ For example , method should include `` ` copied.setDrawValues ( isDrawValuesEnabled ( ) ) ; `` ` Without it , the mDrawValues is lost during the copy .
Pie Chart label text outside slice overlaps with value line . __EoT__ Hi , While working with a pie charts I found out that if you are drawing labels ( only ) outside the slices the text of labels overlaps with the value line . I just commented this ` dataSet.setYValuePosition ( PieDataSet.ValuePosition.OUTSIDE_SLICE ) ; ` in https : //github.com/PhilJay/MPAndroidChart/blob/master/MPChartExample/src/com/xxmassdeveloper/mpchartexample/PiePolylineChartActivity.java : ! [ screenshot_20160805-040515 ] ( https : //cloud.githubusercontent.com/assets/14310139/17420740/3fc1ae00-5ac2-11e6-8a32-76e1069d9bcc.png ) Please let me know if there is a setting for setting label text offset . As a workaround I 've set offset in drawValues to labelRadius/2 instead of 5.f but I guess that will might mess other things up .
Use PieChart : When a slice is smaller than 0.1 % , the chart background changed it ` s color to this slice __EoT__ PieChartRenderer.drawDataSet ( ) : if ( sweepAngleOuter % 360f == 0.f ) { // Android is doing `` mod 360 '' mPathBuffer.addCircle ( center.x , center.y , innerRadius , Path.Direction.CCW ) ; } in this case sweepAngleOuter ==0
How to show the X-labels on the marker view in LineChart ? ? __EoT__ `` ` public class MymarkerView extends MarkerView { private TextView indices ; public MymarkerView ( Context context , int layoutResource ) { super ( context , layoutResource ) ; indices = ( TextView ) findViewById ( R.id.indices ) ; } // callbacks everytime the MarkerView is redrawn , can be used to update the // content ( user-interface ) @ Override public void refreshContent ( Entry e , Highlight highlight ) { indices.setText ( `` Indices : '' +e.getVal ( ) ) ; } @ Override public int getXOffset ( float xpos ) { // this will center the marker-view horizontally return - ( getWidth ( ) / 2 ) ; } @ Override public int getYOffset ( float ypos ) { // this will cause the marker-view to be above the selected value return -getHeight ( ) ; } @ Override public void draw ( Canvas canvas , float posx , float posy ) { // take offsets into consideration posx += getXOffset ( posx ) ; posy=0 ; // AVOID OFFSCREEN if ( posx < 60 ) posx=60 ; if ( posx > 360
Legend not visible on first draw __EoT__ In the demo - PieChartActivity : When I set l.setPosition ( LegendPosition.BELOW_OF_XXX ) , the legend was gone , but set in other directions was visible . Version:3.0.0-beta1
Performance + Crash fix ( # 1892 ) ( # 1895 ) __EoT__ This pull request contains -- 1 ) All the allocation optimizations to the library , including unit tests for new classes . ( # 1892 ) 2 ) Bitmap buffering of drawn circles in LineChartRenderer ( # 1892 ) 3 ) Crash fix and stress test for ( # 1895 ) Note -- This change set will require approving a pull request in the MPAndroidChart-Realm project , to account for a new abstract method to retrieve the number of circle colors . https : //github.com/PhilJay/MPAndroidChart-Realm/pull/1
Eliminate GC-induced stuttering during animations by eliminating wasteful allocations __EoT__ I noticed that the Realtime chart demo can stutter due to many repeated and wasteful allocations in sections of code that are called in each update of the data , and it would be great to smooth out the animations and remove stuttering . I 've so far identified , verified , and tested ways to reduce the number of allocations by approximately 70 % and memory consumed by about 30 % , with an attendant improvement in animation quality through various means , such as : 1 . Eliminating the use of convenience iterations in favor of old fashioned iteration . for ( ; ; ) { } instead of for ( Object foo : inSet ) { } 2 . Caching the results of String Formatting and using those cached results when the value in the dataset has not changed 3 . Using field level references to store short-lived instances within methods and re-setting them instead of instantiating a new one eg 1 : instead of instantiating a float [ ] temp = new float [ 2 ] ; inside a method declare the float [ ] as
Custom shape renderer - easy to implement - Optemised - with no Bold __EoT__ Hi . This version has no boldness control
The Chart is not redrawn when the data is null after initiating the chart __EoT__ Hi Guys , i 'm using this amazing library , its easy and beautiful , tks . I will try to explain what happens , and below the explanation put the source code . When I start any of the charts , and use the setData the first time with a null data , the message `` The chart data available . '' is displayed . But if I start the chart , and use the setData chart with data , the char is displayed OK. Then , i call the setData again to `` update '' the chart with another period , and this period has a null data , like the first explanation , the message is not displayed . I call invalidate ( ) after setData , call notifyDataSetChanged ( ) too , but the chart is not redrawn with the correct message , that is no data available . Doing some test , if you setData with some numbers , after that call chart.clear ( ) ( internally this set mData to null ) and call invalidate ( ) , the
Unable to setGranularityEnabled to false __EoT__ Yaxis.java public void setGranularityEnabled ( boolean enabled ) { mGranularityEnabled = true ; } Since above method always uses true instead of `` enabled '' parameter which does not allow me to setGranularity to false
Bug in BarLineChartBase.zoom __EoT__ I do n't understand why ` y ` is negated here : `` ` public void zoom ( float scaleX , float scaleY , float x , float y ) { Matrix save = mViewPortHandler.zoom ( scaleX , scaleY , x , -y ) ; mViewPortHandler.refresh ( save , this , false ) ; // Range might have changed , which means that Y-axis labels // could have changed in size , affecting Y-axis size . // So we need to recalculate offsets . calculateOffsets ( ) ; postInvalidate ( ) ; } `` ` should it read `` ` public void zoom ( float scaleX , float scaleY , float x , float y ) { Matrix save = mViewPortHandler.zoom ( scaleX , scaleY , x , y ) ; mViewPortHandler.refresh ( save , this , false ) ; // Range might have changed , which means that Y-axis labels // could have changed in size , affecting Y-axis size . // So we need to recalculate offsets . calculateOffsets ( ) ; postInvalidate ( ) ; } `` ` I do notice a bug in double-tap to zoom not zooming on the double-tap-point but
Translation is corrupted while applying zoom limit . __EoT__ Translation is corrupted while applying zoom limit . I set viewport limits using ` mChart.getViewPortHandler ( ) .setMinimumScaleX ( 20 ) ; mChart.getViewPortHandler ( ) .setMaximumScaleX ( 500 ) ; ` when zooming ` mChart.zoom ( mChart.isScaleXEnabled ( ) ? 1.4f : 1f , mChart.isScaleYEnabled ( ) ? 1.4f : 1f , trans.x , trans.y ) ; ` new matrix is computed , which includes new zoom and new translation . Subsequently . zoom limits are applied in ViewPortHandler.limitTransAndScale . However , if the scale is clipped here to the zoom limit , the translation is not adjusted for the clip . The result is extreme translation jitter when pinch-zooming in beyond a limit . The fix is to either clip the scale before computing new matrix , or to adjust translation after clipping scale .
can not compile example __EoT__ in master== > /mnt/workbench/MPAndroidChart/MPChartExample/build/intermediates/classes/debug/io/realm/RealmFloatRealmProxy.java:62 : error : method does not override or implement a method from a supertype @ Override ^ my java version : bysong @ bysong-OptiPlex-790 : ~/w/MPAndroidChart $ java -version java version `` 1.7.0_91 '' OpenJDK Runtime Environment ( IcedTea 2.6.3 ) ( 7u91-2.6.3-0ubuntu0.14.04.1 ) OpenJDK 64-Bit Server VM ( build 24.91-b01 , mixed mode ) bysong @ bysong-OptiPlex-790 : ~/w/MPAndroidChart $ i try with this java , but result is same : bysong @ bysong-OptiPlex-790 : /mnt/workbench/android $ java -version java version `` 1.7.0_55 '' Java ( TM ) SE Runtime Environment ( build 1.7.0_55-b13 ) Java HotSpot ( TM ) 64-Bit Server VM ( build 24.55-b03 , mixed mode ) bysong @ bysong-OptiPlex-790 : /mnt/workbench/android $ but in tag v2.2.0 all are ok for me .
Can not compile after update to 2.2.0 __EoT__ `` ` java final BarDataSet dataSet = barChartView.getData ( ) .getDataSetByIndex ( 0 ) ; `` ` `` ` error : incompatible types : IBarDataSet can not be converted to BarDataSet `` `
conflict when using colors with transparency __EoT__ It seems that using colors with transparency on a pie chart causes other colors to be affected . e.g . `` ` java ArrayList < Integer > colors = new ArrayList < Integer > ( ) ; colors.add ( Color.parseColor ( `` # 80FF0000 '' ) ) ; //transparent red colors.add ( Color.parseColor ( `` # FF0000FF '' ) ) ; //solid blue dataSet.setColors ( colors ) ; `` ` This causes the pie chart colors to be transparent red and transparent blue when there are an odd number of segments , and solid red and solid blue when there are an even number of segments . It seems like whichever color is drawn last , has it 's opacity applied to all segments . I think it 's something to do with the Paint ( ) object being reused . Will investigate further .
PieChart onNothingSelected not firing when clicking outside of the chart __EoT__ Hi , Thanks for this awesome library you 've made . I 'm trying to create a PieChart that has inside it some textviews that are changing values according to the highlighted slice . However , I 've noticed that if a slice is selected and then the user clicks outside of the chart , it goes unselected without firing ` onNothingSelected ` from a ` OnChartValueSelectedListener ` ( I want to display back the default texts ) . Would it be possible to fire ` onNothingSelected ` also in this case ? Thanks a lot , Tudor
ScatterChart array size check __EoT__ First off thanks for the great library . It really makes life a lot easier . I have one small issue with one of your sanity checks though : I get a ` IllegalStateException ` even though everything should work fine , and the reason ( as the error perfectly points out ) is that the entry array is actually larger than the x-values array . This normally would n't work for charts , but in the case of my ` ScatterChart ` it makes perfect sense as there can be more than on entry per x-index . For the time being this can be fixed by adding arbitrary x-values to the end , but that 's not a perfect solution . If the x-indices of all entries match a corresponding x-index in the x-values array the chart should n't cause a crash .
MarketView not shown in HorizontalBarchart __EoT__ Hello , Im implementing an android app using your amazing chart library . However , I have a small problem with the markerview . The refreshContent method doesnt get called when I click on the horizontal bar chart . There is a question about this issue on Stackoverflow but have not been answered yet : http : //stackoverflow.com/questions/30319466/markerview-in-mpandroidchart For the PieChart , I have not tried yet but as you stated in the below question : http : //stackoverflow.com/questions/30319159/mpandroidchart-piechart-is-not-showing-markerview I think the HorizontalBarChart does support the Markerview . Ps : The marketview that im using works fine for the LineChart Thanks
Highlight Values but disable selecting values __EoT__ First of all : Thanks for sharing this amazingly flexible library . I have one remark : You can disable all touch events but not only the selection event . I want to show multiple read-only markers but not lose the zooming functionality . It would also be cool if the markers could be between two points .
Toggle lines with enabled marker causes crash __EoT__ When you enable a marker and start togling lines in a chart , suddenly the app crashes without apparent reason . Please see this video : https : //www.youtube.com/watch ? v=mLWn1Rgitak Here is the logcat : `` ` java 07-27 11:23:09.427 2330-2330/cl.tidchile.agrovva E/AndroidRuntime﹕ FATAL EXCEPTION : main Process : cl.tidchile.agrovva , PID : 2330 java.lang.IndexOutOfBoundsException : Invalid index 3 , size is 3 at java.util.ArrayList.throwIndexOutOfBoundsException ( ArrayList.java:255 ) at java.util.ArrayList.get ( ArrayList.java:308 ) at com.github.mikephil.charting.data.ChartData.getEntryForHighlight ( ChartData.java:475 ) at com.github.mikephil.charting.charts.Chart.drawMarkers ( Chart.java:567 ) at com.github.mikephil.charting.charts.BarLineChartBase.onDraw ( BarLineChartBase.java:241 ) at android.view.View.draw ( View.java:15249 ) at android.view.View.draw ( View.java:15158 ) at android.view.ViewGroup.drawChild ( ViewGroup.java:3407 ) at android.view.ViewGroup.dispatchDraw ( ViewGroup.java:3200 ) at android.view.View.draw ( View.java:15156 ) at android.view.ViewGroup.drawChild ( ViewGroup.java:3407 ) at android.view.ViewGroup.dispatchDraw ( ViewGroup.java:3200 ) at android.view.View.draw ( View.java:15252 ) at android.support.v4.view.ViewPager.draw ( ViewPager.java:2176 ) at android.view.View.buildDrawingCacheImpl ( View.java:14495 ) at android.view.View.buildDrawingCache ( View.java:14357 ) at android.view.View.updateDisplayListIfDirty ( View.java:14166 ) at android.view.View.getDisplayList ( View.java:14207 ) at android.view.ViewGroup.recreateChildDisplayList ( ViewGroup.java:3391 ) at android.view.ViewGroup.dispatchGetDisplayList ( ViewGroup.java:3370 ) at android.view.View.updateDisplayListIfDirty ( View.java:14145 ) at android.view.View.getDisplayList ( View.java:14207 ) at android.view.ViewGroup.recreateChildDisplayList ( ViewGroup.java:3391 ) at android.view.ViewGroup.dispatchGetDisplayList ( ViewGroup.java:3370 ) at android.view.View.updateDisplayListIfDirty ( View.java:14145 ) at android.view.View.getDisplayList ( View.java:14207
PieChartRenderer crash __EoT__ I 've received a lot of report from my users . The problem that they faced is this . java.lang.IllegalArgumentException : width and height must be > 0 at android.graphics.Bitmap.createBitmap ( Bitmap.java:922 ) at android.graphics.Bitmap.createBitmap ( Bitmap.java:901 ) at android.graphics.Bitmap.createBitmap ( Bitmap.java:868 ) at com.github.mikephil.charting.renderer.PieChartRenderer.drawData ( PieChartRenderer.java:79 ) at com.github.mikephil.charting.charts.PieChart.onDraw ( PieChart.java:96 ) at android.view.View.draw ( View.java:15423 ) at android.view.View.getDisplayList ( View.java:14317 ) at android.view.View.getDisplayList ( View.java:14359 ) at android.view.ViewGroup.dispatchGetDisplayList ( ViewGroup.java:3296 ) at android.view.View.getDisplayList ( View.java:14254 ) at android.view.View.getDisplayList ( View.java:14359 ) at android.view.View.draw ( View.java:15137 ) at android.view.ViewGroup.drawChild ( ViewGroup.java:3322 ) at android.view.ViewGroup.dispatchDraw ( ViewGroup.java:3158 ) at android.view.View.getDisplayList ( View.java:14312 ) at android.view.View.getDisplayList ( View.java:14359 ) at android.view.View.draw ( View.java:15137 ) at android.view.ViewGroup.drawChild ( ViewGroup.java:3322 ) at android.view.ViewGroup.dispatchDraw ( ViewGroup.java:3158 ) at android.view.View.draw ( View.java:15426 ) at android.view.View.getDisplayList ( View.java:14317 ) at android.view.View.getDisplayList ( View.java:14359 ) at android.view.View.draw ( View.java:15137 ) at android.view.ViewGroup.drawChild ( ViewGroup.java:3322 ) at android.view.ViewGroup.dispatchDraw ( ViewGroup.java:3158 ) at android.view.View.getDisplayList ( View.java:14312 ) at android.view.View.getDisplayList ( View.java:14359 ) at android.view.View.draw ( View.java:15137 ) at android.view.ViewGroup.drawChild ( ViewGroup.java:3322 ) at android.view.ViewGroup.dispatchDraw ( ViewGroup.java:3158 ) at android.view.View.getDisplayList ( View.java:14312 ) at android.view.View.getDisplayList ( View.java:14359 ) at android.view.View.draw ( View.java:15137 ) at android.view.ViewGroup.drawChild ( ViewGroup.java:3322
Cubic LineChart with 3 values or less __EoT__ I 'm facing a bug in v2.0.9 version of library . LineCharts with 3 or less values are not drawn properly . If I draw y values , they are visible on proper places , but line itself with fill is not visible .
PieChartRenderer drawCenterText lineHeight calculation should not depend on first line __EoT__ If the center text of a PieChart is set to a multi line string and the first line only contains characters with a small text height , but the second line has character with full text height , the calculated line height is too small . The following screenshots illustrate the difference with the first line text being `` aaaa '' or `` bbbb '' . ! [ aaaa ] ( https : //cloud.githubusercontent.com/assets/1485456/6781530/9eb09658-d16e-11e4-9503-ac2462885360.png ) ! [ b ] ( https : //cloud.githubusercontent.com/assets/1485456/6781531/9eb3e5f6-d16e-11e4-96e9-e7447239741a.png )
ChartData.getDataSetByLabel method bug __EoT__ hi PhilJay : the ChartData class getDataSetByLabel method should not be add `` = '' , because index may be equals `` 0 '' if ( index < =0 || index > = mDataSets.size ( ) ) return null ;
Empty Pie Chart crashes the application when click it __EoT__ **When i click on empty Pie Chart it craches my app and this is my logcat : ** `` ` java.lang.NullPointerException at com.example.mymoneypocket.reports.NewIVsE $ 1.onValueSelected ( NewIVsE.java:126 ) at com.github.mikephil.charting.charts.Chart.highlightTouch ( Chart.java:1077 ) at com.github.mikephil.charting.listener.PieRadarChartTouchListener.onSingleTapUp ( PieRadarChartTouchListener.java:123 ) at android.view.GestureDetector.onTouchEvent ( GestureDetector.java:595 ) at com.github.mikephil.charting.listener.PieRadarChartTouchListener.onTouch ( PieRadarChartTouchListener.java:39 ) at com.github.mikephil.charting.charts.PieRadarChartBase.onTouchEvent ( PieRadarChartBase.java:56 ) `` ` **I also note that the example demo have the same problem ! **
mFilledPaint not used in LineChart __EoT__ The field mFilledPaint is not used to draw the filled graph in the LineChart component .
BUG : PieChart .setTouchEnabled ( false ) do n't work __EoT__ Solve : PieChart.class @ Override public boolean onTouchEvent ( MotionEvent event ) { `` ` // use the piecharts own listener if ( mTouchEnabled ) { return mListener.onTouch ( this , event ) ; } return super.onTouchEvent ( event ) ; } `` `
某大厂面试题 __EoT__ 题目： 一个 ` “ . ” ` 代表一个任意字母。 注意事项：可以假设所有的单词只包含小写字母 ` “ a-z ” ` 样例： `` ` java addWord ( “ bad ” ) ; addWord ( “ dad ” ) ; addWord ( “ mad ” ) ; search ( “ pad ” ) ; // return false ; search ( “ bad ” ) ; // return true ; search ( “ .ad ” ) ; // return true ; search ( “ b.. ” ) ; // return true ; `` ` 如果有并发的情况下， ` addWord ( ) ` 怎么处理？
Shared Aeron __EoT__ random Aeron streamId for shared environment
DL4J Issues/Fixes __EoT__ Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6611 Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6609 Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6619 Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6632 More to come .
encodeBitmap CUDA v100 fix __EoT__ encodeBitmap fix for v100 sync
Spark fixes + improvements __EoT__ Also adds a way to easily configure the worker GC settings .
Upgrade spring version __EoT__ Spring is only used in ND4J tests anyway . I 've run the tests that use it locally , so I 'll skip the CI run on this one ...
Test fixes + YOLO2 validation usability improvement __EoT__ Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6591 Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6584
Jumpy : TF Import - multi-in multi-out fix __EoT__
Revert `` Gaussian distribution fix '' __EoT__ Reverts deeplearning4j/deeplearning4j # 6564 CUDA looks fine , CPU randn is broken . Will DM details .
Gaussian distribution fix __EoT__ This PR fixes gaussian distribution for CUDA and x86 . Addressing issue # 6518
Always use US Locale when formatting numbers with NDArrayStrings __EoT__ On Systems with a locale where a ` , ` is used as a decimal separator the problem arises where ` Nd4j.writeTxt ` produces invalid JSON . This PR changes it so always US is used as the locale when formatting arrays .
Add support for TensorFlow SavedModel to GraphRunner __EoT__ This format is used by ` tf.saved_model.simple_save ` and TensorFlow Serving , so I think we should add support : https : //www.tensorflow.org/guide/saved_model Tests pass with new resources from https : //github.com/deeplearning4j/dl4j-test-resources/pull/162
More Misc DL4J/ND4J Fixes __EoT__ Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6483 Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6362 Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6347 Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6276
jumpy : basic tests + minor fixes __EoT__
[ WIP ] spark fault tolerance __EoT__ This PR adds fault tolerance tweaks to gradients sharing implementation
pydatavec release prep __EoT__
rem datavec uberjar __EoT__
Shyrma split space __EoT__ fixing split and space_to_batch ops
Arbiter fixes __EoT__ Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6264 Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6263
[ WIP ] Ongoing updates to docs __EoT__ Placeholder PR for work-in-progress branch for documentation .
repair scatter helper __EoT__ correct scatter helper for case when indexes is scalar and updates is vector
DL4J : Javadoc pass __EoT__ Now that we are relying on javadoc for our autogen docs , it 's even more important that the javadoc is complete and high quality . Also fixes up a number of formatting issues in the javadoc - mainly links ( making them proper `` ` < a href= '' ... '' > ... < /a > `` ` format ) and code ( making them `` ` { @ code ... } `` ` format ) . Also cleans up some stuff I noted in the process .
Fix copyright headers for nd4j and deeplearning4j-dataimport-solrj __EoT__
DataVec : add CSVMultiSequenceRecordReader __EoT__ Fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/6088
Arbiter enhancements __EoT__ https : //github.com/deeplearning4j/deeplearning4j/issues/6062
libnd4j : need op equivalent to INDArray.size ( int ) __EoT__ We can close this ( https : //github.com/deeplearning4j/deeplearning4j/issues/6078 ) , and I 'll do it in Java if I have this simple op that mimics INDArray.size ( int ) . Input : 1 NDArray arg , 1 integer 'dimension ' arg . Output : rank 0 NDArray , with value equivalent to INDArray.size ( dimension ) Edit : needs to support negative values for dimension arg also .
Fix build due to recent API change __EoT__
Missing advanced activations and Keras support __EoT__
Shyrma prelu2 __EoT__ - provide required additional functionality in prelu op , namely add possibility of passing shared_axes parameter which defines axes along which to share learnable parameters for the activation function - add more corresponding tests
update keras docs __EoT__
Update version of OpenBLAS to 0.3.2.dev __EoT__ I 've tested that a bit here and it seems to work fine for me . @ AlexDBlack @ maxpumperla @ raver119 If you guys see any weird failures over the next few days though , check this first .
Few more fixes __EoT__ This PR fixes few more tests
[ WIP ] Import inception v4 __EoT__
Add RecordConverter.toRecord ( Schema , List < Object > ) __EoT__ This allows for easy interoperability between POJOs and DataVec . Example usage : `` ` java SomeDTO example ; // comes from somewhere , and has the fields a : Int , b : double , c : String Schema schema = new Schema.Builder ( ) .addColumnInteger ( `` CountOfA '' ) .addColumnDouble ( `` PriceOfA '' ) .addColumnCategorical ( `` Category '' , `` Foo '' , `` Bar '' ) .build ( ) ; // can now be used with , e.g . a TransformProcess List < Writable > record = RecordConverter.toRecord ( schema , Arrays.asList ( example.getA ( ) , example.getB ( ) , example.getC ( ) ) ) ; `` `
Small PR __EoT__ range fix for Serhii
keras model import - can not get keras inception v3 pretrained weights file to work __EoT__ I tried to load a keras 2 - inception v3 weights file with dl4j model import 1.0.0-beta version , but receiving this error , while trying to revive the computational graph . ` org.deeplearning4j.exception.DL4JInvalidConfigException : Invalid configuration for layer ( idx=-1 , name=conv2d_5 , type=ConvolutionLayer ) for height dimension : Invalid input configuration for kernel height . Require 0 < kH < = inHeight + 2*padH ; got ( kH=3 , inHeight=0 , padH=0 ) Input type = InputTypeConvolutional ( h=0 , w=0 , c=3 ) , kernel = [ 3 , 3 ] , strides = [ 2 , 2 ] , padding = [ 0 , 0 ] , layer size ( output channels ) = 32 , convolution mode = Truncate ` I checked with dl4j model import modules test and saw that you have ignored that test for some reason : https : //github.com/deeplearning4j/deeplearning4j/blob/master/deeplearning4j/deeplearning4j-modelimport/src/test/java/org/deeplearning4j/nn/modelimport/keras/e2e/KerasModelEndToEndTest.java # L410-L419 I also verified that , the keras model that has been used here `` inception_v3_complete.h5 '' is a keras-1 model but you have a keras-2 weights file in test resources : https : //github.com/deeplearning4j/dl4j-test-resources/tree/master/src/main/resources/modelimport/keras/examples/inception
Fix Kuromoji dictionary file download __EoT__ The previous logic would bail with an IOException if the directory existed . DL4JResources.getDirectory helpfully creates the directory that you ask for it so this will fail if you have n't downloaded kuromoji previously .
Few CUDA fixes __EoT__ This PR fixes for few failing nd4j-tests and adds executioner type method .
SameDiff : Even more javadoc __EoT__
[ WIP ] SameDiff Javadoc __EoT__ JavaDoc pass in preparation for generating SameDiff docs . Much more to come . cc @ maxpumperla Also fixes : https : //github.com/deeplearning4j/deeplearning4j/issues/5753
File choosers empty text overlapping __EoT__ ! [ ] ( https : //i.imgur.com/luELELn.jpg )
Title can get cut off on the end when the dialog has an icon __EoT__ Noticeable with certain titles , and not others . Using text that does n't word-break , like letters with no spaces repros the issue pretty easily . < img width= '' 300 '' alt= '' screen shot 2018-09-10 at 2 04 19 pm '' src= '' https : //user-images.githubusercontent.com/1820165/45324310-9b029580-b502-11e8-8408-0abb64ed998d.png '' >
Dialog callbacks not working in 2.0.0-alpha01 __EoT__ I must 've broken something right before release , woops . This is show , cancel , and dismiss listeners .
Custom InputFilter for input dialog __EoT__ - [ x ] I have verified there are no duplicate active or recent bugs , questions , or requests - [ x ] I have verified that I am using the latest version of Material Dialogs . - [ x ] I have given my issue a non-generic title . - [ x ] I have read over the documentation ( before asking questions on how to do something ) . # # # # # # Include the following : - Material Dialogs version : ` 0.9.6.0 ` # # # # # # Reproduction Steps 1 . Configuring a Input Dialog using the builder pattern # # # # # # Expected Result Some way to specify custom InputFilters ( which are helpful if input must match a certain regex ) . # # # # # # Actual Result No APIs to specify a custom input filter , yet InputFilters are used internally to handle the min/max length .
Action button visibility is VISIBLE even when not showing __EoT__ Material Dialogs version : ` 0.9.4.5 ` The visibility of the action buttons is set [ here ] ( https : //github.com/afollestad/material-dialogs/blob/master/core/src/main/java/com/afollestad/materialdialogs/DialogInit.java # L164 ) based on the text being null or not ( although I think it should use ` TextUtils.isEmpty ( ) ` instead ) . Then later , the visibility of the action buttons is set to ` View.VISIBLE ` [ here ] ( https : //github.com/afollestad/material-dialogs/blob/master/core/src/main/java/com/afollestad/materialdialogs/DialogInit.java # L298 ) . The result of this is that if you try to check the visibility of an action button to determine if it is showing , you have to check both the visibility **and** whether it has text : `` ` java MDButton btn = dialog.getActionButton ( DialogAction.POSITIVE ) ; if ( btn.getVisibility ( ) == View.VISIBLE & & ! TextUtils.isEmpty ( btn.getText ( ) ) ) { // Do something } `` ` rather than simply : `` ` java if ( dialog.getActionButton ( DialogAction.POSITIVE ) .getVisibility ( ) == View.VISIBLE ) { // Do something } `` ` This is how AlertDialog works ( only need to check visibility ) . I also noticed that [
Spannable to content strings ( < i > and < b > in text ) __EoT__ # # # # # # Include the following : - Material Dialogs version : ` 0.9.0.2 ' ` - Device OS version : ` any ` - Device Manufacturer : ` any ` - Device Name : ` any ` It would be nice , when this could be possible . # # # # # # Reproduction Steps `` ` xml < string name= '' crazy_string '' > My % 1 $ s < b > bold < /b > text could be view as % 2 $ s < i > italic < /i > . < /string > `` ` `` ` java new MaterialDialog.Builder ( this ) .content ( R.string.crazy_string , `` happy '' , `` angry '' ) .show ( ) ; `` ` Want to create dialog with Text like : > My happy **bold** text could be view as angry _italic_ . # # # # # # Expected Result Dialog with formated text : My happy **bold** text could be view as angry _italic_ . # # # # # # Actual Result My happy
ColorChooserDialog Theme __EoT__ When creating a ColorChooserDialog , I get a dark background . The theme ( ) attribute is missing in this case . How does one change the theme ?
Recent changes to soft keyboard behavior broke keyboard hide/show behavior __EoT__ Hi , the commits added for 0.8.5.5 in attempts to fix soft keyboard show/hide behavior seem to have actually broken it . Whereas I had no issues with it before , now I see two issues : - Using a simple input dialog , the keyboard is shown when the dialog opens , but when the positive button is clicked and the dialog is dismissed , they keyboard stays open - Building off of the former issue , if the same dialog is opened again , **then** the keyboard is hidden , which is obviously the opposite of intended behavior ( interestingly , however , the action of tapping the dialog 's edittext in order to make the keyboard show seems to prevent the first issue from recurring ; that is , they keyboard will be correctly hidden upon the dialog being dismissed ) [ Here 's a Dropbox link to a recording I made which demonstrates both issues . ] ( https : //dl.dropboxusercontent.com/u/50734541/Recording.mp4 ) The recording was made on a physical device ( an LG G3 ) running Lollipop 5.1.1/API 22 , but I can also reproduce
Keyboard is n't always automatically dismissed in Input Dialogs __EoT__ When the dialog was closed , the keyboard does n't automatically dismissed . Tested on Android API 22 . I 've followed the sample code : `` ` java new MaterialDialog.Builder ( this ) .title ( R.string.input ) .inputRangeRes ( 2 , 20 , R.color.material_red_500 ) .input ( null , null , new MaterialDialog.InputCallback ( ) { @ Override public void onInput ( MaterialDialog dialog , CharSequence input ) { // Do something } } ) .show ( ) ; `` `
Calling setProgress before showing dialog cause NPE crash __EoT__ Hi , I found bug in 0.7.5.2 when call dialog.setProgress ( ... ) method before call dialog.show ( ) method . `` ` java.lang.NullPointerException : Attempt to invoke virtual method 'boolean android.os.Handler.post ( java.lang.Runnable ) ' on a null object reference at com.afollestad.materialdialogs.MaterialDialog.setProgress ( MaterialDialog.java:1337 ) `` ` Example code : `` ` java MaterialDialog dialog = new MaterialDialog.Builder ( getActivity ( ) ) .progress ( false , 1 ) .negativeText ( R.string.cancel_button ) .build ( ) ; ... dialog.setProgress ( -1 ) ; ... dialog.show ( ) ; `` `
Dialog to input password does not work as expected __EoT__ Hi , this line is not sufficient to make the dialog input be hidden `` ` .inputType ( InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_PASSWORD ) `` ` I have also needed to add this `` ` dialog.getInputEditText ( ) .setTransformationMethod ( PasswordTransformationMethod.getInstance ( ) ) ; `` ` Could you make that the dialog automatically does this if as an input type you specify password ?
Sample app crash with API 10 : Preference Fragment __EoT__ `` ` java.lang.NoSuchMethodError : com.afollestad.materialdialogssample.PreferenceActivity.getFragmentManager at com.afollestad.materialdialogssample.PreferenceActivity.onCreate ( PreferenceActivity.java:23 ) at android.app.Instrumentation.callActivityOnCreate ( Instrumentation.java:1047 ) at android.app.ActivityThread.performLaunchActivity ( ActivityThread.java:1660 ) at android.app.ActivityThread.handleLaunchActivity ( ActivityThread.java:1716 ) at android.app.ActivityThread.access $ 1500 ( ActivityThread.java:124 ) at android.app.ActivityThread $ H.handleMessage ( ActivityThread.java:968 ) at android.os.Handler.dispatchMessage ( Handler.java:99 ) at android.os.Looper.loop ( Looper.java:130 ) at android.app.ActivityThread.main ( ActivityThread.java:3806 ) at java.lang.reflect.Method.invokeNative ( Native Method ) at java.lang.reflect.Method.invoke ( Method.java:507 ) at com.android.internal.os.ZygoteInit $ MethodAndArgsCaller.run ( ZygoteInit.java:839 ) at com.android.internal.os.ZygoteInit.main ( ZygoteInit.java:597 ) at dalvik.system.NativeStart.main ( Native Method ) `` `
Sample app crash with API 10 : Folder Chooser __EoT__ `` ` java.lang.NoClassDefFoundError : com.afollestad.materialdialogssample.FolderSelectorDialog at com.afollestad.materialdialogssample.MainActivity $ 20.onClick ( MainActivity.java:194 ) at android.view.View.performClick ( View.java:2494 ) at android.view.View $ PerformClick.run ( View.java:9122 ) at android.os.Handler.handleCallback ( Handler.java:587 ) at android.os.Handler.dispatchMessage ( Handler.java:92 ) at android.os.Looper.loop ( Looper.java:130 ) at android.app.ActivityThread.main ( ActivityThread.java:3806 ) at java.lang.reflect.Method.invokeNative ( Native Method ) at java.lang.reflect.Method.invoke ( Method.java:507 ) at com.android.internal.os.ZygoteInit $ MethodAndArgsCaller.run ( ZygoteInit.java:839 ) at com.android.internal.os.ZygoteInit.main ( ZygoteInit.java:597 ) at dalvik.system.NativeStart.main ( Native Method ) `` `
Single Choice List Dialogs is displayed incorrectly __EoT__ On API 15 , Single Choice List Dialog is displayed incorrectly and item can not be selected : ! [ single ] ( https : //cloud.githubusercontent.com/assets/4901251/6676174/31d60600-cc26-11e4-9cb8-c5e314d781ac.png )
Signal the VertxMetrics when the Vertx instance is initialised __EoT__ Currently the ` VertxMetrics ` SPI does not leak the ` Vertx ` instance during metrics creation because the instance might be not be fully initialised yet . We should add a callback to the ` VertxMetrics ` to signal when the Vertx instance is initialised before it is returned to the application .
Callback improvements __EoT__ Improve how callbacks are delivered to the application . - some callbacks are invoked under synchronisation which are fine most of the time but can also sometimes lead to deadlock , we should avoid this when possible - some callbacks invocation are delayed with a ` runOnContext ` operation which is not suitable when the callback notifies of a state update , e.g a close operation . Often applications use this callback to update its own state . When the callback is delayed , it can lead to an unexpected state when another event happens before the callback , e.g a websocket is closed , making it impossible to write and the application is unaware of this , the websocket close handler should be not be delayed so the developer can rely on this when writing his application
Add Vert.x Logger isWarnEnabled ( ) method __EoT__ The ` io.vertx.core.logging.Logger ` interface currently does not have a ` isWarnEnabled ( ) ` method like the other levels have already . This adds this method as well as the corresponding method on ` LogDelegate ` and its implementations .
Fix FileResolver for OSGi bundle resources __EoT__ The use of ` FileResolver ` for a directory without a trailing ' ` / ` ' will fail since ` unpackFromBundleURL ( ) ` does not handle this case correctly . By trying ` ClassLoader.getResource ( ) ` on such a resource path with an appended ' ` / ` ' , it can be determined whether or not the resource is really a directory since a URL will only be returned if the resource exists and is a directory . Fixes # 2548 .
DNS requests are always sent with the flag 'RecursionDesired ' set to true __EoT__ We should probably add a property to the class DnsClientOptions to support sending non recursive DNS requests . something like DnsClientOptions.isRecursionDesired ( ) and DnsClientOptions.setRecursionDesired ( boolean newValue )
Use a stack-less TimeoutException when timing out an HttpClientRequest __EoT__
Can not specify logging file placement __EoT__ Hi , It would be nice if we could specify the placement of the logging.properties as a command line option . This is , if we specify in the command line : -Djava.ut.logging.config.file=/path/to/logging.properties the startup script should nop try to put it 's own ( fixed to < installdir > /conf/logging.properties , and allow that one to be used . This way deployment can be easier as each one can use its logging config . Kidn regards
HTTP/2 via HTTP/1.1 connection upgrade does not respect the protocol __EoT__ Currently , the upgrade implementation assumes that the HTTP/1.1 request should not be treated as an HTTP/2 stream and only send an HTTP/1.1 response .
The http server request exception handler should observe the response as closed on a close event __EoT__
Http1xOrH2CHandler should remove itself before firing the buffer __EoT__ Currently the ` Http1xOrH2CHandler ` removes itself after firing the buffer which leads the ` Http1xOrH2CHandler ` to process a decoded error ( that is fired in the pipeline to be treated like a network error ) . It should should remove itself before , since once the protocol has been identified , it should not interact anymore with the pipeline
Use plain asciidoc file instead of package-info file __EoT__
SLF4J location aware logger parameters are ignored __EoT__ I would like to refer to a possible issue concerning logging in vert.x . This has already been discussed in similar issue # 1243 and # 1280 . I 'm trying to use SLF4J logging with { } parameters , **but instead of parameters , logger logs parenthesis** . Example : ` logger.error ( `` Message : { } '' , `` foo '' ) ; // logs `` Message : { } '' instead of `` Message : foo '' ` I created vert.x Logger instance by passing an SLF4J delegate to the constructor . The flow is as follows : Logger.error ( using error call in this example , could be something else ) calls delegate.error , which in turn calls error method in ` SLF4JLogDelegate ` . This method calls ` log ( int level , Object message , Throwable t , Object ... params ) ` which check if ` logger instanceof LocationAwareLogger ` ( line 173 in ` io.vertx.core.logging.SLF4JLogDelegate ` ) . For this case , this is true and ` l.log ( null , FQCN , level , msg , parameters , t ) ` is
Fix HttpClient default redirection policy __EoT__ motivation : the current redirection policy does not follow strictly https : //www.w3.org/Protocols/rfc2616/rfc2616-sec10.html . It performs a redirection on any HTTP method for the 301 , 302 and 307 status instead of only GET and HEAD . In addition for 301 and 302 status it changes the method to GET change : perform redirection for 301 , 302 and 307 status code only when the method is GET or HEAD and do not change the method
Improve default dns client configuration __EoT__ Currently the default dns client host is ` localhost ` . It could be changed to ` null ` which means to use the value used by the address resolver which would be more consistent .
The WebSocket should check there is a handler for pong before delivering the pong event __EoT__ We recently upgraded to vertx 3.5 and are seeing this exception in our logs Stack Trace : `` ` java.lang.NullPointerException : null at io.vertx.core.http.impl.WebSocketImplBase.handleFrame ( WebSocketImplBase.java:266 ) at io.vertx.core.http.impl.ServerConnection.handleWsFrame ( ServerConnection.java:336 ) at io.vertx.core.http.impl.ServerConnection.processMessage ( ServerConnection.java:452 ) at io.vertx.core.http.impl.ServerConnection.handleMessage ( ServerConnection.java:156 ) at io.vertx.core.http.impl.HttpServerImpl $ ServerHandlerWithWebSockets.handleMessage ( HttpServerImpl.java:671 ) at io.vertx.core.http.impl.HttpServerImpl $ ServerHandlerWithWebSockets.handleMessage ( HttpServerImpl.java:614 ) at io.vertx.core.net.impl.VertxHandler.lambda $ channelRead $ 1 ( VertxHandler.java:150 ) at io.vertx.core.impl.ContextImpl.lambda $ wrapTask $ 2 ( ContextImpl.java:342 ) at io.vertx.core.impl.ContextImpl.executeFromIO ( ContextImpl.java:200 ) at io.vertx.core.net.impl.VertxHandler.channelRead ( VertxHandler.java:148 ) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead ( AbstractChannelHandlerContext.java:362 ) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead ( AbstractChannelHandlerContext.java:348 ) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead ( AbstractChannelHandlerContext.java:340 ) at io.netty.handler.timeout.IdleStateHandler.channelRead ( IdleStateHandler.java:286 ) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead ( AbstractChannelHandlerContext.java:362 ) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead ( AbstractChannelHandlerContext.java:348 ) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead ( AbstractChannelHandlerContext.java:340 ) at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead ( ByteToMessageDecoder.java:310 ) at io.netty.handler.codec.ByteToMessageDecoder.channelRead ( ByteToMessageDecoder.java:284 ) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead ( AbstractChannelHandlerContext.java:362 ) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead ( AbstractChannelHandlerContext.java:348 ) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead ( AbstractChannelHandlerContext.java:340 ) at io.netty.channel.DefaultChannelPipeline $ HeadContext.channelRead ( DefaultChannelPipeline.java:1359 ) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead ( AbstractChannelHandlerContext.java:362 ) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead ( AbstractChannelHandlerContext.java:348 ) at io.netty.channel.DefaultChannelPipeline.fireChannelRead ( DefaultChannelPipeline.java:935 ) at io.netty.channel.nio.AbstractNioByteChannel $ NioByteUnsafe.read ( AbstractNioByteChannel.java:134 ) at io.netty.channel.nio.NioEventLoop.processSelectedKey ( NioEventLoop.java:645 ) at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized ( NioEventLoop.java:580 ) at
HttpClient connection leaks when exceptions thrown when receiving inbound messages __EoT__ We are observing HttpClient connection leaks due to exceptions in receiving inbound messages in certain conditions . The leak we are seeing is caused by io.netty.handler.codec.compression.DecompressionException , but there could be other cases that trigger the similar leaking situation . Some details about the case we are seeing : when a client has ` tryUseCompression ` set to ` true ` , and a server returns ` Content-Encoding : gzip ` in a response header , BUT then returns an invalid gzip response ( could simply be some plain texts ) for some reasons , DecompressionException is thrown , but the connection is not properly cleaned up . So far we suspect the direct cause of the issue is that ` VertxHandler.channelInactive ` is not fired after a channel is closed by ` exceptionCaught ` . But we are not sure the problem is in netty or vertx . Here is a unit test to reproduce the issue : https : //github.com/brian65535/connection_leak
ProxyErrorTest.testProxyHostUnknown ( ) depends on normal dns , which may not work __EoT__ The test uses unknown.hostname to get a dns resolution error , this will not work when the providers dns returns an ad page for unknown hosts . We will set up a fakedns instead
JsonParser fails to handle floating point numbers in buffering mode __EoT__ To reproduce , create a ` JsonParser ` , switch to object value mode and push a buffer of JSON with at least one floating point value . Parsing fails with ` UnsupportedOperationException : Not implemented `
Expose the selected sub protocol negotiated by the websocket client and server __EoT__ motivation : currently the ` HttpClient ` allows to define the set of sub protocols supported by the client and server , that are then negotiated . However it is not possible for applications that uses it , the selected sub protocol . change : ` WebSocketBase ` provides a ` subProtocole ( ) ` method that returns the selected sub protocol . The ` ServerWebSocket ` also now allows to explicitly accept the socket and perform the handshake so the selected sub protocol can be determined during the server websocket handler invocation
Vertx deploys a Verticle class __EoT__ It would be nice to have a ` Vertx # deployVerticle ( C < ? extends Verticle , ... ) ` so one can deploy a class without using classloading
Allow AsyncFile 's to be opened in append mode __EoT__ Appending to a file requires three steps : 1 . Open the file with ` FileSystem.open ( ) ` with an ` OpenOptions ` object on which ` setTruncateExisting ( false ) ` and ` setWrite ( true ) ` have been called . 2 . Get the file properties with ` FileSystem.props ( ) ` 3 . Call ` setWritePos ( ) ` on the file with the length according to the properties . It seems like a simpler and less error-prone way would be to add ` setAppend ( ) ` and ` getAppend ( ) ` to ` OpenOptions ` and make ` AsyncFileImpl ` 's constructor translate it to ` StandardOpenOption.APPEND ` .
WorkerExecutor should use the right executor when the context queue is not empty __EoT__
DNSclient.lookup4 does not return the ip address when a CNAME is used __EoT__ When resolving for example www.yahoo.com or www.msn.de , the result of DNSClient is a CNAME and not the final ip address . This is either caused by the number of consecutive dns operations are used up or only the first address is resolved in general . `` `` java import org.junit.Test ; import org.junit.runner.RunWith ; import io.vertx.core.Vertx ; import io.vertx.core.dns.DnsClient ; import io.vertx.core.logging.Logger ; import io.vertx.core.logging.LoggerFactory ; import io.vertx.ext.unit.Async ; import io.vertx.ext.unit.TestContext ; import io.vertx.ext.unit.junit.VertxUnitRunner ; @ RunWith ( VertxUnitRunner.class ) public class DnsClientTest { private final static Logger log = LoggerFactory.getLogger ( DnsClientTest.class ) ; @ Test public void testDnsClient ( TestContext context ) { Async async=context.async ( ) ; Vertx vertx = Vertx.vertx ( ) ; DnsClient client = vertx.createDnsClient ( 53 , `` 192.168.178.1 '' ) ; client.lookup4 ( `` www.yahoo.com '' , res - > { if ( res.succeeded ( ) ) { log.info ( `` result `` +res.result ( ) ) ; async.complete ( ) ; } else { context.fail ( res.cause ( ) ) ; } } ) ; } } `` ``
Future fail/complete returns boolean instead of throwing an IllegalStateException __EoT__ # # Motivation Future completion methods throw an ` IllegalStateException ` when the future is already completed . Vert.x itself does not rely on this behavior . When a future might be completed several times ( for instance a close or a timeout ) , Vert.x takes the necessary steps with the idiom , in order to propagate the event correctly . `` ` if ( ! f.isComplete ( ) ) { f.complete ( ) ; } `` ` This change allows to simplify the existing code and use complete the future directly and keep the ability to remain aware of whether the Future was actually completed by the method call or not . # # Changes Future completion returns a boolean indicating whether the Future was completed or not by the method call instead of throwing an exception .
Remove deprecated AsyncResultHandler and VoidHandler __EoT__ These types are leftover of Vert.x 2 and was useful because of the lack of lambdas in Java 7 .
Update boring SSL dependency to 1.1.33.Fork24 __EoT__
Support local address for TCP clients __EoT__ HttpClient should allow an option to specify the local ip address . This is useful for a machine with multiple ip addresses / network interfaces . It might want to communication to happen on a specific network interface . Another use case is for a HttpClient with a really high outbound fanout and slow response ( i.e . web crawler ) . Without an ability to force the outgoing connection to share the same local ip address and port , it will be difficult to scale the number of requests on one machine .
Blocked thread warning when opening or closing an AsyncFile __EoT__ Users have reported blocked thread warning when opening or closing an AsyncFile . Here are example stack traces : `` ` io.vertx.core.VertxException : Thread blocked at java.io.UnixFileSystem.getBooleanAttributes0 ( Native Method ) at java.io.UnixFileSystem.getBooleanAttributes ( UnixFileSystem.java:242 ) at java.io.File.exists ( File.java:819 ) at io.vertx.core.impl.FileResolver.resolveFile ( FileResolver.java:103 ) at io.vertx.core.impl.VertxImpl.resolveFile ( VertxImpl.java:657 ) at io.vertx.core.file.impl.FileSystemImpl $ 14. < init > ( FileSystemImpl.java:736 ) at io.vertx.core.file.impl.FileSystemImpl.openInternal ( FileSystemImpl.java:735 ) at io.vertx.core.file.impl.FileSystemImpl.open ( FileSystemImpl.java:299 ) at io.vertx.core.http.impl.HttpServerFileUploadImpl.streamToFileSystem ( HttpServerFileUploadImpl.java:148 ) `` ` and `` ` io.vertx.core.VertxException : Thread blocked at sun.nio.ch.WindowsAsynchronousFileChannelImpl.close0 ( Native Method ) at sun.nio.ch.WindowsAsynchronousFileChannelImpl.close ( WindowsAsynchronousFileChannelImpl.java:142 ) at io.vertx.core.file.impl.AsyncFileImpl.doClose ( AsyncFileImpl.java:464 ) at io.vertx.core.file.impl.AsyncFileImpl.closeInternal ( AsyncFileImpl.java:480 ) at io.vertx.core.file.impl.AsyncFileImpl.close ( AsyncFileImpl.java:117 ) at io.vertx.rxjava.core.file.AsyncFile.close ( AsyncFile.java:143 ) `` ` One user provided more details and reported he was using a mapped Windows shared drive . I have been able to reproduce the opening issue by a slow network filesystem ( with twickle and nbd ) .
Multivalued server cookies should be seen as a single semi colon separated header __EoT__ # # # Cross posted issue https : //github.com/vert-x3/vertx-web/issues/412 I apologize , initially i posted this to vertx-web , as i suspected the issue was in ` CookieHandler ` code , but now I 'm sure the issue is in vertx core code , as http headers parsing is done by vertx-core # # # Version - vert.x core : 3.3.0 - vert.x web : 3.3.0 - SSL and ALPN with netty-tncnative : 1.1.3 - netty : 4.1.1 # # # Context If a client got multiple cookies to send in a request , and ALPN is on and the request is issued with HTTP/2 , the vert.x server can not read correctly the cookie header nor the ` CookieHandler ` works fine . It gets just one Cookie of many ( a random one as they 're sent in random order by browser as per specs ) This is due to the fact that Http/2 sends cookies in multiple COOKIE headers and not anymore in a single semicolon separated field . Please add conversion in a single ; separated header using Netty 's ` HttpConversionUtil
Fix Message Producer __EoT__ Motivation : We forget to add credit header in MessageProducer when we set it with ` deliveryOptions ` . As a result the drain handler will never be call . Modification : Add credit header when we set delivery options . Result : The drain handler will be call in every situation .
Improve documentation of getClusterWideMap __EoT__ There are many aspects when going distributed which are missing from the documentation '' Get the cluster wide map with the specified name . The map is accessible to all nodes in the cluster and data put into the map from any node is visible to any other node . '' More specific topics : - how much HA is in there ( is the data replicated ? ) - are there situations when data can be lost ? - how about performance ? - how about split brain ? How about concurrent updates in a split brain situation ? How about merging of the split brain ? -- - Incorrect documentation for put with a TTL . http : //vertx.io/docs/apidocs/io/vertx/core/shareddata/AsyncMap.html # put-K-V-long-io.vertx.core.Handler- It seems that the parameter is not a timeout but a TTL which does not match the comment below . `` Like put ( K , V , io.vertx.core.Handler < io.vertx.core.AsyncResult < java.lang.Void > > ) but specifying a timeout . If the value can not be put within the timeout a failure will be passed to the handler '' I assume the word timeout does not refer to the TTL in
Add trace logging code __EoT__ So it 's easier for users to diagnose issues when running .
redeploy= '' ant_pattern '' incorrectly checks path in Windows __EoT__ As it is right now , passing something like ` -- redeploy= '' src/**/*.java '' ` has no effect on Windows machines , i.e . no file is ever matched against this pattern since the pattern tokenizer fails to break the pattern into tokens due to the fact that ` / ` is not a file separator on Windows . Rather than modifying either the tokenizer or the matching algorithm , a possible solution would be to store the patterns ( called includes , see ` io/vertx/core/impl/launcher/commands/Watcher.java ` line ` 77 ` ) after converting between *nix and Windows file separator char , if needed . I believe a better solution would be to enforce a file separator char on the pattern , i.e . refuse to accept something like ` -- redeploy= '' src\**\*.java '' ` , only accept path patterns separated by ` / ` and then replace this with the correct OS file separator , if needed . Ant has ` / ` as its default file separator character but allows you to change it . I do n't think this is necessary . An `` enforce
on-redeploy= '' cmd args '' fails on windows __EoT__ The ` on-redeploy ` switch on Windows fails with ( for example ) : ` Error while executing the on-redeploy command : 'gradlew classes ' ` ` java.io.IOException : Can not run program `` '' gradlew classes '' '' : CreateProcess error=2 , The system can not find the file specified ` This happens with any command that has arguments ( e.g . 'classes ' or 'shadowJar ' for gradlew ) . I tried to pass only ` gradlew ` , without arguments , but this also fails unless I specify the extension as well ` gradlew.bat ` . Funny enough , executables can be passed with or without extension ( e.g . ` java ` OR ` java.exe ` ) but always without arguments ( ` java -version ` fails similarly to ` gradlew classes ` ) I believe the problem is in how the command string is built in ` io.vertx.core.impl.launcher.commands.Watcher.executeUserCommand ` line 268 Either the ` cmd ` string should be passed as is into the ProcessBuilder OR it should be added to the ` command ` list similarly to how it is done for non-Windows systems ,
Nested zip tests fails on Windows __EoT__ `` ` Failed tests : NestedZipFileResolverTest > AsyncTestBase.lambda $ onSuccess $ 1:622- > FileResolverTestBase.lambda $ testCacheDirDeletedOnVertxClose $ 3:197- > AsyncTestBase.assertFalse:208 null NestedZipFileResolverTest > AsyncTestBase.lambda $ onSuccess $ 1:620- > AsyncTestBase.fail:262 java.nio.file.FileSystemException : C : \Users\FTM\Documents\NetBeansProjects\vert.x\.vertx\file-cache-bd9e09f4-0e7a-4400-b8cf-a97a8735ea7c\lib\nested.zip : The process can not access the file because it is being used by another process . NestedZipFileResolverTest.after:60- > AsyncTestBase.after:81- > FileResolverTestBase.tearDown:52- > AsyncTestBase.awaitLatch:592- > AsyncTestBase.assertTrue:372 null NestedZipFileResolverTest.after:60- > AsyncTestBase.after:81- > FileResolverTestBase.tearDown:52- > AsyncTestBase.awaitLatch:592- > AsyncTestBase.assertTrue:372 null NestedZipFileResolverTest.after:60- > AsyncTestBase.after:81- > FileResolverTestBase.tearDown:52- > AsyncTestBase.awaitLatch:592- > AsyncTestBase.assertTrue:372 null NestedZipFileResolverTest.after:60- > AsyncTestBase.after:81- > FileResolverTestBase.tearDown:52- > AsyncTestBase.awaitLatch:592- > AsyncTestBase.assertTrue:372 null NestedZipFileResolverTest.after:60- > AsyncTestBase.after:81- > FileResolverTestBase.tearDown:52- > AsyncTestBase.awaitLatch:592- > AsyncTestBase.assertTrue:372 null NestedZipFileResolverTest.after:60- > AsyncTestBase.after:81- > FileResolverTestBase.tearDown:52- > AsyncTestBase.awaitLatch:592- > AsyncTestBase.assertTrue:372 null Tests run : 17 , Failures : 8 , Errors : 0 , Skipped : 0 `` ` reported by @ FainTMako on Window 7
Http server actual port __EoT__ NetServer has an ` actualPort ( ) ` that returns the current actual port , there could be the same for HttpServer
wrong link 404 __EoT__ The link under LocalDateTime _For details on the pattern syntax read here_ should be https : //docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html
Things that I would like to have for my development __EoT__ Hi chrisbanes , these are the changes that I would need for one of my projects . The first commit makes it easier to use a custom ListView ( in my case the SectionListView ) . The second one is maybe useful if someone extends one of the PullToRefresh-classes and wants to override these methods . This is currently only possible if the class is in your package . Greets , hahnjo
Add bounce-back effect __EoT__
POM Descriptor is out of sync with tagged semantic version . __EoT__ I 've updated the POM version attribute to the currently tagged 1.2.7 . This should help , minutely , in the resolution of issue # [ 61 ] ( https : //github.com/chrisbanes/Android-PullToRefresh/issues/61 )
Exception when setting medium scale __EoT__ `` ` photoAttacher.setMinimumScale ( dialogScale ) ; photoAttacher.setMediumScale ( 2F * dialogScale ) ; photoAttacher.setMaximumScale ( 3F * dialogScale ) ; `` ` gives a `` MidZoom has to be less than MaxZoom '' exception because of the call to checkZoomLevels ( ) . While the intention is clear , this is still a problem because setting the three zoom levels should be independent of their sequence . Maybe if you could add a SetAllScales ( min , med , max ) as well that only checks after all three are added ?
Add support for scale changed listener __EoT__ With this change , a scale change listener can be used to listen for scale changes when the user adjusts scale . I 've reviews almost all issues , and this does n't appear . I think the better workaround is using setOnMatrixChange and use getScale inside ... But it 's not immediate , so it would be very good feature
Make PhotoViewAttacher.onDoubleTap ( MotionEvent ev ) not final __EoT__ PhotoViewAttacher.onDoubleTap ( MotionEvent ev ) is final . It 's it possible to make it not final or give another way to override ? In our case , only need a double tap for zoom between the minimum and maximum zoom levels
Eclipse ADT support missing on dev branch , how to build PhotoView ? __EoT__ On current version 68464c72e6b6a58d90b9213206209367e6e0c05a of the dev branch support for using PhotoView as an android library in e.g . Eclipse ADT is gone . Support for this was deleted in commit 8f96de586cd8d99d3d004b61860bb1ca8b94d1da . I tried to include PhotoView as a simple Java dependency but had problems . So I reverted that commit to re-enable the library project support . What would be the proper way to build PhotoView in combination with our app ?
@ TargetApi ( 9 ) for PhotoView.java __EoT__ Why it is there ?
more sample __EoT__ You have written a couple of features but not give us how to use them . Sample app does nothing for example .
SerializerFeature.WriteBigDecimalAsPlain not working __EoT__ The problem dose exist or am I using the wrong way ? fastJson version : 1.2.29 java version : 1.8.0_172 `` ` /** * @ since 1.2.16 */ WriteBigDecimalAsPlain , `` ` `` ` java public class BigDecimalBean { private String type ; private BigDecimal value ; public String getType ( ) { return type ; } public void setType ( String type ) { this.type = type ; } public BigDecimal getValue ( ) { return value ; } public void setValue ( BigDecimal value ) { this.value = value ; } public static void main ( String [ ] args ) throws JsonProcessingException { BigDecimalBean bean = new BigDecimalBean ( ) ; bean.setType ( `` bigDecimal '' ) ; bean.setValue ( new BigDecimal ( `` 0.0000000001 '' ) ) ; ObjectMapper objectMapper = new ObjectMapper ( ) ; System.out.println ( objectMapper.writeValueAsString ( bean ) ) ; objectMapper.configure ( JsonGenerator.Feature.WRITE_BIGDECIMAL_AS_PLAIN , true ) ; System.out.println ( objectMapper.writeValueAsString ( bean ) ) ; System.out.println ( JSON.toJSONString ( bean ) ) ; System.out.println ( JSON.toJSONString ( bean , SerializerFeature.WriteBigDecimalAsPlain ) ) ; } } `` ` output： `` ` { `` type '' : '' bigDecimal ''
多级泛型的里层无法正常解析 __EoT__ class：BaseResult `` ` public class BaseResult < T > `` ` class：InteractiveOrderMaterielQueryResult `` ` java public class InteractiveOrderMaterielQueryResult < T extends InteractiveOrderMaterielModel > extends BasePageQueryResult < T > `` ` method： queryProcurementOrderList `` ` java BaseResult < InteractiveProcurementOrderList > queryProcurementOrderList ( InteractiveOrderBatchQueryCloudParam param ) ; `` ` 调用queryProcurementOrderList的返回结果调用JSON.parseObject ( ) ，里层的InteractiveOrderMaterielModel无法正常解析，测试代码如下： `` ` java String s = `` { \ '' result\ '' : { \ '' modelList\ '' : [ { \ '' sourceId\ '' : \ '' 81900002\ '' , \ '' categoryNames\ '' : [ \ '' 一级类目A\ '' , \ '' 二级类目A1\ '' , \ '' 三级类目a2\ '' ] , \ '' materielCode\ '' : \ '' wanhuacaigou095\ '' , \ '' categoryIds\ '' : [ 10001158,10001159,10001161 ] , \ '' systemName\ '' : \ '' framework\ '' , \ '' unitName\ '' : \ '' 个\ '' , \ '' materielName\ '' : \ '' wanhuacaigou095\ '' , \ '' class\ '' : \ '' com.alibaba.procurement.api.interactive.model.InteractiveOrderMaterielModel\ '' , \ '' materielItemId\ '' : \ '' 10172\ '' } , { \ '' sourceId\ '' : \ '' 81900002\ '' , \ '' categoryNames\ '' : [ \ '' 一级类目A\ '' , \ ''
jsonpath length ( ) 报错 __EoT__ $ 是一个json数组，使用 $ .length ( ) 报错， $ .size ( ) 不报错，但是文档 ( https : //github.com/alibaba/fastjson/wiki/JSONPath ) 中有length ( ) 的说明。 fastjson版本:1.2.42 com.alibaba.fastjson.JSONPathException : not support jsonpath : $ .length ( ) at com.alibaba.fastjson.JSONPath $ JSONPathParser.readSegement ( JSONPath.java:687 ) at com.alibaba.fastjson.JSONPath $ JSONPathParser.explain ( JSONPath.java:1290 ) at com.alibaba.fastjson.JSONPath.init ( JSONPath.java:60 ) at com.alibaba.fastjson.JSONPath.eval ( JSONPath.java:69 ) at com.alibaba.fastjson.JSONPath.eval ( JSONPath.java:355 ) at com.szr.fastjson.test.FastJsonJunitTest.testJsonpath ( FastJsonJunitTest.java:34 ) at sun.reflect.NativeMethodAccessorImpl.invoke0 ( Native Method ) at sun.reflect.NativeMethodAccessorImpl.invoke ( NativeMethodAccessorImpl.java:57 ) at sun.reflect.DelegatingMethodAccessorImpl.invoke ( DelegatingMethodAccessorImpl.java:43 ) at java.lang.reflect.Method.invoke ( Method.java:606 ) at org.junit.runners.model.FrameworkMethod $ 1.runReflectiveCall ( FrameworkMethod.java:50 ) at org.junit.internal.runners.model.ReflectiveCallable.run ( ReflectiveCallable.java:12 ) at org.junit.runners.model.FrameworkMethod.invokeExplosively ( FrameworkMethod.java:47 ) at org.junit.internal.runners.statements.InvokeMethod.evaluate ( InvokeMethod.java:17 ) at org.junit.internal.runners.statements.RunBefores.evaluate ( RunBefores.java:26 ) at org.junit.runners.ParentRunner.runLeaf ( ParentRunner.java:325 ) at org.junit.runners.BlockJUnit4ClassRunner.runChild ( BlockJUnit4ClassRunner.java:78 ) at org.junit.runners.BlockJUnit4ClassRunner.runChild ( BlockJUnit4ClassRunner.java:57 ) at org.junit.runners.ParentRunner $ 3.run ( ParentRunner.java:290 ) at org.junit.runners.ParentRunner $ 1.schedule ( ParentRunner.java:71 ) at org.junit.runners.ParentRunner.runChildren ( ParentRunner.java:288 ) at org.junit.runners.ParentRunner.access $ 000 ( ParentRunner.java:58 ) at org.junit.runners.ParentRunner $ 2.evaluate ( ParentRunner.java:268 ) at org.junit.runners.ParentRunner.run ( ParentRunner.java:363 ) at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run ( JUnit4TestReference.java:86 ) at org.eclipse.jdt.internal.junit.runner.TestExecution.run ( TestExecution.java:38 ) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests ( RemoteTestRunner.java:459 ) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests ( RemoteTestRunner.java:675 ) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run ( RemoteTestRunner.java:382 ) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main
jsonpath length ( ) 报错 __EoT__ $ 是一个json数组，使用 $ .length ( ) 报错， $ .size ( ) 不报错，但是文档 ( https : //github.com/alibaba/fastjson/wiki/JSONPath ) 中有length ( ) 的说明。 fastjson版本:1.2.42 com.alibaba.fastjson.JSONPathException : not support jsonpath : $ .length ( ) at com.alibaba.fastjson.JSONPath $ JSONPathParser.readSegement ( JSONPath.java:687 ) at com.alibaba.fastjson.JSONPath $ JSONPathParser.explain ( JSONPath.java:1290 ) at com.alibaba.fastjson.JSONPath.init ( JSONPath.java:60 ) at com.alibaba.fastjson.JSONPath.eval ( JSONPath.java:69 ) at com.alibaba.fastjson.JSONPath.eval ( JSONPath.java:355 ) at com.szr.fastjson.test.FastJsonJunitTest.testJsonpath ( FastJsonJunitTest.java:34 ) at sun.reflect.NativeMethodAccessorImpl.invoke0 ( Native Method ) at sun.reflect.NativeMethodAccessorImpl.invoke ( NativeMethodAccessorImpl.java:57 ) at sun.reflect.DelegatingMethodAccessorImpl.invoke ( DelegatingMethodAccessorImpl.java:43 ) at java.lang.reflect.Method.invoke ( Method.java:606 ) at org.junit.runners.model.FrameworkMethod $ 1.runReflectiveCall ( FrameworkMethod.java:50 ) at org.junit.internal.runners.model.ReflectiveCallable.run ( ReflectiveCallable.java:12 ) at org.junit.runners.model.FrameworkMethod.invokeExplosively ( FrameworkMethod.java:47 ) at org.junit.internal.runners.statements.InvokeMethod.evaluate ( InvokeMethod.java:17 ) at org.junit.internal.runners.statements.RunBefores.evaluate ( RunBefores.java:26 ) at org.junit.runners.ParentRunner.runLeaf ( ParentRunner.java:325 ) at org.junit.runners.BlockJUnit4ClassRunner.runChild ( BlockJUnit4ClassRunner.java:78 ) at org.junit.runners.BlockJUnit4ClassRunner.runChild ( BlockJUnit4ClassRunner.java:57 ) at org.junit.runners.ParentRunner $ 3.run ( ParentRunner.java:290 ) at org.junit.runners.ParentRunner $ 1.schedule ( ParentRunner.java:71 ) at org.junit.runners.ParentRunner.runChildren ( ParentRunner.java:288 ) at org.junit.runners.ParentRunner.access $ 000 ( ParentRunner.java:58 ) at org.junit.runners.ParentRunner $ 2.evaluate ( ParentRunner.java:268 ) at org.junit.runners.ParentRunner.run ( ParentRunner.java:363 ) at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run ( JUnit4TestReference.java:86 ) at org.eclipse.jdt.internal.junit.runner.TestExecution.run ( TestExecution.java:38 ) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests ( RemoteTestRunner.java:459 ) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests ( RemoteTestRunner.java:675 ) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run ( RemoteTestRunner.java:382 ) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main
parser/deserializer/ThrowableDeserializer.java 里 deserialze ( ) 可疑的空指针解引用 __EoT__ Hi , 我们的代码检查器 Pinpoint 报告了一处可疑的空指针解引用， https : //github.com/alibaba/fastjson/blob/fcd2ae7723ddc84191cc9b90b453d58b30c02e2c/src/main/java/com/alibaba/fastjson/parser/deserializer/ThrowableDeserializer.java # L131-L150 149 行的 ` exBeanDeser ` 变量是否有可能跳过全部初始化赋值（139 返回 false 的话） 导致维持 null 值，然后触发空指针解用？ 这处是真的有潜在问题 ? ，还是 139 行的检查是非必要？ 祝好， Sourcebrella Inc .
修复对象转json字符串时处理类的范型属性的bug，若第一次类的范型属性为数组类型，第二次空值期望null却返回第一次缓存的数组类型。 __EoT__ ! [ 31304910-0ce550b8-aaf3-11e7-9f67-0c36edcdd268 ] ( https : //user-images.githubusercontent.com/18508587/31318207-0907e6aa-ac14-11e7-93fc-1064884bc587.png )
jsonpath路径中含有纯数字节点的时候 , 不支持 __EoT__ JSONPath.read ( json , '' data.data.map.21160001 '' ) ; JSONPath.read ( json , '' data.data.map.B21160002 '' ) ; 当jsonpath中 , 节点开头为数字时 , 你们会判断成array类型 , 而我的map节点是map类型的 , 于是就抛出异常了 , 麻烦修正这个问题
kotlin该如何正确使用fastjson？ __EoT__ kotlin中的data class，fastjson无法解析
JsonObject转为java对象（包含Timestamp）报错com.alibaba.fastjson.JSONException : can not cast to Timestamp , value : 2017-08-04 15:16:41.0 __EoT__ 数据库 Timestamp类型 字段createtime：2017-08-04 15:16:41.000000000 Policy 包含 creatime 属性的实体对象。 `` ` java List < JSONObject > policys = ps.GetPolicys ( ) ; for ( JSONObject js : policys ) { System.out.println ( `` 查询策略列表 ... ... ... ... .. '' ) ; Policy p = JSON.toJavaObject ( js , Policy.class ) ; `` ` `` ` java com.alibaba.fastjson.JSONException : can not cast to Timestamp , value : 2017-08-04 15:16:41.0 at com.alibaba.fastjson.util.TypeUtils.castToJavaBean ( TypeUtils.java:1077 ) at com.alibaba.fastjson.util.TypeUtils.cast ( TypeUtils.java:714 ) at com.alibaba.fastjson.JSON.toJavaObject ( JSON.java:945 ) at cn.com.nei.drmp.feign.controller.MainController.setTask ( MainController.java:126 ) at sun.reflect.NativeMethodAccessorImpl.invoke0 ( Native Method ) at sun.reflect.NativeMethodAccessorImpl.invoke ( NativeMethodAccessorImpl.java:62 ) at sun.reflect.DelegatingMethodAccessorImpl.invoke ( DelegatingMethodAccessorImpl.java:43 ) at java.lang.reflect.Method.invoke ( Method.java:498 ) at org.springframework.scheduling.support.ScheduledMethodRunnable.run ( ScheduledMethodRunnable.java:65 ) at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run ( DelegatingErrorHandlingRunnable.java:54 ) at java.util.concurrent.Executors $ RunnableAdapter.call ( Executors.java:511 ) at java.util.concurrent.FutureTask.runAndReset ( FutureTask.java:308 ) at java.util.concurrent.ScheduledThreadPoolExecutor $ ScheduledFutureTask.access $ 301 ( ScheduledThreadPoolExecutor.java:180 ) at java.util.concurrent.ScheduledThreadPoolExecutor $ ScheduledFutureTask.run ( ScheduledThreadPoolExecutor.java:294 ) at java.util.concurrent.ThreadPoolExecutor.runWorker ( ThreadPoolExecutor.java:1142 ) at java.util.concurrent.ThreadPoolExecutor $ Worker.run ( ThreadPoolExecutor.java:617 ) at java.lang.Thread.run ( Thread.java:745 ) `` `
PropertyNamingStrategy可以通过XML配置实现吗 __EoT__ 在XML里的 FastJsonHttpMessageConverter 位置，能直接配置PropertyNamingStrategy的属性吗， 比如配置为 SnakeCase。 如果可以的话，要怎么配置
关于枚举反序列化失败的问题 __EoT__ 你好，我最近遇到一种情况是这样的，当类属性是枚举类型且是一个接口类型时，序列化后的字符串无法反序列化。我使用版本是1.2.34， 不知道是否有什么办法可以应对这种情况 我贴个例子 : `` ` java public class GSTest { @ JSONType ( seeAlso = { MyEnum.class } ) interface EnumInterface { } @ JSONType ( typeName = `` myEnum '' ) enum MyEnum implements EnumInterface { Test1 , Test2 } @ JSONType ( typeName = `` other '' ) enum OtherEnum implements EnumInterface { Other } static class MyTest { private int value ; private EnumInterface myEnum ; public MyTest ( ) { } public MyTest ( int property , MyEnum enumProperty ) { this.value = property ; this.myEnum = enumProperty ; } public int getValue ( ) { return value ; } public EnumInterface getMyEnum ( ) { return myEnum ; } public void setMyEnum ( EnumInterface myEnum ) { this.myEnum = myEnum ; } public void setValue ( int value ) { this.value = value ; } } public static void main ( String [ ] args ) { MyTest test = new MyTest ( 1 , MyEnum.Test1 ) ; String result = JSON.toJSONString ( test , SerializerFeature.WriteClassName ) ; System.out.println ( result ) ; test = JSON.parseObject ( result , MyTest.class ) ; System.out.println ( test ) ; } } `` `
NullPointerException版本1.2.33开始，之前版本不会 __EoT__ `` ` package com.yht.goods.model ; import com.alibaba.fastjson.JSON ; import org.junit.Test ; import java.io.Serializable ; import java.util.Arrays ; import java.util.List ; public class FastjsonTest { public static abstract class IdEntity < ID extends Serializable > implements Cloneable , Serializable { private static final long serialVersionUID = 4877536176216854937L ; public IdEntity ( ) { } public abstract ID getId ( ) ; public abstract void setId ( ID id ) ; } public static class LongEntity extends IdEntity < Long > { private static final long serialVersionUID = -2740365657805589848L ; private Long id ; @ Override public Long getId ( ) { return id ; } public void setId ( Long id ) { this.id = id ; } } public static class Goods extends LongEntity { private static final long serialVersionUID = -5751106975913625097L ; private List < Property > properties ; public List < Property > getProperties ( ) { return properties ; } public void setProperties ( List < Property > properties ) { this.properties = properties ; } public static class Property extends LongEntity { private static final long serialVersionUID = 7941148286688199390L ; } } public static class TT extends LongEntity { private static final long serialVersionUID
toJavaObject 增加泛型支持 __EoT__ 参考 # 969 需求，将一个json字符串中的某个key转换成JavaBean。 `` ` java jsonobj.getJSONObject ( `` key '' ) .toJavaObject ( new TypeReference < List < vo > > ( ) { } .getType ( ) ) ; `` ` 报错， ` The method getObject ( String , Class < T > ) in the type JSONObject is not applicable for the arguments ( String , Type ) `
toJSON和toJSONString的问题。 __EoT__ 三个属性 @ JSONField ( format= '' yyyy-MM-dd HH : mm : ss '' ) private Date createTime @ JSONField ( serialize = false ) ; private String password ; private String email ; 使用toJSON输出 { `` createTime '' :1483413683714 , '' email '' : '' eee '' } 使用toJSONString输出 { `` createTime '' : '' 2017-01-03 11:21:23 '' , '' email '' : '' eee '' } 为什么format对toJSON不起作用呢
JDK8的LocalDateTime字段序列化不支持UseISO8601DateFormat __EoT__ 使用版本：1.2.22 序列化VO对象中包含LocalDateTime，设置参数UseISO8601DateFormat 输出结果为：yyyy-MM-dd HH : mm : ss 期望结果为：yyyy-MM-dd'T'HH : mm : ss
对象列表的反序列化时最后一个对象的json如果没有逗号就会缺少属性 __EoT__ 用如下json反序列化这样一个属性private List < Symbol > symbols ; ，如果 { `` id '' :13 , '' type '' : '' BONUS '' } 这行最后不带逗号，序列化后再输出，则type属性就丢失了 ( 如果带逗号则好使 ) ，type是个枚举类型。 `` symbols '' : [ { `` id '' :1 , '' type '' : '' NORMAL '' } , { `` id '' :2 , '' type '' : '' NORMAL '' } , { `` id '' :3 , '' type '' : '' NORMAL '' } , { `` id '' :4 , '' type '' : '' NORMAL '' } , { `` id '' :5 , '' type '' : '' NORMAL '' } , { `` id '' :6 , '' type '' : '' NORMAL '' } , { `` id '' :7 , '' type '' : '' NORMAL '' } , { `` id '' :8 , '' type '' : '' NORMAL '' } , { `` id '' :9 , '' type '' : '' NORMAL '' } , { `` id '' :10 , '' type '' : '' NORMAL '' } , { `` id '' :11 , '' type '' : '' WILD '' } , {
fastjson序列化是没处理特殊字符，转义后为\u007F __EoT__ 该非法字符反序列化后为\�，导致json结构错误： 范例： String str = `` < p > 主要学校：密歇根大学 安娜堡分校、东密西根大学、 克莱利学院、康考迪亚学院 、瓦什特洛社区学院 < /p > '' ; System.out.println ( JSON.toJSONString ( str ) ) ;
SerializeWriter may write invalid JSON output when special character is detected in a string __EoT__ **While serializing a list to json , buffer expanding may commit some data to buffer while later the special character detection restarts the list serialization which results in invalid json output . ** Tested with fastjson:1.2.15 ( Create 2 SEPARATE files in order to reproduce the bug , ( not inner class ! ) ) //JSONSpecialCharTest.java : `` ` import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.serializer.SerializeWriter ; import com.alibaba.fastjson.serializer.SerializerFeature ; public class JSONSpecialCharTest { public static void main ( String [ ] args ) { SerializeWriter writer = new SerializeWriter ( null , JSON.DEFAULT_GENERATE_FEATURE , new SerializerFeature [ 0 ] ) ; int defaultBufferSize = writer.getBufferLength ( ) ; System.out.println ( `` default buffer size : '' + defaultBufferSize ) ; String encoded = JSON.toJSONString ( new FooBar ( defaultBufferSize ) ) ; try { Object decoded = JSON.parse ( encoded ) ; System.out.println ( `` Decoded : \n '' + decoded ) ; } catch ( Exception e ) { System.err.println ( `` Unable to decode encoded content _ ( o.O ) _ '' ) ; e.printStackTrace ( ) ; } } } `` ` //FooBar.java
1.2.10 , 调用FastJsonHttpMessageConverter中的addSerializeFilter方法一直报错 __EoT__ `` ` SerializeFilter filter = new ValueFilter ( ) { @ Override public Object process ( Object object , String name , Object value ) { if ( value == null ) { return `` '' ; } if ( value instanceof Number ) { return String.valueOf ( value ) ; } return value ; } } ; addSerializeFilter ( filter ) ; `` ` 执行addSerializeFilter方法后报错 : java.lang.ArrayStoreException at java.lang.System.arraycopy ( Native Method ) at com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter.addSerializeFilter ( FastJsonHttpMessageConverter.java:134 ) 是我使用的方法不对吗
有个错误 __EoT__ Pixel distance must be non-negative log： 03-05 12:30:12.266 32468-32468/com.littlesparkle.mall.client W/System.err : java.lang.NoSuchMethodException : findHiddenNonRemovedView [ int , int ] 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at java.lang.Class.getMethod ( Class.java:624 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at java.lang.Class.getDeclaredMethod ( Class.java:586 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.ExposeLinearLayoutManagerEx $ ChildHelperWrapper.ensureChildHelper ( ExposeLinearLayoutManagerEx.java:1850 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.ExposeLinearLayoutManagerEx $ ChildHelperWrapper.show ( ExposeLinearLayoutManagerEx.java:1895 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.ExposeLinearLayoutManagerEx.showView ( ExposeLinearLayoutManagerEx.java:1425 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.VirtualLayoutManager.showView ( VirtualLayoutManager.java:1102 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.VirtualLayoutManager.addChildView ( VirtualLayoutManager.java:1067 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.layout.GridLayoutHelper.layoutViews ( GridLayoutHelper.java:397 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.layout.BaseLayoutHelper.doLayout ( BaseLayoutHelper.java:260 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.VirtualLayoutManager.layoutChunk ( VirtualLayoutManager.java:574 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.ExposeLinearLayoutManagerEx.fill ( ExposeLinearLayoutManagerEx.java:1125 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.ExposeLinearLayoutManagerEx.onLayoutChildren ( ExposeLinearLayoutManagerEx.java:343 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at com.alibaba.android.vlayout.VirtualLayoutManager.onLayoutChildren ( VirtualLayoutManager.java:398 ) 03-05 12:30:12.267 32468-32468/com.littlesparkle.mall.client W/System.err : at android.support.v7.widget.RecyclerView.dispatchLayoutStep2 ( RecyclerView.java:3537 ) 03-05 12:30:12.268 32468-32468/com.littlesparkle.mall.client W/System.err : at android.support.v7.widget.RecyclerView.dispatchLayout ( RecyclerView.java:3266 ) 03-05 12:30:12.268 32468-32468/com.littlesparkle.mall.client W/System.err : at android.support.v7.widget.RecyclerView.onLayout ( RecyclerView.java:3798 ) 03-05 12:30:12.268 32468-32468/com.littlesparkle.mall.client W/System.err : at android.view.View.layout ( View.java:16694 ) 03-05 12:30:12.268 32468-32468/com.littlesparkle.mall.client W/System.err :
ExceptionHandler is n't propagated by Disruptor to existed WorkerPool after set __EoT__ ExceptionHandlers set to Disruptor after initializing WorkerPool will not be propagated to WorkerPool `` ` disruptor = new Disruptor < > ( Event : :new , RING_SIZE , executor , ProducerType.SINGLE , new BlockingWaitStrategy ( ) ) ; disruptor.handleExceptionsWith ( new FatalExceptionHandler ( ) ) ; disruptor.handleEventsWith ( new Handler < Event > ( ) ) .handleEventsWithWorkerPool ( new AnotherHandler < Event > ( ) , new AnotherHandler < Event > ( ) ) ; `` ` Will fail with NullPointer exception in case of exception in AnotherHandler ( exception handler in WorkerPool is null ) , while on this code `` ` disruptor = new Disruptor < > ( Event : :new , RING_SIZE , executor , ProducerType.SINGLE , new BlockingWaitStrategy ( ) ) ; disruptor.handleEventsWith ( new Handler < Event > ( ) ) .handleEventsWithWorkerPool ( new AnotherHandler < Event > ( ) , new AnotherHandler < Event > ( ) ) ; disruptor.handleExceptionsWith ( new FatalExceptionHandler ( ) ) ; `` ` will handle exception correctly . I think this code samples should lead to the same result and state .
Bug with EventPoller ? __EoT__ Hello , I want to have my own thread to check things and from time to time to poll the events from RingBuffer so events from RingBuffer are processed on my active thread . I see the EventPoller in trunk but it seems to be buggy . With test from below if I post only 1 event , it works OK , 2 - OK , 3 - OK , 4 - problem . RingBuffer size is 4 , so when buffer gets full , the poller can not not pop the events . `` ` $ java -cp disruptor-3.2.1.jar : . TestDisruptorPoller 1 onEvent ( 1 ) $ java -cp disruptor-3.2.1.jar : . TestDisruptorPoller 2 onEvent ( 1 ) onEvent ( 2 ) $ java -cp disruptor-3.2.1.jar : . TestDisruptorPoller 3 onEvent ( 1 ) onEvent ( 2 ) onEvent ( 3 ) $ java -cp disruptor-3.2.1.jar : . TestDisruptorPoller 4 PROBLEM -nothing is here and exiting ok $ java -cp disruptor-3.2.1.jar : . TestDisruptorPoller 5 stuck because of buffer full - OK $ `` ` `` ` java import com.lmax.disruptor.EventFactory ; import com.lmax.disruptor.EventPoller ; import com.lmax.disruptor.RingBuffer ; import com.lmax.disruptor.YieldingWaitStrategy ; public class TestDisruptorPoller
Building disruptor using JDK 1.8.0-ea fails build - javadoc erros __EoT__ Attached log contains the log of the errors and build failure . https : //gist.github.com/neomatrix369/6004332 JDK 1.8.0-ea builds are available at : http : //www.oracle.com/technetwork/java/javase/downloads/ea-jsp-142245.html
Use Retrolambda __EoT__ As this project is using Rx , to reduce the verbosity of the code I propose to use Retrolambda to backport lambda expressions .
Crash on Android 4.4.4 Vector WelcomeActivity __EoT__ App crash right after started on android 4.4.4 Stack : `` ` Process : com.github.pockethub , PID : 14221 java.lang.RuntimeException : Unable to start activity ComponentInfo { com.github.pockethub/com.github.pockethub.ui.WelcomeActivity } : android.view.InflateException : Binary XML file line # 92 : Error inflating class ImageButton at android.app.ActivityThread.performLaunchActivity ( ActivityThread.java:2198 ) at android.app.ActivityThread.handleLaunchActivity ( ActivityThread.java:2257 ) at android.app.ActivityThread.access $ 800 ( ActivityThread.java:139 ) at android.app.ActivityThread $ H.handleMessage ( ActivityThread.java:1210 ) at android.os.Handler.dispatchMessage ( Handler.java:102 ) at android.os.Looper.loop ( Looper.java:136 ) at android.app.ActivityThread.main ( ActivityThread.java:5086 ) at java.lang.reflect.Method.invokeNative ( Native Method ) at java.lang.reflect.Method.invoke ( Method.java:515 ) at com.android.internal.os.ZygoteInit $ MethodAndArgsCaller.run ( ZygoteInit.java:785 ) at com.android.internal.os.ZygoteInit.main ( ZygoteInit.java:601 ) at dalvik.system.NativeStart.main ( Native Method ) Caused by : android.view.InflateException : Binary XML file line # 92 : Error inflating class ImageButton at android.view.LayoutInflater.createViewFromTag ( LayoutInflater.java:713 ) at android.view.LayoutInflater.rInflate ( LayoutInflater.java:755 ) at android.view.LayoutInflater.rInflate ( LayoutInflater.java:758 ) at android.view.LayoutInflater.rInflate ( LayoutInflater.java:758 ) at android.view.LayoutInflater.inflate ( LayoutInflater.java:492 ) at android.view.LayoutInflater.inflate ( LayoutInflater.java:397 ) at android.view.LayoutInflater.inflate ( LayoutInflater.java:353 ) at android.support.v7.app.AppCompatDelegateImplV7.setContentView ( AppCompatDelegateImplV7.java:267 ) at android.support.v7.app.AppCompatActivity.setContentView ( AppCompatActivity.java:129 ) at com.github.pockethub.ui.DotPagerActivity.onCreate ( DotPagerActivity.java:73 ) at com.github.pockethub.ui.WelcomeActivity.onCreate ( WelcomeActivity.java:59 ) at android.app.Activity.performCreate ( Activity.java:5248 ) at android.app.Instrumentation.callActivityOnCreate ( Instrumentation.java:1110 ) at
App fails to start on API < 21 __EoT__ The App fails to start on API < 21 on inflating the linear layout in the header view of the NavigationDrawer because ` < dimen name= '' toolbar_top_padding '' > 24dp < /dimen > ` is only specified for API > = 21 : `` ` 10-12 20:42:51.289 6998-6998/com.github.pockethub W/ResourceType : Failure getting entry for 0x7f090019 ( t=8 e=25 ) in package 0 ( error -75 ) 10-12 20:42:51.299 6998-6998/com.github.pockethub W/ResourceType : Failure getting entry for 0x7f090019 ( t=8 e=25 ) in package 0 ( error -75 ) `` ` ... `` ` 10-12 20:42:51.389 6998-6998/com.github.pockethub E/AndroidRuntime : Caused by : java.lang.UnsupportedOperationException : Ca n't convert to dimension : type=0x1 10-12 20:42:51.389 6998-6998/com.github.pockethub E/AndroidRuntime : at android.content.res.TypedArray.getDimensionPixelSize ( TypedArray.java:463 ) 10-12 20:42:51.389 6998-6998/com.github.pockethub E/AndroidRuntime : at android.view.View. < init > ( View.java:2821 ) 10-12 20:42:51.389 6998-6998/com.github.pockethub E/AndroidRuntime : at android.view.ViewGroup. < init > ( ViewGroup.java:405 ) 10-12 20:42:51.389 6998-6998/com.github.pockethub E/AndroidRuntime : at android.widget.LinearLayout. < init > ( LinearLayout.java:174 ) 10-12 20:42:51.389 6998-6998/com.github.pockethub E/AndroidRuntime : at android.widget.LinearLayout. < init > ( LinearLayout.java:170 ) 10-12 20:42:51.389 6998-6998/com.github.pockethub E/AndroidRuntime : at java.lang.reflect.Constructor.constructNative ( Native Method ) 10-12 20:42:51.389 6998-6998/com.github.pockethub E/AndroidRuntime : at java.lang.reflect.Constructor.newInstance (
Fix vector drawables in xml __EoT__ Using android : src resulted in a crash on pre lollipop devices .
Disable Skip button __EoT__ Is there any way to hide Skip button ?
No touch feedback on interactive elements __EoT__ Hey , cool library you have here . I tried Hermes as a demo , and it seems like none of the interactive UI elements ( buttons , etc ) have touch feedback . It 'd be great to add that .
Ca n't define overload functions in hystrix-clj __EoT__ As below example : `` ` clj ( defcommand hello ( [ ] ( hello 1 ) ) ( [ n ] ( str `` hello , '' n ) ) ) ( hello ) CompilerException java.lang.ClassCastException : clojure.lang.PersistentList can not be cast to clojure.lang.IPersistentVector , compiling : ( /private/var/folders/90/xwqqy61d6lg6v8ztpbfhwb5c0000gp/T/form-init8537870057202438788.clj:1:9 ) ( hello `` dennis '' ) CompilerException java.lang.ClassCastException : clojure.lang.PersistentList can not be cast to clojure.lang.IPersistentVector , compiling : ( /private/var/folders/90/xwqqy61d6lg6v8ztpbfhwb5c0000gp/T/form-init8537870057202438788.clj:1:9 ) `` `
Request to HystrixMetricsStreamServlet restarts poller after servlet shutdown __EoT__ Any request after HystrixMetricsStreamServlet : :shutdown has been called leads to a new HystrixMetricsPoller being started . This again causes the container shutdown issues that had been addressed by adding the shutdown method as part of issue # 346 .
Hystrix Dashboard sorts NaN.0/s between error and high-volume when sorting on `` error then volume '' __EoT__ When sorting on `` error then volume '' and ratePerSecond is `` NaN '' , then `` errorThenVolume '' will become 0.NaN and be sorted right after the monitor-items with errors , but before monitor-items with volume . This can be fixed by checking if ratePerSecond is NaN , and then set errorThenVolume to a negative value , or write a custom sorting for tsort ( ) .
Splitter.onPattern drops last token when zero width matches are used __EoT__ _ [ Original issue ] ( https : //code.google.com/p/guava-libraries/issues/detail ? id=1190 ) created by **travis.downs** on 2012-11-04 at 10:17 AM_ -- - If you split on a zero-width regex , the last element may be dropped . String input = `` foo '' ; String regex = `` ( ? =o ) | ( ? < =o ) '' ; Splitter splitter = Splitter.onPattern ( regex ) ; System.out.println ( Arrays.asList ( input.split ( regex ) ) ) ; System.out.println ( Arrays.asList ( Iterables.toArray ( splitter.split ( input ) , String.class ) ) ) ; This does zero-width lookaround for 'o ' , so the string will be split before and after any o , but the o characters will also be returned as individual items . Note that String.split works correctly here , but Guava splitter drops the last o . Examining the code , this was probably introduced in this fix ( granted , it did n't work at all before that ) : https : //github.com/google/guava/issues/936 In particular , this bit of logic in Splitter.java : `` ` if ( offset == nextStart ) { /*
Fix ByteArrayDataInput Javadoc __EoT__ So Guava moved to Github ! This is my first ( and very small ) fix : I spotted improperly closed tag in [ ByteArrayDataInput 's Javadoc ] ( http : //docs.guava-libraries.googlecode.com/git-history/v18.0/javadoc/com/google/common/io/ByteArrayDataInput.html ) . Should be OK now .
Filler for Non-Existent Issue __EoT__ Filler for non-existent Google Code issue 66 . _This issue only exists to ensure that GitHub issues have the same IDs they had on Google Code . Please ignore it._
Add or remove playlist items ( MediaSources ) __EoT__ I use exoplayer dev-v2 , I need function to add or remove playlist items ( media sources ) without release player or initialize player . Can you make this function ? thanks !
[ HLS ] Closed caption display error on certain streams __EoT__ Tested on ExoPlayer dev-hls HEAD ( faf196a581520f1f3164388bb25a68c90446c897 ) . The two streams mentioned below have an issue where closed captions are unreadable . Only two or three characters are displayed at a time , instead of the expected sentences . http : //now.video.nfl.com/i/captiontest/closedcaptiontest_,350k,550k , .mp4.csmil/master.m3u8 ( plays OK in Quicktime ) http : //playertest.longtailvideo.com/adaptive/captions/playlist.m3u8 ( no captions displayed by Quicktime )
Implement Closed Captioning support for HLS __EoT__ Implement support for Closed Captioning via : EIA-608 ( CEA-608 ) CEA-708 WEBVTT
Unable to change BadgeStyle selected text color with selector __EoT__ # # About this issue I want to change the badge background and text colors when the item is selected , both 'colors ' use ` selector ` , the background works fine but the text color does n't . Looking at [ BadgeStyle source code ] ( https : //github.com/mikepenz/MaterialDrawer/blob/d67f935e55a55c97d747b498f0ea82d0fde17fff/library/src/main/java/com/mikepenz/materialdrawer/holder/BadgeStyle.java # L208 ) it seems like the ` ColorStateList ` is not used when passed using ` .withTextColorRes ( ) ` I create the badge style with the kotlin code shown below `` ` java BadgeStyle ( ) .withTextColorRes ( R.color.drawer_counter_text_selector ) .withBadgeBackground ( context.getDrawable ( R.drawable.drawer_counter_bg_selector ) ) `` ` The ` selector ` used for badge text `` ` xml < ! -- **** drawer_counter_text_selector *** -- > < selector xmlns : android= '' http : //schemas.android.com/apk/res/android '' > < item android : state_selected= '' true '' android : color= '' # ff0000 '' / > < item android : state_selected= '' false '' android : color= '' # 00ff00 '' / > < /selector > `` ` The ` selector ` used for badge background ( as noted above this works fine but I included here
[ Feature ] IDrawerImageLoader should contain name field __EoT__ Now the imageloader contains only the URI to be loaded : `` ` java public interface IDrawerImageLoader { void set ( ImageView imageView , Uri uri , Drawable placeholder ) ; void cancel ( ImageView imageView ) ; Drawable placeholder ( Context ctx ) ; /** * @ param ctx * @ param tag current possible tags : `` profile '' , `` profileDrawerItem '' , `` accountHeader '' * @ return */ Drawable placeholder ( Context ctx , String tag ) ; } `` ` But i would be great if we can get the name , or even better , the ` IDrawerItem ` that is going to be loaded , so we can generate a better placeholders : `` ` java public interface IDrawerImageLoader { void set ( ImageView imageView , IDrawerItem drawerItem , Drawable placeholder ) ; void cancel ( ImageView imageView ) ; Drawable placeholder ( Context ctx ) ; /** * @ param ctx * @ param tag current possible tags : `` profile '' , `` profileDrawerItem '' , `` accountHeader '' * @ return */ Drawable placeholder ( Context ctx , String tag
Material Drawer email and material_drawer_account_header_text_switcher overlap each other __EoT__ This is related to RTL material drawer with some arabic text . It 's seems like they overlap each other . ! [ problem ] ( https : //cloud.githubusercontent.com/assets/8881480/15500658/55b05330-21c7-11e6-9c92-8775be60db30.png )
Bug when setting .withProfileImagesVisible ( false ) in MiniDrawer __EoT__ Hi , first I want to say thank you for this great library ! I have created an activity that uses the MiniDrawer just like in the example application . Because of the fact that I do n't have profile images associated with the accounts , I hide them using .withProfileImagesVisible ( false ) when initializing the AccountHeader . The drawer itself contains just some PrimaryDrawerItems . This is working perfectly fine up until the point where the user uses the account selection to select another account . The MiniDrawer then hides the first PrimaryDrawerItem while in the expanded NavigationDrawer , it 's still shown . In the MiniDrawer , where the first PrimaryDrawerIcon that is now missing used to be , there is just empty space ( like View.INVISIBLE , not like View.GONE ) For testing purposes , I added an icon to the accounts despite the fact that I do n't normally do it . By doing this , I found out that the MiniDrawer draws the Icon associated with the chosen account over the first PrimaryDrawerItem despite withProfileImagesVisible being set to false . This does only happen
Pre - lollipop tint problem __EoT__ On A PrimaryDrawerItem if i set a different icon for selected state like this : `` ` java .withName ( R.string.drawer_list_offline_string ) .withIcon ( ContextCompat.getDrawable ( context , R.drawable.drawableRes ) ) .withSelectedIcon ( ContextCompat.getDrawable ( context , R.drawable.drawableRes2 ) ) .withIconTintingEnabled ( true ) .withIconColor ( ContextCompat.getColor ( context , R.color.color1 ) .withSelectedIconColor ( ContextCompat.getColor ( context , R.color.color2 ) ) ; `` ` The tint works only for lollipop devices and above , it does n't work for pre lollipop devices , although i can see whenever i 'm switching from items in the drawer that the tint is visible on the selected drawable just for the very second i 'm switching to another item . Not on the touch down event but on the touch UP event . Curious thing i tried to tint the drawable directly without using tint mode from the drawer and it still does n't work for pre lollipop device in the drawer while this method perfectly works on other views . Ty
ProfileSettingDrawerItem - withOnDrawerItemClickListener not fired on v5.0.0 __EoT__ Hi Mike , after upgrading to v5.0.0 listener setted withOnDrawerItemClickListener for ProfileSettingDrawerItem seems not fuctions anymore.. with v4.6.4 all ok. What am I doing wrong ? Thanks . AccountHeader is setted as : `` ` java accountHeader = new AccountHeaderBuilder ( ) .withActivity ( this ) .withHeaderBackground ( R.drawable.header ) .build ( ) ; `` ` And later : `` ` java accountHeader.addProfiles ( new ProfileDrawerItem ( ) .withName ( loggedUser.getFullName ( ) ) .withEmail ( loggedUser.getEmail ( ) ) .withIcon ( new IconicsDrawable ( this , GoogleMaterial.Icon.gmd_face ) .color ( Color.BLACK ) .sizeDp ( 20 ) ) , new ProfileSettingDrawerItem ( ) .withName ( this.getResources ( ) .getString ( R.string.menu_user_logout ) ) .withIcon ( FontAwesome.Icon.faw_sign_out ) .withIdentifier ( 20 ) .withOnDrawerItemClickListener ( new Drawer.OnDrawerItemClickListener ( ) { @ Override public boolean onItemClick ( View view , int position , IDrawerItem drawerItem ) { openDialogLogout ( ) ; return false ; } } ) ) ; `` `
Request - Typeface __EoT__ can u add setTypeface method for sections ?
Profile image will not use Picasso with local file path __EoT__ Picasso allows a file path per their docs with a prefix of `` file : '' . The problem is the ImageHolder applyTo ( ) checks scheme for http or https and only uses the DrawerImageLoader if it is true . Is there a reason only http schemes are allowed ? The problem when the image gets loaded without using the Picasso transormer I have set , the top and bottom of the circle are cut off in the drawer header .
Mini drawer - > Persistent Drawer __EoT__ It could be really cool if we could do the persistent drawer in the material design spec . I tried using ` .withDrawerLayout ( ) ` with a permanent DrawerLayout inside a LinearLayout in my XML , but that did n't work . It would be even cooler if the mini drawer could automatically expand into a persistent drawer and vice-versa . Currently expanding the mini-drawer obscures some of the content . ! [ Like this ] ( https : //material-design.storage.googleapis.com/publish/material_v_4/material_ext_publish/0Bx4BSt6jniD7TEVnWVlVS3RXMzQ/patterns_navdrawer_behavior_persistent5.png )
SwitchDrawerItem recyclerview problem if many items in list __EoT__ About the problem and solution you can read here http : //stackoverflow.com/questions/27641705/oncheckedchanged-called-automatically . For example in my app I use drawer for display a list of filters ( more than 50+ ) . I dont why but recyclerview after scrolling calls OnCheckedChangeListener automatocally where isChecked always false . compile 'com.android.support : appcompat-v7:23.0.1 ' P.S : Thanks for the MaterialDrawer
Badge TextColor wrong __EoT__ With the new base classes it seems i mixed up the text colors of the badges somewhere
SectionDrawerItem margin/padding in StickyDrawer is wrong __EoT__ When adding a SectionDrawerItem to the StickyDrawer there is too much margin/padding to the left ! [ menu ] ( https : //cloud.githubusercontent.com/assets/6043231/8571323/4f802ed8-2586-11e5-9c9b-a06fc97798ca.png ) PrimaryDrawerItem works good . Am i doing anything wrong ? cheers and thx for your good work , lukas
UpdateDrawer __EoT__ I think i found a bug , if i Build a DrawerBuilder ( adding it N IDrawerItems ) , if i try to update it later adding to the Drawer K elements and ( K > N ) , it throws an exception , if K < =N everything goes ok I try to add Items from cache , if there is no information ( first time app is launched or cache is deleted ) only add the Options item , then , The app trys to update the cache with a IntentService from internet , if I recover the information Succesfuly , I try to update the Items calling - > drawer.removeAllItems and drawer.addItems ( [ the array of items updated from cache ] ) `` ` 06-30 18:59:01.895 324-324/com.acansystems.udlsakai E/AndroidRuntime﹕ FATAL EXCEPTION : main Process : com.acansystems.udlsakai , PID : 324 java.lang.IndexOutOfBoundsException : Invalid index 1 , size is 1 at java.util.ArrayList.throwIndexOutOfBoundsException ( ArrayList.java:255 ) at java.util.ArrayList.get ( ArrayList.java:308 ) at com.mikepenz.materialdrawer.adapter.DrawerAdapter.getAnimatedItem ( DrawerAdapter.java:87 ) at com.mikepenz.materialdrawer.adapter.DrawerAdapter.getView ( DrawerAdapter.java:144 ) at android.widget.HeaderViewListAdapter.getView ( HeaderViewListAdapter.java:220 ) at android.widget.AbsListView.obtainView ( AbsListView.java:2347 ) at android.widget.ListView.makeAndAddView ( ListView.java:1864 ) at android.widget.ListView.fillDown ( ListView.java:698 ) at android.widget.ListView.fillSpecific ( ListView.java:1356 ) at
UpdateDrawer __EoT__ I think i found a bug , if i Build a DrawerBuilder ( adding it N IDrawerItems ) , if i try to update it later adding to the Drawer K elements and ( K > N ) , it throws an exception , if K < =N everything goes ok I try to add Items from cache , if there is no information ( first time app is launched or cache is deleted ) only add the Options item , then , The app trys to update the cache with a IntentService from internet , if I recover the information Succesfuly , I try to update the Items calling - > drawer.removeAllItems and drawer.addItems ( [ the array of items updated from cache ] ) `` ` 06-30 18:59:01.895 324-324/com.acansystems.udlsakai E/AndroidRuntime﹕ FATAL EXCEPTION : main Process : com.acansystems.udlsakai , PID : 324 java.lang.IndexOutOfBoundsException : Invalid index 1 , size is 1 at java.util.ArrayList.throwIndexOutOfBoundsException ( ArrayList.java:255 ) at java.util.ArrayList.get ( ArrayList.java:308 ) at com.mikepenz.materialdrawer.adapter.DrawerAdapter.getAnimatedItem ( DrawerAdapter.java:87 ) at com.mikepenz.materialdrawer.adapter.DrawerAdapter.getView ( DrawerAdapter.java:144 ) at android.widget.HeaderViewListAdapter.getView ( HeaderViewListAdapter.java:220 ) at android.widget.AbsListView.obtainView ( AbsListView.java:2347 ) at android.widget.ListView.makeAndAddView ( ListView.java:1864 ) at android.widget.ListView.fillDown ( ListView.java:698 ) at android.widget.ListView.fillSpecific ( ListView.java:1356 ) at
Request - BottomDrawerItem __EoT__ I want to have a bottom section for settings . is there a way to add this ? the position of this item must be the bottom of the screen
Request - Typeface __EoT__ can u add setTypeface method for sections ?
Secondary Text as detailed info __EoT__ Hi , first of all thanks for the great work . It would be nice to have the chance to enable a secondary text in the DrawerItem . I 'm currently using another library and it allows this , even though i 'm trying your library which i prefer.. Here an example : ! [ drawerwithsecondarytext ] ( https : //cloud.githubusercontent.com/assets/4865385/6712012/b4b06c0e-cd8a-11e4-89e5-2ff3ba4c8621.png ) Is there some chance to have that in the future ? Thanks .
Drawer Background pattern or image issue __EoT__ Hello I tried many times for `` material_drawer_background '' assign drawable but i failed . How can i assign it ? or only color ?
Divider not Google Design Guideline conform __EoT__ The Divider should have a margin beyond too : ! [ patterns_navdrawer_dividers2 ] ( https : //cloud.githubusercontent.com/assets/1476232/6306145/2fa1e91a-b931-11e4-8734-f379852fb0ac.png )
Cancel Animations __EoT__ I need cancel animations , but I ca n't find any way .
core : update dx to version 16 __EoT__
Activity.findViewById ( ... ) reffers to a missing R class __EoT__ Hi , in smali code in `` ` com.ripio.android.activities.RipioWeb `` ` I see the following instructions : `` ` smali .line 44 const v0 , 0x7f0b0034 invoke-virtual { p0 , v0 } , Lcom/ripio/android/activities/RipioWeb ; - > setContentView ( I ) V `` ` It means that the constant is hardcoded , but it 's decompiled to `` ` java setContentView ( ( int ) com.ripio.android.R.layout.activity_webview ) ; `` ` nevertheless class `` ` com.ripio.android.R `` ` is missing ( in smali and java code ) . APK [ com.ripio.android-1.apk.zip ] ( https : //github.com/skylot/jadx/files/2170991/com.ripio.android-1.apk.zip )
Deobfuscator : full package name collides with class name __EoT__ Hi , looks like option `` ` -- no-imports `` ` does n't resolve all possible problems . Download https : //www.apkmirror.com/apk/tumblr-inc/tumblr/tumblr-11-4-0-02-release/ , enable deobfuscation and open `` ` com.tumblr.creation.receiver.ShareActivity `` ` : `` ` java public class ShareActivity extends com.oath.o2.android.vrmsdk.kqe { `` ` Now open `` ` com.oath.o2.android.vrmsdk.kqe `` ` : `` ` java public abstract class kqe extends com.oath.o2.android.vrmsdk.krt { `` ` if you try to compile it , `` ` com.oath can not be resolved to a type `` ` error will be given to you in `` ` kqe `` ` class . It took a several minutes to realize why it happens . The problem is in class `` ` com.oath.o2.android.vrmsdk.com `` ` which collides with package name . Is that possible to do n't generate deobfuscated names which match with any package names at all to prevent such issues in the future ? Thanks !
Correct processing of anonymous classes : OuterClass.this is outputed by wrong way __EoT__ Hi . I often see these constructions : `` ` java private AudioFileReadyListener k = new AudioFileReadyListener ( this ) { final /* synthetic */ AudioService a ; { this.a = r1 ; } public final void OnAudioFileReady ( final String str ) { this.a.e.post ( new Runnable ( this ) { final /* synthetic */ AnonymousClass4 b ; public final void run ( ) { Intent intent = new Intent ( `` audioserviceexample.FILE_READY '' ) ; this.b.a.sendBroadcast ( intent ) ; } } ) ; } } ; `` ` But in real compiled code there is no ` final /* synthetic */ AudioService a ; ` this statement . ` this.b.a.sendBroadcast ( intent ) ; ` is actually ` OuterClass.this.sendBroadcast ( intent ) ; ` Is there a chance that it is fixed ? Thanks
Deobfuscator renames com . * packages to p027com . * , but not all __EoT__ Hi , I 've noticed in Bankin app ( https : //drive.google.com/open ? id=1RhnwzWEI2uaTFbfA5BMTUG5GlIQ969rc ) that when I supply option `` ` -- deobf `` ` and open `` ` sources `` ` - `` ` com `` ` , I see only `` ` google `` ` package , but all other packages starting with `` ` com `` ` were moved to `` ` p027com `` ` . It seems to be an error . Moreover , I will apply a patch which changes class names in `` ` AndroidManifest.xml `` ` to new ones from the deobfuscation map .
Jadx forgets to decompile some methods __EoT__ Hi , please use the following APK : https : //drive.google.com/open ? id=1dxd03Yh8jVlG1gMB0p-pKAPzbOlh79j2 Construtor in class `` ` jp.naver.line.android.util.bs `` ` with arguments `` ` Landroid/content/BroadcastReceiver ; Ljava/lang/String ; Z `` ` is not shown in sources , but in smali code ( decompiled with apktool ) it exists : `` ` smali .method public constructor < init > ( Landroid/content/BroadcastReceiver ; Ljava/lang/String ; Z ) V # direct methods .method public synthetic constructor < init > ( Landroid/content/BroadcastReceiver ; Ljava/lang/String ; ) V .locals 1 .prologue .line 84 const/4 v0 , 0x1 invoke-direct { p0 , p1 , p2 , v0 } , Ljp/naver/line/android/util/bs ; - > < init > ( Landroid/content/BroadcastReceiver ; Ljava/lang/String ; Z ) V return-void .end method `` ` In class `` ` jp.naver.line.android.util.br `` ` you can find its calls : `` ` java bsVarArr [ 3 ] = new jp.naver.line.android.util.bs ( ( android.content.BroadcastReceiver ) new com.ad.tracking.cpe.agent.MyNetChange ( ) , `` android.net.conn.CONNECTIVITY_CHANGE '' ) ; `` ` Does n't jadx show it if it 's synthetic ?
The same variable is used for objects with uncastable types __EoT__ Code ( `` ` com.deliveroo.orderapp.ui.fragments.WebViewFragment `` ` ) : `` ` java public void onViewCreated ( android.view.View view , android.os.Bundle bundle ) { super.onViewCreated ( view , bundle ) ; view = android.webkit.CookieManager.getInstance ( ) ; // incompatible cast this.cookieManager = view ; // incompatible cast view = getArguments ( ) .getParcelable ( `` content '' ) ; // incompatible cast this.content = ( com.deliveroo.orderapp.model.WebViewContent ) view ; // incompatible cast view = this.content ; // incompatible cast view = android.net.Uri.parse ( view.getUrl ( ) ) ; // incompatible cast view = view.getHost ( ) ; // incompatible cast this.host = view ; // incompatible cast setupWebView ( ) ; loadPage ( ) ; } `` ` APK : [ Deliveroo Restaurant Delivery_v2.31.1_apkpure.com.apk.zip ] ( https : //github.com/skylot/jadx/files/1681953/Deliveroo.Restaurant.Delivery_v2.31.1_apkpure.com.apk.zip ) And wrong CFG in the same class : `` ` java private final boolean isDeliverooUrl ( ) { java.util.List listOf = kotlin.collections.CollectionsKt.listOf ( new java.lang.String [ ] { `` ae '' , `` be '' , `` co.uk '' , `` com.sg '' , `` com.au '' , `` es '' , `` fr '' , `` de '' ,
XML decode errors ( missing tags , attributes , etc ) __EoT__ This app https : //play.google.com/store/apps/details ? id=ru.abb.mobilebank Proceed to `` ` res/xml/config.xml `` ` A lot of wrong decodes can be found like `` ` xml < name АК БАРС Online/ > < description Etalon version of OpenWay Mobile Bank/ > < author email= '' aliventsev @ openwaygroup.com '' href= '' http : //openwaygroup.com '' OpenWay Group/ > `` ` or `` ` xml < feature name= '' CardIO '' > < param name= '' android-package '' value= '' io.card.cordova.sdk.CardIOCordovaPlugin '' / > < /http : //www.w3.org/ns/widgets : feature > < feature name= '' PickContact '' > < param name= '' android-package '' value= '' com.kolwit.cordova.PickContactPlugin '' / > < /http : //www.w3.org/ns/widgets : feature > < feature name= '' MMA '' > < param name= '' android-package '' value= '' com.openwaygroup.ic.otp.MMAPlugin '' / > < /http : //www.w3.org/ns/widgets : feature > < feature name= '' InAppBrowserXwalk '' > < param name= '' android-package '' value= '' com.example.plugin.InAppBrowserXwalk.InAppBrowserXwalk '' / > < /http : //www.w3.org/ns/widgets : feature > < feature name= '' Contacts '' > < param name= '' android-package '' value= '' org.apache.cordova.contacts.ContactManager '' / > <
break from a synchronized block inside a while loop pulls trailing code into the synchronized block __EoT__ The following code : `` ` java public static class TestCls { private int x = 0 ; public void f ( ) { } public void test ( ) { while ( true ) { synchronized ( this ) { if ( x == 0 ) { throw new IllegalStateException ( `` bad luck '' ) ; } x++ ; if ( x == 10 ) break ; } x++ ; f ( ) ; } } } `` ` decompiles as : `` ` java public class TestCls { private int x ; public TestCls ( ) { this.x = 0 ; } public void f ( ) { } public void test ( ) { while ( true ) { synchronized ( this ) { if ( this.x == 0 ) { throw new IllegalStateException ( `` bad luck '' ) ; } this.x++ ; if ( this.x == 10 ) { return ; } this.x++ ; f ( ) ; } } } } `` ` As you can see , the block after the ` synchronized ` block
Wrong with complex if/else condition and for loop ( while loop ) with break inside __EoT__ This code will fail to decompile , it produced wrong code . I have try with latest unstable build . The problem inside the function checkRight ( ) . `` ` public class Main { public static void main ( String [ ] args ) throws Exception { HashMap < String , Point > map = new HashMap ( ) ; for ( int i = 0 ; i < 100 ; i++ ) { Point point = new Point ( i , i + 50 ) ; map.put ( i + `` '' , point ) ; } int f = checkRight ( map , 4 ) ; System.out.print ( f ) ; } private static int checkRight ( HashMap < String , Point > map , int mapX ) { int length = 1 ; for ( int x = mapX + 1 ; x < 100 ; x++ ) { Point tile = map.get ( x + `` '' ) ; if ( tile == null || tile.y ! = 100 ) { break ; } length++ ; } return length
inconsistent code __EoT__ The following function funcA ( ) does not decompile . Thank you ! `` ` void funcA ( List < Integer > data ) throws InterruptedException { for ( ; ; ) { try { funcB ( data ) ; break ; } catch ( Exception ex ) { if ( funcC ( ) ) { throw ex ; } data.clear ( ) ; } Thread.sleep ( 100 ) ; } } private boolean funcB ( List < Integer > data ) { return false ; } private boolean funcC ( ) { return true ; } `` `
Class not found - classpath problem ? __EoT__ Hello , something like this usually pops out on me , running jadx/jadx-gui . `` ` WARN - Class not found : android.app.SharedElementCallback WARN - Class not found : android.transition.Transition $ EpicenterCallback WARN - Class not found : android.transition.Transition $ EpicenterCallback WARN - Class not found : android.media.VolumeProvider WARN - Class not found : android.media.session.MediaController $ Callback WARN - Class not found : android.media.session.MediaSession $ Callback WARN - Class not found : android.print.PrintDocumentAdapter WARN - Class not found : android.print.PrintDocumentAdapter WARN - Class not found : android.view.View $ OnApplyWindowInsetsListener WARN - Class not found : android.view.View $ OnApplyWindowInsetsListener `` ` Is this something we can fix with classpath or possibly upgrading dependency ` jadx-core/clsp-data/android-4.3.jar ` to newer version ? If so how do you generate/update ` core.jcst ` in said JAR to newer SDK version ( such as 21/22 ) ? Thank you
Missing variable __EoT__ This code will be wrong when decompile : `` ` public class Main2 { static Vector2 targetPos = new Vector2 ( ) ; static int tileX , tileY ; static Vector2 directVect = new Vector2 ( ) ; static Vector2 newPos = new Vector2 ( ) ; public static void main ( String [ ] args ) { while ( true ) { newTarget ( ) ; System.out.printf ( `` x : `` + newPos.x + `` y : `` + newPos.y ) ; } } private static void newTarget ( ) { Random rd = new Random ( ) ; int direction = rd.nextInt ( 7 ) ; switch ( direction ) { case 0 : targetPos.x = ( float ) ( ( ( tileX + 1 ) * 55 ) + 55 ) ; targetPos.y = ( float ) ( ( ( tileY + 1 ) * 35 ) + 35 ) ; break ; case 2 : targetPos.x = ( float ) ( ( ( tileX + 1 ) * 55 ) + 55 ) ; targetPos.y = ( float ) ( ( ( tileY - 1 ) * 35 ) + 35 )
No verification of the same object references in different registers __EoT__ The code below shows the meaning of the problem `` ` .method private calc ( DDLSomeObject ; ) LSomeObject ; .locals 22 .param p1 , `` arg1 '' # D .param p3 , `` arg2 '' # D .param p5 , `` arg3 '' # LSomeObject ; .prologue .line 54 new-instance v17 , LSomeObject ; move-object/from16 v0 , v17 move-object/from16 v1 , p5 invoke-direct { v0 , v1 } , LSomeObject ; - > < init > ( LSomeObject ; ) V .line 59 .local v17 , `` localSomeObject '' : LSomeObject ; `` ` The Jadx produces : `` ` private SomeObject calc ( double arg1 , double arg2 , SomeObject arg3 ) { SomeObject someObject = localSomeObject ; SomeObject someObject2 = arg3 ; `` ` I think there must be some mechanism to control where the reference to the object is located . ( or make wrap instruction ? )
Demo伸缩列表点击移除item报错，快速点击就会报错 __EoT__ 08-07 17:01:36.010 26482-26482/com.chad.baserecyclerviewadapterhelper E/AndroidRuntime : FATAL EXCEPTION : main Process : com.chad.baserecyclerviewadapterhelper , PID : 26482 java.lang.ArrayIndexOutOfBoundsException : length=213 ; index=-1 at java.util.ArrayList.get ( ArrayList.java:310 ) at com.chad.baserecyclerviewadapterhelper.adapter.ExpandableItemAdapter $ 3.onClick ( ExpandableItemAdapter.java:103 ) at android.view.View.performClick ( View.java:4792 ) at android.view.View $ PerformClick.run ( View.java:19938 ) at android.os.Handler.handleCallback ( Handler.java:739 ) at android.os.Handler.dispatchMessage ( Handler.java:95 ) at android.os.Looper.loop ( Looper.java:135 ) at android.app.ActivityThread.main ( ActivityThread.java:5601 ) at java.lang.reflect.Method.invoke ( Native Method ) at java.lang.reflect.Method.invoke ( Method.java:372 ) at com.android.internal.os.ZygoteInit $ MethodAndArgsCaller.run ( ZygoteInit.java:964 ) at com.android.internal.os.ZygoteInit.main ( ZygoteInit.java:759 )
请暴露空参的构造方法 __EoT__ 就是我不要自己传个list，直接用框架里面的list，现在是暴露的构造方法必须要传，希望保留不要传list的构造方法
disableLoadMoreIfNotFullPage 无效 __EoT__ disableLoadMoreIfNotFullPage 我的理解是 是不是 列表项还没有沾满显示区域 ( 可能数据很少的情况下 ) 是不会出发加载更多··· 但是感觉每次进来的时候 onLoadMoreRequested走了回调实际上数据只有1 2条如下图 ! [ image ] ( https : //cloud.githubusercontent.com/assets/3139596/24552768/55ddf7ee-165a-11e7-90a8-8e39e08ef809.png ) 主要代码如下 ! [ image ] ( https : //cloud.githubusercontent.com/assets/3139596/24552773/5c856d52-165a-11e7-9193-77634869dbcb.png )
remove方法不对 , 应该notifyItemRangeChanged ( ) 一次 , 要不会删除条目错乱 ; __EoT__ 现在的remove方法是 public void remove ( int position ) { mData.remove ( position ) ; notifyItemRemoved ( position + getHeaderLayoutCount ( ) ) ; compatibilityDataSizeChanged ( 0 ) ; } 应该再告诉adapter数据源更新 要不条目会错乱 notifyItemRangeChanged ( position , data.size ( ) - position ) ;
在OnResume中再次初始化头部的时候会出现下面错误？？？？？？版本：2.6.6 __EoT__ java.lang.IllegalArgumentException : Called attach on a child which is not detached : ViewHolder { 2fde25c7 position=0 id=-1 , oldPos=-1 , pLpos : -1 } at android.support.v7.widget.RecyclerView $ 4.attachViewToParent ( RecyclerView.java:581 ) at android.support.v7.widget.ChildHelper.attachViewToParent ( ChildHelper.java:212 ) at android.support.v7.widget.RecyclerView.addAnimatingView ( RecyclerView.java:1003 ) at android.support.v7.widget.RecyclerView.animateDisappearance ( RecyclerView.java:2911 ) at android.support.v7.widget.RecyclerView.dispatchLayout ( RecyclerView.java:2711 ) at android.support.v7.widget.RecyclerView.onLayout ( RecyclerView.java:2971 ) at android.view.View.layout ( View.java:16112 ) at android.view.ViewGroup.layout ( ViewGroup.java:5185 ) at android.support.v4.widget.SwipeRefreshLayout.onLayout ( SwipeRefreshLayout.java:562 ) at android.view.View.layout ( View.java:16112 ) at android.view.ViewGroup.layout ( ViewGroup.java:5185 ) at android.widget.FrameLayout.layoutChildren ( FrameLayout.java:639 ) at android.widget.FrameLayout.onLayout ( FrameLayout.java:574 ) at android.view.View.layout ( View.java:16112 ) at android.view.ViewGroup.layout ( ViewGroup.java:5185 ) at android.widget.LinearLayout.setChildFrame ( LinearLayout.java:1959 ) at android.widget.LinearLayout.layoutVertical ( LinearLayout.java:1813 ) at android.widget.LinearLayout.onLayout ( LinearLayout.java:1722 ) at android.view.View.layout ( View.java:16112 ) at android.view.ViewGroup.layout ( ViewGroup.java:5185 ) at android.widget.LinearLayout.setChildFrame ( LinearLayout.java:1959 ) at android.widget.LinearLayout.layoutVertical ( LinearLayout.java:1813 ) at android.widget.LinearLayout.onLayout ( LinearLayout.java:1722 ) at android.view.View.layout ( View.java:16112 ) at android.view.ViewGroup.layout ( ViewGroup.java:5185 ) at android.widget.RelativeLayout.onLayout ( RelativeLayout.java:1195 ) at android.view.View.layout ( View.java:16112 ) at android.view.ViewGroup.layout ( ViewGroup.java:5185 ) at android.widget.FrameLayout.layoutChildren ( FrameLayout.java:639 ) at android.widget.FrameLayout.onLayout ( FrameLayout.java:574 ) at android.view.View.layout ( View.java:16112 ) at android.view.ViewGroup.layout ( ViewGroup.java:5185 ) at android.widget.LinearLayout.setChildFrame ( LinearLayout.java:1959 ) at android.widget.LinearLayout.layoutVertical ( LinearLayout.java:1813 ) at android.widget.LinearLayout.onLayout
在Demo PullToRefreshUseActivity的页面中，item使用remove或notifyItemRemoved删除最后一个数据会报错 __EoT__ 你好，在Demo PullToRefreshUseActivity的页面中，item使用remove或notifyItemRemoved删除最后一个数据会报错，如果取消上拉加载功能则不会出现此问题，希望作者尽快修复~ 原代码： private void initAdapter ( ) { mQuickAdapter = new QuickAdapter ( R.layout.tweet , sampleData ) ; mQuickAdapter.setOnLoadMoreListener ( this ) ; mQuickAdapter.openLoadAnimation ( BaseQuickAdapter.SLIDEIN_LEFT ) ; mRecyclerView.setAdapter ( mQuickAdapter ) ; mCurrentCounter = mQuickAdapter.getData ( ) .size ( ) ; mRecyclerView.addOnItemTouchListener ( new OnItemClickListener ( ) { @ Override public void onSimpleItemClick ( final BaseQuickAdapter adapter , final View view , final int position ) { Toast.makeText ( PullToRefreshUseActivity.this , Integer.toString ( position ) , Toast.LENGTH_LONG ) .show ( ) ; mQuickAdapter.remove ( position ) ; } } ) ; } 报错原因：java.lang.IndexOutOfBoundsException : Inconsistency detected . Invalid view holder adapter positionViewHolder { 2bd3bdd position=0 id=-1 , oldPos=1 , pLpos:1 scrap [ attachedScrap ] tmpDetached no parent }
adapter里的按钮设置 vh.getView ( R.id.accept_btn ) .setEnabled ( false ) ; 不启作用 还能点击 __EoT__ @ AllenCoder @ CymChad 辛苦了。
在使用 “ 分组的伸缩栏 ” 功能时展开分组。分组条目闪现 __EoT__ 手机是小米4，MIUI8 ，下载的demo就没事。。。求解
图片加载可以优化，做成扩展 __EoT__ 如果项目已经集成了其他图片加载框架，但是你这个项目又集成了Glide图片加载库，这样项目就存在了两个图片加载框架，然而这不是我们想要达到的效果。期待作者可以优化这块~
Fix R scanner behavior for array values __EoT__ Fixes # 1247 - TreeScanner api visits all values at once when calling ` accept ( Tree ) ` so aggregate the symbols within the scanner itself - Added new unit tests
Update Gradle to 3.5 __EoT__ @ JakeWharton
Add Left/Right Circle Clicking __EoT__ Clicking to the left or the right of the circle indicators will move one page in the appropriate direction .
Support loading resources from dynamic modules __EoT__ # # # Background Dynamic modules use split APKs to distribute resources with the module instead of the base APK . This means that , for example , the runtime package may be ` com.supercilex.robotscouter ` while the resource is located in ` com.supercilex.robotscouter.teams ` . These differences cause problems when Glide tries to load the resource because Glide will try to create a context from the ` com.supercilex.robotscouter.teams ` package which does n't really exist . # # # Proposal If resources are a subset of the context 's package , use said context . Otherwise , try to create a new context . @ sjudd Can you think of a better solution ? This is the best one I 've come up with so far , but it seems hacky .
Add Android X support to the annotation processor . __EoT__ # # Description Add support for generating code with the Android X annotations , if they are present in the classpath . If they are n't available , use the default Support library annotations . # # Motivation and Context Currently , Glide can not be used with Android X enabled . This fixes # 3126 .
Updated documentation __EoT__ As into ( int , int ) is depreacted too , suggest to use submit ( which the method itself does too )
Update Gradle wrapper to 4.6 __EoT__ < ! -- Make sure you 've run ` gradlew clean check jar assemble ` before commit . -- > < ! -- Do n't forget that you can always force push to your private branches to make changes . -- > < ! -- Please make sure there are no weird commits in the change set by rebasing to latest upstream . -- > < ! -- Please squash typo/checkstyle/review fix commits into the base commit . -- > < ! -- Please describe the changes you made on a high level . -- > < ! -- Make sure you reference the GitHub issue here if this change is related to one . -- > < ! -- Why is this change required ? What problem does it solve ? -- > < ! -- If it 's fixing a bug reference it or provide repro steps . -- > < ! -- If you have any issues feel free to create the PR anyway , we 'll help to resolve them . -- >
Add nullability annotations to signature package and its dependencies __EoT__
ImageView does not load new resoure if I use byte array __EoT__ < ! -- Please fill in the below fields with some data to help us best diagnose the issue . The more specific you are , the better ! You can help a lot by not making us ask these questions . Feel free to remove any irrelevant parts that you know are not related to the issue . Any HTML comment like this will be stripped when rendering markdown , no need to delete them . -- > < ! -- What version of Glide you 're running , for example : 3.7.1 | 3.8.0-SNAPSHOT | 4.0.0-SNAPSHOT It 's essentially the version number from your build.gradle : ` dependencies { compile ' ... : x.y.z ' } ` -- > **Glide Version** : compile 'com.github.bumptech.glide : glide:4.3.1' annotationProcessor 'com.github.bumptech.glide : compiler:4.3.1' < ! -- Share the details of your issue in prose , detailing actual and expected behavior . It also helps if you give some info **why** you are trying to do something as opposed to **what** is not working . -- > **Issue details / Repro steps / Use case background** : I use byte
Fix typos in README.md __EoT__ # # Description This revision fixes two typos in the project readme .
Fix thread-unsafe behaviours in GifDecoder __EoT__ - use a local copy of ` act ` : fixes # 1068 See investigation below https : //github.com/bumptech/glide/issues/1068 # issuecomment-199776115 - do n't modify ` bgColor ` unnecessarily There was a TODO in ` GifHeader ` and it coincided with the code I 'm modifying . I also checked all other ` GifHeader ` and ` GifFrame ` fields , after this change all of them are used read-only . Please double-check that this move does n't modify the behavior ( note : ` bgColor ` is only used in this single place ) Tested in Glide Support with # 1062 's example : https : //github.com/TWiStErRob/glide-support/tree/c3de297d0daec8d2650a3a640c0404c35b937a30/src/glide3/java/com/bumptech/glide/supportapp/github/_1062_html_gif_spans
Integration lib version discrepancies __EoT__ At this time : - on 3.0 branch the okhttp lib has 1.4.0 code 10 . - on master branch the okhttp lib has 2.0.0 code 8 . As far as I know version codes in Android must be incremental , however we can probably get away with it in libraries . Though it would be a nice gesture to keep it consistent . The code could also be a calculated combination , something like : `` ` major*10000 + minor*100 + patch `` ` So 1.4.0=10400 and 2.0.0=20000 . This accounts for any future releases with two digits in any of the versions . Alternative we can just lock all the android lib version codes to 0 or 1 because it does n't matter anyway ?
clicks when scrolling down __EoT__ Hi , thank you for all your beautiful examples . There is a bug that is annoying , in some listview examples when the user is on the topp of the list and is trying to scroll up ( swiping down ) then the item the user first touch is clicked or if the user scrolls up ( swiping down ) and holds then the onItemLongClick will be call for the fitrst touched item . So it is too easy to click on item when the user only swipes down at the top of the list . The problem can be found at ToolbarControlListviewActivity I hope I 'm being clear about the problem : ) And another bug i found is when you scroll up and down fast then the toolbar/sticky toolbar gets stuck and you are able to see and click at the padding views at the top of the list . so both problems can be found at the same example , ToolbarControlListviewActivity with sticky view .
ViewPagerTabListView/RecyclerView without using dummy padding as first item ? __EoT__ Hi @ ksoichiro Sorry it 's me again . I have a problem with view pager with sliding tab layout example . The problem with current example is - sometimes when you try scroll or slide a lot , you can see the blank padding / first item . - the vertical scroll indicator become strange because there is one item hidden below the tab . - when there is swiperefreshlayout , the refresh indicator became partially visible ( hidden below the tab ) I tried to use another approach without using dummy padding item for hours but luckily i did n't get the good result : ( I found an app example , it 's not material spec but it has the similar flow of design , and i think they did correctly . Here is the link . https : //play.google.com/store/apps/details ? id=jp.gocro.smartnews.android Notice in the app when we scroll the listview/recycler down , the scrollbar does n't showup but the tabs and the content moves up then after the tab reach the top , then we can scroll the listview/recyclerview . Any ideas how to accomplish this
Featuring apps on Main Page __EoT__ Hi @ ksoichiro This library is going excellent & I got an idea that you should put `` Apps that use this library '' on the Main page of your library . Let me know your views & if you feel do it then here is my app link : http : //www.youtube.com/watch ? v=DVwHCGAr_OE & feature=youtu.be Also , Can you update the Sample on Play Store with new things you added onto Github ?
Adding test for OverrideTabSelection and renamed the listener __EoT__ - Added tests - Added remove method for listeners instead of having to pass null - Changed signature of add listener methods to be @ NonNull
下拉正在加载中的时候，列表的点击事件被拦截了 __EoT__ 下拉正在加载中的时候，列表的点击事件被拦截了，请问能否加一个公开方法设置是否需要拦截点击事件。 在ACTION_DOWN事件中的拦截代码： if ( mPtrIndicator.hasLeftStartPosition ( ) ) { // do nothing , intercept child event } else { dispatchTouchEventSupper ( e ) ; }
your apk link is dead __EoT__ I would like to mention that your APK link is dead . I am trying to see the demo on the pull refresh thing . thank you so much . `` ` Error : A problem occurred configuring project ' : app ' . > Could not resolve all dependencies for configuration ' : app : _debugCompile ' . > Could not find com.google.android : support-v4 : r18 . Searched in the following locations : https : //jcenter.bintray.com/com/google/android/support-v4/r18/support-v4-r18.pom https : //jcenter.bintray.com/com/google/android/support-v4/r18/support-v4-r18.jar file : /Users/hesk/Library/Android/sdk/extras/android/m2repository/com/google/android/support-v4/r18/support-v4-r18.pom file : /Users/hesk/Library/Android/sdk/extras/android/m2repository/com/google/android/support-v4/r18/support-v4-r18.jar file : /Users/hesk/Library/Android/sdk/extras/google/m2repository/com/google/android/support-v4/r18/support-v4-r18.pom file : /Users/hesk/Library/Android/sdk/extras/google/m2repository/com/google/android/support-v4/r18/support-v4-r18.jar Required by : UltraPullRefresh : app : unspecified > in.srain.cube : cube-sdk:1.0.22 `` `
Add support for setting a custom User-Agent __EoT__ Closes # 6267 This PR adds an optional parameter when calling ` Realm.init ( ) ` . This will set the user part of the User-Agent string . I 'm using ` Realm.init ( ) ` as people are only calling this once and we also initialize the SyncManager as part of calling it . The extra constructor is only visible when using a build supporting the Object Server . `` ` // Usage Realm.init ( context , `` MyApp/ '' + BuildConfig.VERSION_NAME ) ; `` ` The String constructed by RealmJava will look like this for e.g . OnePlus : `` ` // Example of String for OnePlus RealmJava/5.8.0-SNAPSHOT ( OnePlus5T , ONEPLUS A5010 , v27 ) ObjectServerExample/1.0 `` ` The server will output something like this : `` ` // Server connection example from emulator 2018-11-02T10:52:30.103Z - info : [ sync ] Sync Connection [ 29 ] : Session [ 1 ] : Client info : ( path='/9e896ae0c1ff90402bc978cab085659f/tests ' , user='9e896ae0c1ff90402bc978cab085659f ' , from= [ 127.0.0.1 ] :46980 , protocol=25 ) RealmSync/3.13.1 ( Android Linux 4.4.34-genymotion # 1 SMP PREEMPT Mon Dec 5 15:49:16 UTC 2016 i686 ) RealmJava/5.8.0-SNAPSHOT (
Update CHANGELOG.md __EoT__ Fixed previous release note and added template for the next .
Bump ReLinker to 1.3.0 __EoT__ ReLinker 1.3.0 adds support for Android App Bundles , resolving # 5977 .
Move creating a SyncConfiguration to SyncUser __EoT__ As discussed , moving to Query-based Sync as the default needs to be less breaking , so this PR moves creating the SyncConfiguration to SyncUser and reintroduces the old methods but marks them as deprecated . All tests have been converted as well . The interesting files to review are ` SyncUser ` and ` SyncConfiguration `
Permissions fixes __EoT__ - Fixed ` noPrivileges ` and ` allPrivileges ` behaviours - Expose ` Role.getMembers ( ) ` to access associated members - Fixed Changelog to use the correct next patch version
Expose the per-user private role __EoT__ Sync is adding a private per-user role in realm/realm-sync # 2068 . We 'll need to update our schema to accommodate .
Expose bugs with findFirst __EoT__ Fixes # 5714 ` findFirst ` was broken in a lot of scenarios involving sorting which apparently was n't tested . The issue was that going directly to the ` Table ` API was n't the right choice when sorting is involved , so in those cases , we need to construct a TableView first . The CI failures are unrelated and will hopefully be fixed in another PR .
Disable Realm.delete* when using partial sync __EoT__ Fixes # 5780 Right now it is n't clear why anyone would use these methods in the first place when using partial sync . Also since the semantics of these methods are unclear , it is better to disable them with a proper message instead of a random crash . This also means we punt the problem till someone complains and we can judge the use cases then .
Failing to open synced realm after problems with internet . __EoT__ # # # # Goal Open synced realm using Realm.getInstanceAsync . # # # # Expected Results onSuccess called in provided callback # # # # Actual Results onError called with Throwable where message is set to `` UNKNOWN ( -1 ) It was not possible to download all remote changes . Has the SyncClient been started ? '' # # # # Steps & Code to Reproduce 1 ) call Realm.getInstanceAsync with waitForInitialRemoteData ( ) set in configuration . 2 ) if something happened while data is downloading ( internet connection lost , or user disable wifi or enter airplane mode ) onError called with proper message . This works as expected . 3 ) Restore connection to internet 4 ) Try to connect again with same configuration . 5 ) onError called with message that downloading is not possible . If you restart application - all works fine . # # # # Code Sample `` ` java RealmConfiguration config = new SyncConfiguration.Builder ( user , getServerURL ( ) ) .schemaVersion ( SCHEMA_VERSION ) .disableSSLVerification ( ) .waitForInitialRemoteData ( ) .build ( ) ; Realm.getInstanceAsync ( config
Support for overriding internal names using annotations __EoT__ Fixes https : //github.com/realm/realm-java/issues/2476 Fixes https : //github.com/realm/realm-java/issues/1616 This PR adds support for creating a mapping between internal names used by Realm and those used in the model classes which e.g . makes it easier to share schemas between languages without compromising the standard naming conventions in Java it is also possible to apply a ` RealmNamePolicy ` for a class or module instead of being forced to manually override each and every field . The basic implementation is a simple mapping scheme in Java before any relevant field or class name is sent to Object Store . As long as Object Store does not support a true dynamic mode , we can not have this functionality living there . `` ` // Set defaults on the module affecting all classes @ RealmModule ( classNamingPolicy = RealmNamePolicy.CAMEL_CASE , fieldNamingPolicy = RealmNamePolicy.CAMEL_CASE , allClasses = true ) public MyModule { } // Set class specific overrides @ RealmClass ( name = `` ! Person '' , fieldNamingPolicy = RealmNamePolicy.PASCAL_CASE ) public class Person extends RealmObject { // Field specific overrrides @ RealmField ( name = `` internal_name '' ) public string name ;
Release SNAPSHOTs from next-major __EoT__ CI now treats the ` next-major ` branch almost the same as ` master ` , execpt that metrics are still only being collected from ` master ` . But ` next-major ` will now build for all architectures as well as release SNAPSHOTs . CI failures will also be reported to Slack .
Remove getFieldNames from proxy classes __EoT__ These are no longer used since we moved to the Object Store schema concept . I found this while working on # 5280
Nh/ros test tiemout __EoT__ # # # Various CI fixes : - [ x ] Remove the Integration Test Suite that causes some integration tests to run twice - [ x ] Fixes an issue with ` Static code analysis ` stage which causes the CI to build all ABIs , despite the selection of only one ABI ( in case of ` releases ` build ) . This should speed PR builds . - [ x ] ROS is still taking longer to start sometimes , causing some Integration tests to fail , increase the wait to 30s - [ x ] Setting the timeout correctly on the Integration test ( increasing ` readTimeout ` instead of ` connectTimeout ` for ` OkHttp ` )
Fix typo __EoT__ Fix typo in CHANGELOG.md
Process safe deleteRealm and assetFile __EoT__ - Use SharedRealm : :call_with_lock ( ) to make sure deleteRealm and assetFile calls are process safe . - Also those calls will throw if the Realm instance on the sync client thread is still opened . - Disallow deleteRealm on a synced Realm file . See # 5416 . - Manually delete SharedRealm pointer if the SharedRealm was created for callbacks , eg . : initialization_data_callback and migration_callback .
Expose SyncSessionStopPolicy in SyncConfiguration __EoT__ This PR exposes the SyncSessionStopPolicy in SyncConfiguration . This will hopefully help combat the test assertions we are seeing with active sessions being present when a test ends . This is especially a problem in the PermissionManager tests that rely on internal Realms . Only downside is that ` SyncConfiguration.getSessionStopPolicy ( ) ` had to be made public . I put big fat warnings there though , so hopefully , it is okay ?
Use NPM to install integration test server __EoT__ This PR now lets us install the Realm Object Server used for our Integration tests using NPM instead of package cloud . Node.js 6.10+ is required . Changes -- -- - * Upgraded to use latest NPM package ( 2.0.0-alpha.30 ) * Server side token revocation disabled for now . * Changed ` retrieveUserInfo ` endpoint to match new behaviour * Disabled tests for ` changePassword ` . Functionality is currently broken * Workaround for bug with default admin user on ROS * Workaround for bug when stopping the ROS process
Keep SharedRealm 's inner classes __EoT__ Close # 5211
@ NotNull as alias for @ Required __EoT__ This PR adds support for ` org.jetbrains.annotations.NotNull ` as an alias for ` @ Required ` . This means that Realm now understands the Kotlin type-system in the Realm schema . Previously we reported an error if you did ` @ Required RealmList < MyType > list = new RealmList < > ( ) ; ` . It is a bit unclear why , since a RealmList is always non-null on managed objects . Since it made the interop with Kotlin kinda strange , I made a change so you can now do ` @ Required RealmList < MyType > list = new RealmLis < > ( ) ` as well as ` val list : RealmList < MyType > = RealmList ( ) ; ` After this change it is no longer possible to do ` val person : Person ` either , you have to do ` val person : Person ? ` . This reflects the constraints of Realm , but if people are able to maintain the variant themselves ( hint : not possible when using sync ) , then they can use a custom non-null getter .
Update a reference URL of Client Error __EoT__ @ morten-krogh told me that ` doc/protocol.md ` was not the one we should refer from ` ErrorCode.java ` . https : //github.com/realm/realm-sync/pull/1561 # issuecomment-323847407 I 've update the comment in ` ErrorCode.java ` .
Refactor compileFieldDescription ( ) in CachedFieldDescriptor and DynamicFieldDescriptor __EoT__ This PR did not change the logic at all , but gave a common prefix ` current ` to variables those are updated in the loop . The most important improvement in this PR is correct usage of ` table ` and ` class ` .
Fix Javadoc __EoT__ A couple of minor , last minute , tweaks , to the Javadoc .
Fix merge conflict resulting in duplicate error code __EoT__ Happened because another feature was merged into ` master ` that also added this code . The automatic merge could not detect this .
Allow multiple tasks to run after test is complete . __EoT__ Needed for # 4731
BLOB 's default value when convert to not-nullable __EoT__ `` '' is a char* type takes 1 byte of memory .
Enable encryption with Sync __EoT__ fixes # 4561
Factor out ManagedObject Interface __EoT__ Pull out the common interface needed for RealmInteger
Update grade wrappers and android gradle plugin __EoT__ I updated grade wrappers to ` 3.5 ` and android gradle plugin to ` 2.3.2 ` . And also added a small script ( ` update_gradle_wrapper.sh ` ) which updates gradle wrapper files . @ realm/java
Wait for async tasks finish to solve flaky test __EoT__ Apparently waiting some random millisecond is never a good idea .
Update ButterKnife to 8.5.1 __EoT__ ButterKnife 8 is required by Android Gradle Plugin 2.4.0 . @ realm/java
Add support for changing a users password . __EoT__ Fixes # 4423 TODO - [ x ] Align on if the API should be named ` changePassword ` or ` updatePassword ` - > ` changePassword ` it is
Update realm sync to 1.6.0 __EoT__ core to 2.6.1 Fix # 4461
Added support for SyncUser.isAdmin ( ) __EoT__ Fixes # 4353
Work around the memmove bug on Samsung device __EoT__ Fix # 3651
Enable distinct on unindexed fields __EoT__ Fix # 2285
Cancel transaction explicitly __EoT__ If ` Realm.getInstance ( ) ` is called in the 'transaction ' object , calling ` close ( ) ` does not cancel current transaction . To ensure that the transaction is not left open , cancel it explicitly if needed . @ realm/java
Correctly report Client Reset __EoT__ Fixes # 4080 TODO - [ x ] Unit tests - [ x ] Cleanup Javadoc - [ x ] Implement native code for Testing error - [ x ] Implement native code for executing the Client Reset manually -- -- -- Previously Client Reset was hidden among other error codes and not very visible . This PR adds explicit support for Client Reset similar to Cocoa . See # 4080 for alternatives to the API in this PR . I had a discussion with @ nhachicha , and we both agreed that breaking the API ( in a small way ) by adding a new error callback method was acceptable . Client Reset is such a destructive event that forcing devs to handle it explicitly is probably a good idea , and we get rid of all the ugly casts in https : //github.com/realm/realm-java/issues/4080 # issuecomment-285331612 I 'm not entirely sure about the name / methods for the error class yet , and have been switching between ` ClientResetError ` , ` ClientResetException ` and ` ClientResetRequiredError ` . I settled on the latter as it seems more descriptive and fits with the `
Proper RealmMigrationNeededException is now thrown . __EoT__ @ bmeike and others have run into this from time to time . But throwing the original exception makes much more sense when debugging . Apparently , we did n't have an issue tracking it .
Fixed a bug that the classes were replaced with a class in Gradle 's classpath __EoT__ Removed gradle 's class path from the Class pool of transformer . fixes # 3568
Expose schemaVersion in SyncConfig __EoT__ Fixes # 3982
Print the path when get File : :AccessError __EoT__ This is not ideal . In general this exception should be converted to RealmFileException then convert to java exception . But normally the first step is done in object store . Just work around it like this until we migrate to Object Store 's SyncManager .
Add multiple users support to UserStore __EoT__
RAII wrapper for some JNI resources __EoT__ * Move the global jvm pointer to JniUtils and add some helper functions . * Wrapper for jmethodID , global weak ref . * Refactor the wrapper for the local ref . * Before using the global weak ref , always try to acquire a local ref first since until Android 4.0 weak global references could only be passed to NewLocalRef , NewGlobalRef , and DeleteWeakGlobalRef . See https : //developer.android.com/training/articles/perf-jni.html # unsupported for more details . This fix # 3726 .
Set native library version to ReLinker __EoT__ Set native library version to ` ReLinker ` in order to prevent to use old native library . fixes # 3775 @ realm/java
fix a bug that realm-annotations-processor is not deployed to ojo __EoT__ When ` master ` branch is built on CI , ` ojoUpload ` task in ` realm/build.gradle ` is executed . However , that task is defined only in ` realm/realm-library/build.gradle ` , not in ` realm/realm-annotations-processor/build.gradle ` . This PR defines ` ojoUpload ` task in ` realm/realm-annotations-processor/build.gradle ` as well . @ realm/java @ emanuelez
Enable lcache on CI __EoT__ None
Download core from public location . Upgrade to latest sync beta . __EoT__ @ realm/java
Accelerate build with ccache and lcache __EoT__ See https : //github.com/beeender/lcache for source code for lcache . It is very simple right now . It identifies if the link target is cached by using checksums from command line + checksums of all input files .
Upgrade to Core 2.0.0 __EoT__ @ realm/java
remove print out from test case __EoT__
Maven support for Ubuntu __EoT__ @ bmunkholm @ mekjaer @ hovoere
Test coverage + column methods in TableOrView interface + @ Override annotations in Table and TableView __EoT__
camel case on getDistinctView __EoT__
add default value instruction support __EoT__ TODO : - [ x ] add SetDefault support to ` Table ` class - [ x ] update annotation processor to use SetDefault - [ x ] add tests Current limitation : following operations as a default value are not supported . - nullify a link - all operations ( such as adding element , removing element , and so on ) to RealmList
Updated readme 's with new link to online documentation __EoT__
add a task to clean jni header files when .so file is cleaned __EoT__ generated jni header files must be cleaned when cleaning ` .so ` files . @ realm/java
Move JNI build to cmake __EoT__ This is exciting . We can finally get rid of the jni project and generate the JNI header files on the fly . AND THE NATIVE DEBUGGING IS WORKING IN THE AS ! ! ( 2.2 preview 3 ) To use this : - ` ANDROID_NDK_HOME ` needs to be set - The ` com.android.tools.build : gradle:2.2.0-alpha2 ` requires java8 TODO : - [ x ] Make all ABIs work , currently only x86 - [ x ] Make all compiling options right - [ x ] Make core downloading work - [ x ] Strip the release version so files - [ x ] Copy the final results with debugs symbols out - [ x ] Fix hardcoded path to ` javah ` in ` CMakeList.txt ` - [ x ] Make CI work with cmake - [ x ] ~~Run CI test with released version so files.~~ This is not necessary . Debugging version is even better since lots of checks are disabled in release . - [ x ] Remove the ` realm-jni ` project - [ x ] Fix the disabled findbugs task - [ x ] Verify armeabi -
improve ` Table ` and schema cache . __EoT__ This PR solves following problems . - There are two ` Class to Table ` caches . One is in ` Realm ` class and another is in ` RealmSchema ` class. ` - The cache never hits against proxy classes .
Add RealmQuery.in ( ) __EoT__
Add section about examples . __EoT__ From time to time we have people that clone the repo to run the examples , and then get support questions on it since you need to assemble everything from the top-level directory first . Latest example : http : //stackoverflow.com/questions/38772301/realm-gradle-examples-project-refresh-failed This is n't entirely intuitive , but a consequence of our need to have multiple independent gradle projects . I added a small section to address this . @ realm/java
Remove unused mixed type __EoT__ The mixed type is not used by now and it is very unlikely going to be used in the future .
update realm logo __EoT__ @ realm/java
addPrimaryKey ( ) on RealmObjectSchema misses Index addition . __EoT__ ` RealmObjectSchema.addPrimaryKey ( ) ` is supposed to add a search index to its primary key field but it is currently missing . This is to fix the addition and removal of a search index related to primary key methods in ` RealmObjectSchema ` . Closes # 2819 . @ realm/java please review .
Nh/fix listener generics __EoT__ this is to avoid having the IDE auto-complete with ` < ? extends BaseRealm > ` so instead we 'll have `` ` java realm.addChangeListener ( new RealmChangeListener < Realm > ( ) { @ Override public void onChange ( Realm element ) { } } ) ; `` `
Better exception message when using custom migrations __EoT__ People not overriding ` equals ` in their custom Migration class is a common source of errors if people are creating multiple RealmConfiguration instances ( which they should n't in the first place ) , but at least this gives better hints to what is wrong . @ realm/java
APT is now correctly applied for unit tests in library projects . __EoT__ Apparently just having `` apt '' is not enough if you have a library project with unit tests that uses Realm . Explicitly adding the annotation processor to ` androidTestApt ` fixes that . I am guessing we also need to do the same for JVM tests with ` testApt ` , but since we do n't support that yet . I did n't do that in this PR . @ realm/java
Add bullet to changelog about behavior change of RealmList.first ( ) and RealmList.last ( ) __EoT__ related to # 2680 plus , this PR includes back-port of # 2656 ( Add bullet to changelog about new sorting behaviour on collections . )
Enable proper iterator behavior __EoT__ Closes # 602 Closes # 640 Closes # 2051 This PR changes the semantics of when RealmResults auto-refresh . In order to enable standard iterator behaviour we have to prevent the ` size ` of RealmResults to change automatically . This PR disables ` sync_if_needed ` for RealmResults in all cases , except when manually calling ` Realm.refresh ( ) ` or receiving a change notification from another thread through the looper . It is specifically disabled when committing on the same thread . This changes the semantics of RealmResults so there now is a chance it might contain deleted objects if one was deleted in the same looper event , but it will ensure that size ( ) is stable for that duration as well . This change is motivated by the fact that the first behaviour is much more common than relying on RealmResults _always_ being up to date . The HandlerController has been refactored in the process as it was already keeping track of all RealmResults . Is is now also responsible for refreshing RealmResults when appropriate . TODO - [ x ] Refactor HandlerController to support explicit refresh . - [
Initial dataset for a Realm __EoT__ Fixes [ # 2254 ] ( https : //github.com/realm/realm-java/issues/2254 )
Fix warnings in AdapterExample __EoT__ @ realm/java
Error in executeTransaction hides underlying problem __EoT__ I usually do all my transactions with the method _executeTransaction_ . It seems that if there is a runtime error , the underlying error gets hidden . `` ` public void executeTransaction ( Transaction transaction ) { if ( transaction == null ) throw new IllegalArgumentException ( `` Transaction should not be null '' ) ; beginTransaction ( ) ; try { transaction.execute ( this ) ; commitTransaction ( ) ; } catch ( RuntimeException e ) { cancelTransaction ( ) ; < -- -- throw new RealmException ( `` Error during transaction . `` , e ) ; } catch ( Error e ) { cancelTransaction ( ) ; throw e ; } } `` ` This is part of the stack trace I receive : `` ` 10-27 07:47:00.522 4419-4419/ch.beekeeper.debug E/AndroidRuntime : java.lang.IllegalStateException : Not inside a transaction . 10-27 07:47:00.522 4419-4419/ch.beekeeper.debug E/AndroidRuntime : at io.realm.internal.ImplicitTransaction.rollbackAndContinueAsRead ( ImplicitTransaction.java:71 ) 10-27 07:47:00.522 4419-4419/ch.beekeeper.debug E/AndroidRuntime : at io.realm.internal.SharedGroupManager.rollbackAndContinueAsRead ( SharedGroupManager.java:125 ) 10-27 07:47:00.522 4419-4419/ch.beekeeper.debug E/AndroidRuntime : at io.realm.BaseRealm.cancelTransaction ( BaseRealm.java:348 ) 10-27 07:47:00.522 4419-4419/ch.beekeeper.debug E/AndroidRuntime : at io.realm.Realm.cancelTransaction ( Realm.java:113 ) 10-27 07:47:00.522 4419-4419/ch.beekeeper.debug E/AndroidRuntime : at io.realm.Realm.executeTransaction ( Realm.java:1037 ) `` `
Update GitHub Issue Templates __EoT__ Split apart the old issue tempalte into 3 feature , bug , question . Expanded the template for feature a bit . This fixes # 2081
Check-health for Kafka Collector __EoT__ Use Admin Client API to validate that communication with Kafka brokers is working correctly . Attempt to fix # 2098
Moves server packages into zipkin2 to simplify logging __EoT__ Currently , we have to specify dual roots for logging categories due to historical use of mixed types . This moves everything into the same package which is not only a win for consistency , but also allows simpler logging configuration . Note ` zipkin.server.ZipkinServer ` and ` zipkin.server.EnableZipkinServer ` are retained to not break people launching via java directly . See # 2047
Skip filtering traces from result when STRICT_TRACE_ID is set to true __EoT__ https : //github.com/openzipkin/zipkin/blob/3f299cda195af7b1685a11e262dcd6a554dec2a1/zipkin-storage/elasticsearch/src/main/java/zipkin2/elasticsearch/ElasticsearchSpanStore.java # L116 The check to remove traces from the result can be skipped if STRICT_TRACE_ID is enabled .
Prevents overlapping calls to health check __EoT__ Health checks can be expensive , so this ensures only one at a time . Note : this is different than deduping health checks ( ex sharing a response from concurrent requests ) . That 's more complicated and can be done later if needed . Fixes # 1907
Update MySQL header copyright date . __EoT__ ` ./mvnw -DskipTests -- also-make -pl zipkin-server clean install ` fails with [ ERROR ] Failed to execute goal com.mycila : license-maven-plugin:3.0 : check ( default ) on project zipkin-storage-mysql : Some files do not have the expected license header - > [ Help 1 ]
Fixes bad partitioning of data in the v1 memory store __EoT__ *Note* this only affects people using the v1 in-memory component . The in-memory option of zipkin-server does not use this even if v1 format is accepted . This fixes a partitioning messup where all spans for the same timestamp filed under the same key .
Pretties cassandra3 toString and backfills tests __EoT__
Use upstream Prometheus client and Spring integration __EoT__ This change replaces our custom logic for exposing metrics with the implementation in the upstream Prometheus client , as noted in https : //github.com/openzipkin/zipkin/pull/1144 # issuecomment-288762140 . The notable improvement ( other than less code ) is the addition of histogram data of response times , using a servlet filter ( the data looks something like this : https : //gist.github.com/abesto/46aeb18ab45e5126ccebc515eb3fc99f ) Metrics comparison : [ before ] ( https : //gist.github.com/abesto/25594dc217e70ad9b9bddd656eb663d4 ) / [ after ] ( https : //gist.github.com/abesto/0e9afff23daacb0f4301c9b977012ad5 ) There were two issues that blocked us from merging this for a while : * [ x ] We 're hit by https : //github.com/prometheus/client_java/issues/252 ( pops up only when Prometheus tries to query the data , you can still check out ` /prometheus ` from a browser just fine ) * [ x ] The upstream integration with Spring Boot Actuator metrics does n't use the ` counter. ` and ` gauge. ` prefixes to figure out the right metric type , always defaults to ` gauge ` . https : //github.com/prometheus/client_java/pull/254 aims to fix this .
Adds v2 StorageComponent and allows the server to use it directly __EoT__ This adds a type for the v2 StorageComponent so that future storage implementations can be made without a compile dependency on the v1 jar . This is internal until everything is verified .
Adds v2 http query api __EoT__ This adds the v2 read endpoints . Swagger will come later .
Organizes v2 classes into corresponding internal packages __EoT__ Interim step in preparation of a top-level zipkin2 package See # 1644
Accepts Zipkin v2 Span format in all current transports __EoT__ This accepts the json format from # 1499 on current transports . It does so by generalizing format detection from the two Kafka libraries , and a new ` SpanDecoder ` interface . Types are still internal , but this allows us to proceed with other work in # 1644 , including implementing reporters in any language . Concretely , you can send a json list of span2 format as a Kafka or Http message . If using http , use the /api/v2/spans endpoint like so : `` ` bash $ curl -X POST -s localhost:9411/api/v2/spans -H'Content-Type : application/json ' -d ' [ { `` traceId '' : `` 9032b04972e475c5 '' , `` id '' : `` 9032b04972e475c5 '' , `` kind '' : `` SERVER '' , `` name '' : `` get '' , `` timestamp '' : 1502101460678880 , `` duration '' : 612898 , `` localEndpoint '' : { `` serviceName '' : `` brave-webmvc-example '' , `` ipv4 '' : `` 192.168.1.113 '' } , `` remoteEndpoint '' : { `` serviceName '' : `` '' , `` ipv4 '' : `` 127.0.0.1 '' ,
Fixes bug where Span.Builder.duration was n't cleared __EoT__
Fix UI code to reference api under base path /zipkin __EoT__ The last change `` missed a spot '' which was n't noticable due to a false positive in ZipkinServerIntegrationTest . We should consider rewriting this test class if MockMvc is n't reliable .
Refactors in-memory storage so that there 's a common type across data sets __EoT__ This rejigs things so that the pair of ( traceID , timestamp ) is used consistently across all data sets that grow unbounded . This should make it easier to support purging later . For example one implementation could be to iterate traceIdToTraceIdTimeStamps in reverse ( using delegate.descendingKeySet ( ) ) , which should give the eldest trace ID and delete that . When weak references are used elsewhere , GC should clean them up . Other mechanisms besides weak references could be used as well . See # 1528
Allow query-only servers to disable the HTTP collector __EoT__ We have a Zipkin deployment where there is one instance of zipkin-server providing the query API and a second instance running the ( kafka in our case ) collector . The zipkin-server instance providing the query API will be exposed to HTTP traffic from our internal network and it is preferable if the exposed HTTP API is read-only to prevent users from creating span data . Disabling the HTTP collector accomplishes this . The motivation for this change is similar to the rationale described on # 1591 , and the approach taken to implement this is very similar to the one from the PR for that issue ( # 1593 ) . These changes add a configuration point for enabling or disabling the HTTP collector in zipkin-server . This can be controlled through the property zipkin.collector.http.enabled or the corresponding environment variable HTTP_COLLECTOR_ENABLED . The collector is enabled by default .
Corrects search results to display total spans as `` NN Spans '' __EoT__ Before , the search results view showed the total service/span pairs as opposed to the total spans . This made things confusing as when people clicked into the trace detail view the total spans would be a different sometimes smaller count .
Flags yellow for annotations that match case insensitive error __EoT__ Particularly , this flags existing finagle formatted errors , like so : '' Server Send Error : TimeoutException : socket timed out '' Fixes # 1472 See https : //github.com/openzipkin/openzipkin.github.io/issues/52
Adds release instructions for next year __EoT__
Dependency version bumps __EoT__ Notably Spring Boot 1.4.3
Add documentation on the logsUrl feature . __EoT__ With https : //github.com/openzipkin/zipkin/pull/1414 , we can add a button to link directly the trace and its logs . This review adds the documentation of this feature .
Use default withSSL ( ) settings for cassandra __EoT__ This is an optin to use ` withSSL ` for the cassandra driver . This will require the java keystore and so on to be configured correctly on the server so that the cassandra certificate is present . I have not tested this yet but wanted more feedback . This is a simplification of # 1396
Fixed Navbar in Zipkin UI __EoT__ Currently , on narrow screens or when the window is resized on wide screens , the nav bar in zipkin UI covers the content ( can be simulated by resizing the browser window size ) . The ideal solution is to move the content down after the navbar when the screen is resized . In the current UI , this happens because the navbar is fixed and is always displayed . This behavior has a few issues : a ) In the zipkin UI there is no need to show the navbar always . If a user wants to use the navbar he can scroll up . b ) On the trace page , displaying the navbar not only covers the content but also covers the spans when the trace is large . If the nav bar can be scrolled up we can use that screen real estate to see more spans . c ) On home page , the nav bar would cover the trace selection form when the browser window is resized . I have tested this change in-browser.You can experiment with the navbar behavior here : https : //getbootstrap.com/examples/navbar-static-top/ In the
Create bundle for zipkin core __EoT__
Serializes I64 numbers greater than 53bits as strings in json __EoT__ While usage of binary annotation type I64 is discouraged , Finagle lets you do it Fixes # 1372
Writes Span.traceIdHigh last so that it is exactly the same as libthrift __EoT__ Consistency on field order is n't required by thrift , but this writes the fields in ID order to make exact binary comparison pass vs libthrift .
Documents why core annotations are not shown in the UI __EoT__ See https : //github.com/openzipkin/zipkin/issues/1284 # issuecomment-246141155
Lowers scope of Elasticsearch to code used in prod __EoT__ writeDependencyLinks is package protected and was only used in tests . the spark job has its own implementation
[ zipkin-ui ] Fix install-node-and-npm __EoT__ As discussed in https : //github.com/eirslett/frontend-maven-plugin/issues/294
Moves zipkin-core language level to JRE 6 __EoT__ This is an api compatible change to allow code sharing between zipkin server and instrumentation , and without having to publish 2 jar files . We accidentally broke the ability to make agent-based instrumentation by compiling our model classes against Java 7 bytecode . Particularly , this causes a regression in Brave . To move back to Java 6 bytecode , we had to do a few things : - replace moshi internal dependency with gson , which is java 6 compliant - remove okio dependency and copy its Base64 class - incidentally a class it also copied ! - do variable-size buffer writes w/ byte arrays instead of okio - fix a few nags about diamond ops etc . See https : //github.com/openzipkin/brave/issues/225
Adds error-prone checks to the build __EoT__ error-prone is a tool that catches common problems at compile time . For example , it can figure out if you wrote equals incorrectly , or didn't use a volatile when double-checking a value . Non-critical concerns print out as warnings in the compiler log . See http : //errorprone.info/
Replaces hand-written query logging with DataStax QueryLogger __EoT__ Hand-written query logging has resulted in bugs and also clutters the codebase . This change replaces that with DataStax QueryLogger , which is enabled when the category `` com.datastax.driver.core.QueryLogger '' is at debug or trace level . Trace level includes bound values . Ex . `` ` bash $ STORAGE_TYPE=cassandra java -jar zipkin-server/target/zipkin-server-*-exec.jar -- logging.level.zipkin=debug -- logging.level.com.datastax.driver.core.QueryLogger=trace -- snip -- 2016-06-30 15:28:05.742 TRACE 27669 -- - [ r2-nio-worker-1 ] c.d.driver.core.QueryLogger.NORMAL : [ cluster2 ] [ localhost/127.0.0.1:9042 ] Query completed normally , took 10 ms : [ 4 bound values ] INSERT INTO annotations_index ( annotation , bucket , ts , trace_id ) VALUES ( : annotation , :bucket , :ts , :trace_id ) ; [ annotation:0x7a69706b696e2d7365727665723a4170706c69636174696f ... [ truncated output ] , bucket:9 , ts:1467271680225 , trace_id:3814895566661605459 ] `` ` See [ Logging Query Latencies ] ( http : //docs.datastax.com/en/developer/java-driver/2.1/supplemental/manual/logging/ # logging-query-latencies ) for more details . Fixes https : //github.com/openzipkin/zipkin-java/issues/190
Redis Storage/Index builders __EoT__ Move Redis Storage/Index to builder style configs
Add enterprise quality unit tests __EoT__ I am writing a tool to generate unit tests automatically from manual testing / integration tests . As part of its testing suite , I have generated some tests for FizzBuzzEnterpriseEdition . I thought this might fit in here .
Non-persistent cookies ( cookie.isPersistent ( ) == false ) get stored . __EoT__ Hi , I noticed that session cookies , which should get deleted when closing the app , are stored in the PersistentCookieStore . The session cookie has no expiration date set , but a call to isPersistent ( ) returns false . I looked at the PersistentCookieStore class and found that there is no check for wether the cookie should be persisted or not , so all cookies are stored in SharedPreferences .
Added few useful methods __EoT__ Enable put int and long data directly into urlParams Send String response to onFailure if parseResponse ( ) returns String Add cancelAllRequests method
Use a safe wrapper for closing I/O streams , where it makes sense . __EoT__
Expose classes since they 're being used in other public methods . __EoT__
Small misc . fixes . __EoT__
Unhandled failure ( no callbacks ! ) when an invalid URI is used __EoT__ When an invalid URI is used , say `` somehwere.com '' ( note no `` http : // '' ) , then the call to makeRequest ( ) ( line 93 of AsyncHttpRequest.java ) results in a java.lang.IllegalStateException being thrown . Since the try catch statement surrounding the call to makeRequest ( ) only catches UnknownHostException , IOException and NullPointerException , this exception is not noticed , and nothing happens ! ( there is no indication to the code which made the request of any problem , and no timeout ever occurs ) . I also noticed a different exception when using hostnames with underscores . Eg . `` http : //broken_hostname.com '' results in a java.lang.IllegalArgumentException being thrown by the makeRequest ( ) method . I suggest adding the following catch case to the try catch statement in `` ` java catch ( Exception e ) { if ( responseHandler ! = null ) { responseHandler.sendFailureMessage ( e , `` Unhandled exception '' ) ; } return ; } `` `
Custom ` SchemeRegistry ` for created HttpClient in AsyncHttpClient __EoT__ This project looks good , and it is very close to what we need in our project . One thing that is a potential snag is the inability to set a custom ` SchemeRegistry ` when creating a new instance of ` AsyncHttpClient ` . ( Our project must have a custom ` SocketFactory ` for ` https ` as our QA servers use self signed certificates . ) Since the ` SchemeRegistry ` ca n't be set on a ` HttpClient ` after creating it , getting a reference to the ` HttpClient ` wo n't help either . I would suggest adding another constructor to ` AsyncHttpClient ` that pass in a , say , ` HttpClientBuilder ` that has overridable methods for getting the ` SchemeRegistry ` , socketTimeout parameters etc ? Then our project could create a specialised version of that class when we create a new ` AsyncHttpClient ` , that sets up the ` ConnectionManager ` with our desired ` SchemeRegistry ` .
Request not callback onSuccess ( ) handler __EoT__ I trying to call the request ( get ) in fragment to a simple rest service which I 've tested it by tradional way and everything is fine . But when I calling using asyn http lib it 's only callback to onStart but after that , nothing occur . Not even onFailure This might be an issue with android 4.1 and master-details nav style . Thanks for any response .
Added removeHeader __EoT__ That 's a feature I added to my personal copy of android-async-http , I needed that during my work .
Use a thread for parsing JSON __EoT__ This fixes issue # 120
Modified handleFailureMessage to handle string-only response . __EoT__ In cases where the server 's response is , for instance `` Unauthorized '' , this method currently ignores the message as it is not a JSONObject or a JSONArray . A string /is/ a valid JSON value though , legitimately returned by JSONTokener ( so no exceptions are thrown and we therefore get no feedback on what went wrong ) . I have therefore added an extra else-if branch to call onFailure ( Throwable , String ) in the parent class for such situations .
Proper support for GIFs when using a RetainingDataSource __EoT__ # # Motivation ( required ) During the development of the Giphy app we choose to use fresco as our main image library . The application loads different types of image renditions , starting from low-quality images to high-quality ones . We wanted to be able to change the quality of a GIF displayed in a ` DraweeView ` . When making a simple request to change the resource of a ` DraweeView ` , fresco will clear the current content , display the placeholder , then load the new resource . Even with the resources preloaded , there is a noticeable flickering . Available solutions : 1 . Use a low-res/hi-res schema for loading images . Unfortunately , in this schema , the low-res image is not animated . 2 . Use a ` RetainingDataSource ` . While it 's purpose was exactly what we were looking for , it turns out that this data source , does it 's magic by lying to the ` AbstractDataSource ` code and keeping it in a forever ` PROGRESS ` state . That means , the datasource will never get to notify
Add support for windows ico image format __EoT__ # # Motivation There is some case we need load .ico format image to SimpleDraweeView and BitmapFactory support decode this format on Android System but fresco not support . Though we can write our own CustomDecoder and config it into fresco , we expect the fresco could support it natively . This can be achieved by only add a little code in ` DefaultImageFormatChecker ` . # # Test Plan http : //static.iqiyi.com/ext/common/ffb4f4483feb4c78b9cb74b7eee8d5d3.ico This ico file can be used for test . It works well on my devices .
Not able to set hotspot on `` overlayImage '' drawable set in xml __EoT__ I have set `` app : overlayImage '' drawable on SimpleDraweeView in xml layout for adding selector ripple effect on top of SimpleDraweeView . Setting `` overlayImage '' attribute correctly showing ripple effect on image but hot spot is always showing from center . To solve this I need the overlayImage drawable that I had set in xml resource but I did n't find any method to get overlayImage drawable programmatically . If I prepare GenericDraweeHierarchy programmatically then I can prepare overlayImage drawable and can set touch listener hot spot to it . Code snippet : SimpleDraweeView image = ( SimpleDraweeView ) findViewById ( R.id.image ) ; GenericDraweeHierarchyBuilder builder = new GenericDraweeHierarchyBuilder ( mContext.getResources ( ) ) ; Drawable overlayImage = getDrawable ( R.drawable.image_selector ) ; builder.setOverlay ( overlayImage ) ; image.setHierarchy ( builder.build ( ) ) ; if ( Build.VERSION.SDK_INT > = Build.VERSION_CODES.LOLLIPOP ) { view.setOnTouchListener ( new View.OnTouchListener ( ) { @ TargetApi ( Build.VERSION_CODES.LOLLIPOP ) @ Override public boolean onTouch ( View v , MotionEvent event ) { if ( overlayImage ! = null ) { overlayImage.setHotspot ( event.getX ( ) , event.getY
V3.0 __EoT__ added zh-TW
Enable Group MMS Threading __EoT__ Added functionality to thread MMS messaged with multiple recipients . The feature is enabled when the preference is checked in the Settings of the updated Mms.apk ( platform_packages_apps_mms ) that allows sending of Group MMS messages .
Enable Group MMS Threading __EoT__ Added functionality to thread MMS messaged with multiple recipients . The feature is enabled when the preference is checked in the Settings of the updated Mms.apk ( platform_packages_apps_mms ) that allows sending of Group MMS messages .
Added quaternion rotation methods to android.opengl.Matrix __EoT__ Based on the formula described at http : //en.wikipedia.org/wiki/Rotation_matrix # Quaternion
Update tools/aapt/ResourceTable.cpp __EoT__ Fix for Issue 24912 http : //code.google.com/p/android/issues/detail ? id=24912
Corrected `` Home '' translation in proper context __EoT__ previous translation was literaly `` homepage ''
Disable getter/setter generation __EoT__ Hi , I forked the generator to generate the setter for the entities only if it 's an active entity . However , I would like to switch to Greendao 3 with the annotation base generator . If I not mistaken , there is no way to avoid the creation of the setters . Do you think I should create a PR to add this function ?
LazyList.subList ( ) does not load entities for subList ( are null ) __EoT__ The problem is that LazyList gets the entities directly from internally stored entities : `` ` java for ( int i = start ; i < end ; i++ ) { entities.get ( i ) ; } `` ` instead of loading them for real : `` ` java for ( int i = start ; i < end ; i++ ) { get ( i ) ; } `` `
implementsInterface ( ) - called with same interface-string multiple times __EoT__ If `` implementsInterface ( String ) gets called multiple times , with the same parameterstring , the resulting entity will be implementing the given Interface multiple times as well , which will cause an error during compilation of the entity . For example : Entity e = schema.addEntity ( `` TestEntity '' ) ; e.implementsInterface ( `` ITest '' ) ; e.implementsInterface ( `` ITest '' ) ; ... will produce the following : public class TestEntity implements ITest , ITest { ... } This could be solved by replaceing : List < String > interfacesToImplement ; with : Set < String > interfacesToImplement ;
AbstractRegistryFactory Unit Test : destroyAll method __EoT__ # # What is the purpose of the change XXXXX # # Brief changelog XXXXX # # Verifying this change XXXXX Follow this checklist to help us incorporate your contribution quickly and easily : - [ x ] Make sure there is a [ GITHUB_issue ] ( https : //github.com/apache/incubator-dubbo/issues ) filed for the change ( usually before you start working on it ) . Trivial changes like typos do not require a GITHUB issue . Your pull request should address just this issue , without pulling in other changes - one PR resolves one issue . - [ ] Format the pull request title like ` [ Dubbo-XXX ] Fix UnknownException when host config not exist # XXX ` . Each commit in the pull request should have a meaningful subject line and body . - [ ] Write a pull request description that is detailed enough to understand what the pull request does , how , and why . - [ ] Write necessary unit-test to verify your logic correction , more mock a little better when cross module dependency exist . If the new feature or significant change is committed
[ Dubbo-2348 ] AbstractRegistry util test enhancement __EoT__ # # What is the purpose of the change fix # 2348 # # Brief changelog add AbstractRegistryTest getCacheUrlsTest method # # Verifying this change XXXXX Follow this checklist to help us incorporate your contribution quickly and easily : - [ x ] Make sure there is a [ GITHUB_issue ] ( https : //github.com/apache/incubator-dubbo/issues ) filed for the change ( usually before you start working on it ) . Trivial changes like typos do not require a GITHUB issue . Your pull request should address just this issue , without pulling in other changes - one PR resolves one issue . - [ x ] Format the pull request title like ` [ Dubbo-XXX ] Fix UnknownException when host config not exist # XXX ` . Each commit in the pull request should have a meaningful subject line and body . - [ x ] Write a pull request description that is detailed enough to understand what the pull request does , how , and why . - [ x ] Write necessary unit-test to verify your logic correction , more mock a little better when cross module dependency exist .
[ Dubbo-random enhance ] replace Random with ThreadLocalRandom __EoT__ # # What is the purpose of the change A little change , replace ` Random ` with ` ThreadLocalRandom ` . Use of ` ThreadLocalRandom ` rather than shared ` Random ` objects in concurrent programs will typically encounter much less overhead and contention . Use of ` ThreadLocalRandom ` is particularly appropriate when multiple tasks . # # Brief changelog replace ` Random ` with ` ThreadLocalRandom ` in ` LeastActiveLoadBalance ` and ` RandomLoadBalance ` . # # Verifying this change reuse the test case already exist . Follow this checklist to help us incorporate your contribution quickly and easily : - [ x ] Make sure there is a [ GITHUB_issue ] ( https : //github.com/apache/incubator-dubbo/issues ) filed for the change ( usually before you start working on it ) . Trivial changes like typos do not require a GITHUB issue . Your pull request should address just this issue , without pulling in other changes - one PR resolves one issue . - [ x ] Format the pull request title like ` [ Dubbo-XXX ] Fix UnknownException when host config not exist # XXX `
New ascii logo . __EoT__ New ascii logo . Voting is here : https : //github.com/apache/incubator-dubbo/issues/2332
[ Dubbo-BOM ] Changed parent pom to Dubbo root __EoT__ # # What is the purpose of the change Set Dubbo root pom as parent also for BOM module . Follow this checklist to help us incorporate your contribution quickly and easily : - [ x ] Make sure there is a [ GITHUB_issue ] ( https : //github.com/apache/incubator-dubbo/issues ) filed for the change ( usually before you start working on it ) . Trivial changes like typos do not require a GITHUB issue . Your pull request should address just this issue , without pulling in other changes - one PR resolves one issue . - [ x ] Format the pull request title like ` [ Dubbo-XXX ] Fix UnknownException when host config not exist # XXX ` . Each commit in the pull request should have a meaningful subject line and body . - [ x ] Write a pull request description that is detailed enough to understand what the pull request does , how , and why . - [ ] Write necessary unit-test to verify your logic correction , more mock a little better when cross module dependency exist . If the new feature or
upgrade netty for dubbo-all __EoT__ # # What is the purpose of the change Because dubbo use netty4 as the default transport , so upgrade netty dependency for dubbo-all # # Brief changelog dubbo-all/pom.xml # # Verifying this change XXXXX Follow this checklist to help us incorporate your contribution quickly and easily : - [ x ] Make sure there is a [ GITHUB_issue ] ( https : //github.com/apache/incubator-dubbo/issues ) filed for the change ( usually before you start working on it ) . Trivial changes like typos do not require a GITHUB issue . Your pull request should address just this issue , without pulling in other changes - one PR resolves one issue . - [ ] Format the pull request title like ` [ Dubbo-XXX ] Fix UnknownException when host config not exist # XXX ` . Each commit in the pull request should have a meaningful subject line and body . - [ ] Write a pull request description that is detailed enough to understand what the pull request does , how , and why . - [ ] Write necessary unit-test to verify your logic correction , more mock a little better when cross module
Docs in AsyncContext __EoT__ * Docs in AsyncContext * Make the future final which is in the constructor of AsyncRpcResult because of using in a inner class .
fix unit test failure __EoT__ # # What is the purpose of the change fix unstable test case # # Brief changelog dubbo-config/dubbo-config-api/src/test/java/org/apache/dubbo/config/AbstractConfigTest.java # # Verifying this change XXXXX Follow this checklist to help us incorporate your contribution quickly and easily : - [ x ] Make sure there is a [ GITHUB_issue ] ( https : //github.com/apache/incubator-dubbo/issues ) filed for the change ( usually before you start working on it ) . Trivial changes like typos do not require a GITHUB issue . Your pull request should address just this issue , without pulling in other changes - one PR resolves one issue . - [ ] Format the pull request title like ` [ Dubbo-XXX ] Fix UnknownException when host config not exist # XXX ` . Each commit in the pull request should have a meaningful subject line and body . - [ ] Write a pull request description that is detailed enough to understand what the pull request does , how , and why . - [ ] Write necessary unit-test to verify your logic correction , more mock a little better when cross module dependency exist . If the new feature or significant change is
No such configuration property version __EoT__ https : //github.com/apache/incubator-dubbo/blob/5a4c0768fd8989c1f82710a50a288e26fa69215a/dubbo-config/dubbo-config-spring/src/test/resources/com/alibaba/dubbo/config/spring/annotation-version-consumer.xml # L26 as above , there is no configuration property ` version ` in dubbo.xsd , it is eally confused . i think it could be removed if no other purpose .
rename access log in unit test from 'alibaba ' to 'alibaba.log ' __EoT__ # # What is the purpose of the change rename access log in unit test from 'alibaba ' to 'alibaba.log ' # # Brief changelog dubbo-rpc/dubbo-rpc-api/src/test/java/org/apache/dubbo/rpc/filter/AccessLogFilterTest.java # # Verifying this change XXXXX Follow this checklist to help us incorporate your contribution quickly and easily : - [ x ] Make sure there is a [ GITHUB_issue ] ( https : //github.com/apache/incubator-dubbo/issues ) filed for the change ( usually before you start working on it ) . Trivial changes like typos do not require a GITHUB issue . Your pull request should address just this issue , without pulling in other changes - one PR resolves one issue . - [ ] Format the pull request title like ` [ Dubbo-XXX ] Fix UnknownException when host config not exist # XXX ` . Each commit in the pull request should have a meaningful subject line and body . - [ ] Write a pull request description that is detailed enough to understand what the pull request does , how , and why . - [ ] Write necessary unit-test to verify your logic correction , more mock a
Enhance the test coverage part-12 : dubbo-registry/dubbo-registry-multicast ( dubbo-registry-redis|dubbo-registry-zookeeper ) __EoT__ Add unit test to the modules : dubbo-registry/dubbo-registry-multicast dubbo-registry/dubbo-registry-redis dubbo-registry/dubbo-registry-zookeeper
Remove unnecessary null check . __EoT__ Remove unnecessary null check .
fix isShutdown always return true __EoT__ change isShutdown to isTerminated
optimize unit test for serialization hession2/jdk/kryo __EoT__ # # What is the purpose of the change optimize unit test for serialization hession2/jdk/kryo # # Brief changelog modified : dubbo-serialization-hessian2/src/test/java/com/alibaba/dubbo/common/serialize/serialization/AbstractSerializationTest.java modified : dubbo-serialization-jdk/src/test/java/com/alibaba/dubbo/common/serialize/serialization/AbstractSerializationTest.java new file : dubbo-serialization-jdk/src/test/java/com/alibaba/dubbo/common/serialize/serialization/NativeJavaSerializationTest.java modified : dubbo-serialization-kryo/src/test/java/com/alibaba/dubbo/common/serialize/serialization/AbstractSerializationTest.java # # Verifying this change All unit test cases are pass . Follow this checklist to help us incorporate your contribution quickly and easily : - [ x ] Make sure there is a [ GITHUB_issue ] ( https : //github.com/apache/incubator-dubbo/issues ) filed for the change ( usually before you start working on it ) . Trivial changes like typos do not require a GITHUB issue . Your pull request should address just this issue , without pulling in other changes - one PR resolves one issue . - [ x ] Format the pull request title like ` [ Dubbo-XXX ] Fix UnknownException when host config not exist # XXX ` . Each commit in the pull request should have a meaningful subject line and body . - [ x ] Write a pull request description that is detailed enough to understand what the pull request does , how , and why . - [ x ] Write necessary unit-test
Unify the behavior of setAttachments method in RpcInvocation and RpcResult __EoT__ RpcInvocation 中的 setAttachments 是设置新的 Attachments，是替换，RpcInvocation 中的 setAttachments 是添加新的 Attachments 到原 Attachments中，是追加，这两处应该保持一致。
[ Dubbo-1284 ] Fix UT warning message when running on Java 9 __EoT__ # # What is the purpose of the change Fix [ issues ] ( https : //github.com/alibaba/dubbo/issues/1284 ) # # Brief changelog Support ` MetaspaceSize ` and ` MaxMetaspaceSize ` vm args on java 8+
dubbo provider side ca n't find service when deployed in docker . __EoT__ 有些部署场景需要动态指定服务注册的地址，如docker bridge网络模式下要指定注册宿主机ip以实现外网通信。dubbo提供了两对启动阶段的系统属性，用于设置对外通信的ip、port地址 DUBBO_IP_TO_REGISTRY -- - 注册到注册中心的ip地址 DUBBO_PORT_TO_REGISTRY -- - 注册到注册中心的port端口 docker环境下对外服务的端口为DUBBO_PORT_TO_REGISTRY , 但服务提供端在读取端口号时读取到的是本地端口号导致无法找到对应的服务。BUG信息如下： Not found exported service : hbec.app.test.service.TestService:20881 in [ hbec.app.test.service.TestService:31838 ] 问题代码如下 : DubboProtocol类 Invoker < ? > getInvoker ( Channel channel , Invocation inv ) throws RemotingException { boolean isCallBackServiceInvoke = false ; boolean isStubServiceInvoke = false ; int port = channel.getLocalAddress ( ) .getPort ( ) ; // # 注 : 在docker环境下该端口取的是本地端口，非环境变量端口 String path = inv.getAttachments ( ) .get ( Constants.PATH_KEY ) ; // if it 's callback service on client side isStubServiceInvoke = Boolean.TRUE.toString ( ) .equals ( inv.getAttachments ( ) .get ( Constants.STUB_EVENT_KEY ) ) ; if ( isStubServiceInvoke ) { port = channel.getRemoteAddress ( ) .getPort ( ) ; }
Fix a wrong judgment __EoT__ # # update at CacheFilter.java String key = StringUtils.toArgumentString ( invocation.getArguments ( ) ) ; 上述方式获取的key不为null 且cache=null的判断是冗余的 同时 添加了dubbo-filter部分的 @ Override 初看dubbo代码 如无误 望采纳
MINOR : Fix a few blocking calls in PlaintextConsumerTest __EoT__ We 've been seeing some hanging builds recently ( see KAFKA-7553 ) . Consistently the culprit seems to be a test case in PlaintextConsumerTest . This patch does n't fix the underlying issue , but it eliminates a few places where these test cases could block : 1 . It replaces several calls to the deprecated ` poll ( long ) ` which can block indefinitely in the worst case with ` poll ( Duration ) ` which respects the timeout . 2 . It also fixes a consume utility in ` TestUtils ` which can block for a long time depending on the number of records that are expected to be consumed . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7524 : Recommend Scala 2.12 and use it for development __EoT__ Scala 2.12 has better support for newer Java versions and includes additional compiler warnings that are helpful during development . In addition , Scala 2.11 has n't been supported by the Scala community for a long time , the soon to be released Spark 2.4.0 will finally support Scala 2.12 ( this was the main reason preventing many from upgrading to Scala 2.12 ) and Scala 2.13 is at the RC stage . It 's time to start recommending the Scala 2.12 build as we prepare support for Scala 2.13 and start thinking about removing support for Scala 2.11 . In the meantime , Jenkins will continue to build all supported Scala versions ( including Scala 2.11 ) so the PR and trunk jobs will fail if people accidentally use methods introduced in Scala 2.12 . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Bump timeout for sending records __EoT__ Set timeout to be consistent with changes to ` 2.0 ` # 5841 when merged we should cherry-pick to ` 2.1 ` # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : KStreams SuppressionIntegrationTest should set StreamsConfig.STATE_CONFIG_DIR . __EoT__ This sets StreamsConfig.STATE_DIR_CONFIG to temp directory in KStreams SuppressionIntegrationTest , to match StreamsTestUtils . This is a similar fix to https : //github.com/apache/kafka/pull/5826 .
KAFKA-7532 : Fix controller log for list of shutting down brokers __EoT__ As reported in [ KAFKA-7532 ] ( https : //issues.apache.org/jira/browse/KAFKA-7532 ) - this line prints out `` ` [ 2018-10-23 12:19:59,977 ] INFO [ Controller id=0 ] Removed ArrayBuffer ( ) from list of shutting down brokers . ( kafka.controller.KafkaController ) `` ` This change seems to be present in all versions even as back as ` 0.9.0 ` . I think it might be worth it to merge to ` 1.0 ` ( pre-2.0 uses ` `` '' .format ( ) ` )
MINOR : Ensure consumers are closed in DynamicBrokerReconfigurationTest __EoT__ In ` ConsumerBuilder.build ` , if ` awaitInitialPositions ` raises an exception , the consumer will not be closed properly . We should add the consumer instance to the ` consumers ` collection immediately after construction . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7277 : Migrate Streams API to Duration instead of longMs times __EoT__ Public API changed according to [ KIP-358 ] ( https : //cwiki.apache.org/confluence/display/KAFKA/KIP-358 % 3A+Migrate+Streams+API+to+Duration+instead+of+long+ms+times ) # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Increase JMX tool start timeouts in tests __EoT__ In some tests , the check monitoring the JMX tool log output doesn ’ t quite wait long enough before failing . Increasing the timeout from 10 to 20 seconds . This should be easily merged back to the ` 0.10.2 ` branch . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR KAFKA-7406 : Follow up and address final comments __EoT__ Addressing final comments from KAFKA-7406 I used the existing tests for verification . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7429 : Enable key/truststore update with same filename/password __EoT__ Reload SSL trust stores and keystores on AlterConfigsRequest from the admin client if the file was modified , even if the file name and password have n't changed . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7456 : Serde Inheritance in DSL __EoT__ 1 . Add ` keySerde ` and ` valSerde ` in the ` AbstractStream ` , which are null-able . 2 . For all classes extending ` AbstractStream ` , including ` KStream/KTable/KGroupedStream/KGroupedTable/TimeWindowedKStream/SessionWindowedKStream ` -impl classes , try to pass the serdes specified from ` Materialized / Serialized / Joined ` to children nodes . Note here I 've only done the forward-inheritance , but not backward-inheritance , which is left for future works ( thinking about this , only ` Produced / Serialized ` serdes are worth passing backwards to parent nodes , so the scope of it may not be too large ) . 3 . Removed a bunch of unchecked annotations to strengthen the typing system . 4 . Found a couple of lurking bugs , fixed . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7428 : ConnectionStressSpec : add `` action '' , allow multiple clients __EoT__
MINOR : fix scala serde tests __EoT__ These two commits are mutually incompatible , but they were both tested before either was merged , so the first time they were tested together was in trunk . https : //github.com/apache/kafka/commit/9dac615d228c5b3464c6322aea9f9ce70f9ef37b https : //github.com/apache/kafka/commit/acd3858ea69e676a7840d998240deb32aee62dc0 This commit fixes the build . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Remove deprecated Metric.value ( ) method usage __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Missing throttle time in OffsetsForLeaderEpoch response __EoT__ With KIP-320 , the OffsetsForLeaderEpoch API is intended to be used by consumers to detect log truncation . Therefore the new response schema should expose a field for the throttle time like all the other APIs . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7347 ; Return not leader error OffsetsForLeaderEpoch requests to non-replicas __EoT__ The broker should return NOT_LEADER_FOR_PARTITION for OffsetsForLeaderEpoch requests against non-replicas instead of UNKNOWN_TOPIC_OR_PARTITION . This patch also fixes a minor bug in the handling of ListOffsets request using the DEBUG replica id . We should return UNKNOWN_TOPIC_OR_PARTITION if the topic does n't exist . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : replace deprecated remove with delete __EoT__ According to rocksDB commit history , it should be a pure renaming and no perf / correctness implications at all . But still good to remove deprecated API . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7316 Fix Streams Scala filter recursive call __EoT__ Due to lack of conversion to kstream Predicate , existing filter method in KTable.scala would result in StackOverflowError . This PR fixes the bug and adds testing for it .
MINOR : Fix transient test failure in DynamicConnectionQuotaTest __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
Minor : add valueChangingOperation and mergeNode to StreamsGraphNode # toString __EoT__ This PR adds valueChangingOperation and mergeNode to StreamsGraphNode # toString # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7164 : Follower should truncate after every leader epoch change __EoT__ Currently , we skip the steps to make a replica a follower if the leader does not change , inlcuding truncating the follower log if necessary . This can cause problems if the follower has missed one or more leader updates . Change the logic to only skip the steps if the new epoch is the same or one greater than the old epoch . Tested with unit tests that verify the behavior of Partition.scala and that show log truncation when the follower 's log is ahead of the leader 's , the follower has missed an epoch update , and the follower receives a LeaderAndIsrRequest making it a follower # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7261 : Fix request total metric to count requests instead of bytes __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6751 : Support dynamic configuration of max.connections.per.ip/max.connections.per.ip.overrides configs ( KIP-308 ) __EoT__ KIP-308 : https : //cwiki.apache.org/confluence/pages/viewpage.action ? pageId=85474993 # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Follow up for KAFKA-6761 graph should add stores for consistency __EoT__ While working on 4th PR , I noticed that I had missed adding stores via the graph vs. directly via the ` InternalStreamsBuilder ` . Probably ok to do so , but we should be consistent . For testing , I ran the existing tests in streams . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7247 : Update a link to Apache BookKeeper project __EoT__ The current URL is old and invalid . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7255 : Fix timing issue with create/update in SimpleAclAuthorizer __EoT__ ACL updates currently get ` ( currentAcls , currentVersion ) ` for the resource from ZK and do a conditional update using ` ( currentAcls+newAcl , currentVersion ) ` . This supports concurrent atomic updates if the resource path already exists in ZK . If the path does n't exist , we currently do a conditional createOrUpdate using ` ( newAcl , -1 ) ` . But ` -1 ` has a special meaning in ZooKeeper for update operations - it means match any version . So two brokers adding acls using ` ( newAcl1 , -1 ) ` and ` ( newAcl2 , -1 ) ` will result in one broker creating the path and setting ` newAcl1 ` , while the other broker can potentially update the path with ` ( newAcl2 , -1 ) ` , losing ` newAcl1 ` . The timing window is very small , but we have seen intermittent failures in ` SimpleAclAuthorizerTest.testHighConcurrencyModificationOfResourceAcls ` as a result of this window . This PR fixes the version used for conditional updates in ZooKeeper . It also replaces the confusing ` ZkVersion.NoVersion=-1 ` used for
MINOR : add spotlessScalaCheck to jenkins job __EoT__ This is related to https : //github.com/apache/kafka/pull/5472 # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7183 : Add a trogdor test that creates many connections to brokers __EoT__
MINOR : clean up node and store sensors __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Fixed default streams state dir location . __EoT__ Co-authored-by : Mickael Maison < mickael.maison @ gmail.com > Co-authored-by : Simon Clark < simonc6r @ gmail.com > # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7027 : Add overloaded build method to StreamsBuilder __EoT__ Implementation of [ KIP-312 ] ( https : //cwiki.apache.org/confluence/display/KAFKA/KIP-312 % 3A+Add+Overloaded+StreamsBuilder+Build+Method+to+Accept+java.util.Properties ) required for enabling the use of the optimization framework . This PR is required to allow for a 4th PR following on from https : //github.com/apache/kafka/pull/5201 to enable optimizations . The existing streams tests were used for testing . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7194 ; Fix buffer underflow if onJoinComplete is retried after failure __EoT__ An untimely wakeup can cause ` ConsumerCoordinator.onJoinComplete ` to throw a ` WakeupException ` before completion . On the next ` poll ( ) ` , it will be retried , but this leads to an underflow error because the buffer containing the assignment data will already have been advanced . The solution is to duplicate the buffer passed to ` onJoinComplete ` . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : fix upgrade docs for Streams __EoT__ This is a cherry-pick from # 5392 plus some more cleanup . Should be merged before 2.0 gets release . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Fix format violations in streams scala tests __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Upgrade rocksdb to 5.14.2 __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Upgrade RocksDB to 5.13.4 __EoT__ There are a few JNI improvements added recently in RocksDB , plus some bug fixes that may cause ` assertion error ` that we have seen transiently in Streams unit tests . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7112 : Only resume restoration if state is still PARTITIONS_ASSIGNED after poll __EoT__ Before KIP-266 , consumer.poll ( 0 ) would call ` updateAssignmentMetadataIfNeeded ( Long.MAX_VALUE ) ` , which makes sure that the rebalance is definitely completed , i.e . both onPartitionRevoked and onPartitionAssigned called within this ` poll ( 0 ) ` . After KIP-266 , however , it is possible that only onPartitionRevoked will be called if timeout is elapsed . And hence we need to double check that state is still ` PARTITIONS_ASSIGNED ` after the ` consumer.poll ( duration ) ` call . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Optimized the path compression in quick union __EoT__ Changes are following : 1 . Optimized the path compression logic in quick union Previously , the logic compressed the path one step up for a node at a time . Now , the new logic compresses the path to the root node at a time .
Add note about num.standby.replicas __EoT__
MINOR : report streams benchmarks separately __EoT__ Specify each benchmark as a separate test so that we can see the results reported independently . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Use exceptions in o.a.k.common if possible and deprecate ZkUtils __EoT__ Also : - Remove exceptions in ` kafka.common ` that are no longer used . - Keep ` kafka.common.KafkaException ` as it 's still used by ` ZkUtils ` , ` kafka.admin.AdminClient ` and ` kafka.security.auth ` classes and we would like to maintain compatibility for now . - Add deprecated annotation to ` kafka.admin.AdminClient ` . The scaladoc stated that the class is deprecated , but the annotation was missing . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Handle segment splitting edge cases and fix recovery bug __EoT__ This patch fixes the following issues in the log splitting logic added to address KAFKA-6264 : 1 . We were not handling the case when all messages in the segment overflowed the index . In this case , there is only one resulting segment following the split . 2 . There was an off-by-one error in the recovery logic when completing a swap operation which caused an unintended segment deletion . Additionally , this patch factors out of ` splitOverflowedSegment ` a method to write to a segment using from with an instance of ` FileRecords ` . This allows for future reuse and isolated testing . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7032 The TimeUnit is neglected by KakfaConsumer # close ( long , Tim… __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-7007 : All ACL changes should use single /kafka-acl-changes path __EoT__ Fix for [ KAFKA-7007 ] ( https : //issues.apache.org/jira/browse/KAFKA-7007 ) . The initial PR for KIP-290 # 5117 added a new path in ZK for ACL change events to come through for the new Prefixed resource pattern . @ Jun requested that this be reverted , and in its place we should use JSON values for the change events . This PR looks to make these changes . Where possible , I 've put code back to being the same as pre PR 5117. cc @ cmccabe , @ junrao *UPDATE* : After implementing the switch to JSON it was decided that this causes too many potential problems . Instead , the code now looks to encode a 3 part ACL change event , ( ` < resource-type > : < name-type > : < name > ` ) , where the old brokers used a 2 part event , ( ` < resource-type > : < name > ` ) . Older brokers will effectively ignore the new style events , without any errors or warnings . *UPDATE* : After more discussions a new hybrid approach is being
MINOR : Remove APIs deprecated in 0.11.0 for core and clients __EoT__ Not included : old consumers and checksum methods # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6704 : InvalidStateStoreException from IQ when StreamThread closes store __EoT__ While using an ` iterator ` from IQ , it 's possible to get an ` InvalidStateStoreException ` if the ` StreamThread ` closes the store during a range query . Added a unit test to ` SegmentIteratorTest ` for this condition . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Remove deprecated KafkaStreams constructors in docs __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KIP-255 : OAuth Authentication via SASL/OAUTHBEARER __EoT__ This KIP proposes to add the following functionality related to SASL/OAUTHBEARER : 1 ) Allow clients ( both brokers when SASL/OAUTHBEARER is the inter-broker protocol as well as non-broker clients ) to flexibly retrieve an access token from an OAuth 2 authorization server based on the declaration of a custom login CallbackHandler implementation and have that access token transparently and automatically transmitted to a broker for authentication . 2 ) Allow brokers to flexibly validate provided access tokens when a client establishes a connection based on the declaration of a custom SASL Server CallbackHandler implementation . 3 ) Provide implementations of the above retrieval and validation features based on an unsecured JSON Web Token that function out-of-the-box with minimal configuration required ( i.e . implementations of the two types of callback handlers mentioned above will be used by default with no need to explicitly declare them ) . 4 ) Allow clients ( both brokers when SASL/OAUTHBEARER is the inter-broker protocol as well as non-broker clients ) to transparently retrieve a new access token in the background before the existing access token expires in case the client has to open new connections .
KAFKA-6937 : In-sync replica delayed during fetch if replica throttle … __EoT__ …is exceeded * Added a unit test . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6849 : add transformValues methods to KTable . __EoT__ See the KIP : https : //cwiki.apache.org/confluence/display/KAFKA/KIP-292 % 3A+Add+transformValues % 28 % 29+method+to+KTable This PR adds the ` transformValues ` method to the ` KTable ` interface . The semantics of the call are the same as the methods of the same name on the ` KStream ` interface . Fixes KAFKA-6849
MINOR : A few small cleanups from KAFKA-6299 __EoT__ Use local fields in ` AdminClientRunnable ` to avoid the need to pass the collections as method parameters and fix warnings about invalid javadoc tags . Also use the ` internals ` package name for ` AdminMetadataManager ` for consistency with ` consumer.internals ` and ` producer.internals ` # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Remove deprecated parameter in ProcessorContext # register __EoT__ Updated the upgrade doc as well since we do not have an overloaded function without the deprecated parameter before . Also renamed the 1.2 release version to 2.0 . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6867 : corrected the typos in upgrade.html __EoT__ Ran tests , documentation change , so no expected behavioral changes .
KAFKA-6825 : Make StreamsConfig # DEFAULT_PRODUCTION_EXCEPTION_HANDLER_CLASS_CONFIG public __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6778 : AdminClient.describeConfigs ( ) should return error for non-existent topics __EoT__
MINOR : add window store range query in simple benchmark __EoT__ There are a couple minor additions in this PR : 1 ) add a new test for window store , to range query upon receiving each record . 2 ) in the non-windowed state store case , add a ` get ` call before the ` put ` call . 3 ) Enable caching by default to be consistent with other Join / Aggregate cases , where caching is enabled by default . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6765 : Handle exception while reading throttle metric value in test __EoT__ Quota tests wait for throttle metric to be updated without waiting for requests to complete to avoid waiting for potentially large throttle times . This requires the test to read metric values while a broker may be updating the value , resulting in exception in the test . Since this issue can also occur with JMX metrics reporter , change synchronization on metrics with sensors to use the sensor as lock . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
Kafka-6792 __EoT__ Wrong pointer in the link for stream dsl . actual is : http : //kafka.apache.org/11/documentation/streams/developer-guide # streams_dsl correct is : http : //kafka.apache.org/11/documentation/streams/developer-guide/dsl-api.html # streams-dsl
KAFKA-6514 : Add API version as a tag for the RequestsPerSec metric __EoT__ Updated ` RequestChannel ` to include ` version ` as a tag for all RequestsPerSec metrics . Updated tests to verify that the extra tag exists . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6592 : Follow-up __EoT__ Do not require ConsoleConsumer to specify inner serde as s special property , but just a normal property of the message formatter . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6790 __EoT__ The page here https : //kafka.apache.org/11/documentation/streams/developer-guide/memory-mgmt.html talks about processor nodes and refers to non existing links . Broken link ( appears twice in the same document ) : https : //kafka.apache.org/11/documentation/streams/concepts.html # streams-concepts-processor To find this search for the word `` processor node '' on the page memory-management , the ones which are links are broken .
MINOR : Add NullPayloadGenerator to Trogdor __EoT__
MINOR : Fix AdminClient.describeConfigs ( ) of listener configs __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : fix flaky TestUtils functions __EoT__ TestUtils # produceMessages should always close the KafkaProducer , even when there is an exception . Otherwise , the test will leak threads when there is an error . TestUtils # createNewProducer should create a producer with a requestTimeoutMs of 30 seconds by default , not around 10 seconds . This should avoid tests that flake when the load on Jenkins climbs . Fix two cases where a very short timeout of 2 seconds was getting set .
MINOR : Fix some compiler warnings __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6672 ; ConfigCommand should create config change parent path if needed __EoT__ Change ` KafkaZkClient.createConfigChangeNotification ` to ensure creation of the change directory . This fixes failing system tests which depend on setting SCRAM credentials prior to broker startup . Existing test case has been modified for new expected usage . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6640 ; Improve efficiency of KafkaAdminClient.describeTopics ( ) __EoT__ Currently in KafkaAdminClient.describeTopics ( ) , for each topic in the request , a complete map of cluster and errors will be constructed for every topic and partition . This unnecessarily increases the complexity of describeTopics ( ) to O ( n^2 ) . This patch improves the complexity to O ( n ) . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Correct `` exeption '' to `` exception '' __EoT__ one line change
KAFKA-3806 : Increase offsets retention default to 7 days ( KIP-186 ) __EoT__ # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6560 : Replace range query with newly added single point query in Windowed Aggregation __EoT__ * Add a new fetch ( K key , long window-start-timestamp ) API into ReadOnlyWindowStore . * Use the new API to replace the range fetch API in KStreamWindowedAggregate and KStreamWindowedReduce . * Added corresponding unit tests . * Also removed some redundant byte serdes in byte stores . Running some modified simple benchmark with a very limited resource machine on windowed count ( https : //github.com/apache/kafka/pull/4614 ) have the following result : Branch | MB / sec | Records / sec -- | -- | -- Trunk | 0.029 | 317.4 KAFKA-6560 | 5.84 | 63823.58 # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Fix typo in the impl source __EoT__ The static method ` KStreamImpl.createReparitionedSource ( ) ` is missing a ` t ` . This PR globally fixes the typo and keeps the code indentation consistent . I have not yet run the unit tests , because ` gradle ` looks like it is going to take upwards of an hour to download : sleeping : I did confirm that the misspelling ` Reparitioned ` does not occur anywhere else in the sources or tests . It seems that it would only break a dependent library if that library is using the implementation classes directly .
KAFKA-5327 : Console Consumer should only poll for up to max messages __EoT__ Add a check to ensure -- max-messages , if set , must be set no smaller than max.poll.records . *More detailed description of your change , if necessary . The PR title and PR message become the squashed commit message , so use a separate comment to ping reviewers . * *Summary of testing strategy ( including rationale ) for the feature or bug fix . Unit and/or integration tests are expected for any behaviour change and system tests should be considered for larger changes . * # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : follow up on Streams EOS system tests __EoT__
KAFKA-6430 : Add buffer between Java data stream and gzip stream __EoT__ *More detailed description of your change , if necessary . The PR title and PR message become the squashed commit message , so use a separate comment to ping reviewers . * *Summary of testing strategy ( including rationale ) for the feature or bug fix . Unit and/or integration tests are expected for any behaviour change and system tests should be considered for larger changes . * # # # Committer Checklist ( excluded from commit message ) - [ x ] Verify design and implementation - [ x ] Verify test coverage and CI build status - [ x ] Verify documentation ( including upgrade notes )
MINOR : Support dynamic JAAS config for broker 's LoginManager cache __EoT__ Fix LoginManager caching when ` sasl.jaas.config ` is defined for broker and add unit tests . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6476 : Documentation for dynamic broker configuration __EoT__ Docs for dynamic broker configuration ( KIP-226 ) . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : adding system tests for how streams functions with broker faiures __EoT__ System test for two cases 1 . Starting a multi-node streams application with the broker down initially , broker starts and confirm rebalance completes and streams application still able to process records . 2 . Multi-node streams app running , broker goes down , stop stream instance ( s ) confirm after broker comes back remaining streams instance ( s ) still function [ System Test Results Here ] ( http : //confluent-kafka-branch-builder-system-test-results.s3-us-west-2.amazonaws.com/2018-02-01 -- 001.1517522571 -- bbejeck -- MINOR_streams_system_tests_with_broker_failure -- e571620/report.html ) # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-4641 : Add more unit test for stream thread __EoT__ Before the patch , jacoco coverage test : Element | Missed Instructions | Cov . | Missed Branches | Cov . | Missed | Cxty | Missed | Lines | Missed | Methods | Missed | Classes -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- Total | 3,386 of 22,177 | 84 % | 336 of 1,639 | 79 % | 350 | 1,589 | 526 | 4,451 | 103 | 768 | 1 | 102 StreamThread | | 77 % | | 76 % | 27 | 102 | 48 | 299 | 1 | 31 | 0 | 1 After the patch : Element | Missed Instructions | Cov . | Missed Branches | Cov . | Missed | Cxty | Missed | Lines | Missed | Methods | Missed | Classes -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- Total | 3,329 of 22,180 | 84 % | 329 of 1,639 | 79
MINOR : Code refacotring in KTable-KTable Join __EoT__ 1 . Rename KTableKTableJoin to KTableKTableInnerJoin . Also removed ` abstract ` from other joins . 2 . Merge KTableKTableJoinValueGetter.java into KTableKTableInnerJoin . 3 . Use set instead of arrays in the stores function , to avoid duplicate stores to be connected to processors . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
Fix AK streams doc nits __EoT__ - Table formatting in /developer-guide/dsl-api - Missing /streams/developer-guide ` include virtual ` files - Improperly formatted Notes
MINOR : Optimize KTable-KTable join value getter supplier __EoT__
KAFKA-6244 : Dynamic update of log cleaner configuration __EoT__ Log cleaner config update as described in KIP-226 . Config updates are handled by stopping cleaner threads and starting new ones with the new config . This keeps the code simple and ensures that if any of the threads had terminated earlier due to an exception , new ones are created to match the configured thread count . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : Replace empty string concattenation with String.valueOf ( ) where possible . __EoT__ This is something I did after my working hours , I would ask people reviewing this do the same , do n't take time for this during your work hours . I try to keep such a PR as limited as possible , for clarity of reading . ========== Using an empty string concat in order to achieve the String representation of the value you want is bad for 2 reasons , as explained here : ( https : //stackoverflow.com/questions/1572708/is-conversion-to-string-using-int-value-bad-practice 1 . Readability : it shows what you 're trying to do . 2 . Depending on your compiler , it might attempt to create your String by first creating a StringBuffer , appending your value to it and then doing ` .toString ( ) ` on that . Which is inefficient . Also , the ` Metrics.java ` file had an empty string being added for the sole reason that the page width forced a string to continue on a new line . Removed that . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation -
doc typo __EoT__
KAFKA-5228 : Revisit Streams DSL JavaDocs __EoT__
MINOR : Fixed a few typos in configs and streams docs __EoT__ *More detailed description of your change , if necessary . The PR title and PR message become the squashed commit message , so use a separate comment to ping reviewers . * *Summary of testing strategy ( including rationale ) for the feature or bug fix . Unit and/or integration tests are expected for any behaviour change and system tests should be considered for larger changes . * # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
KAFKA-6467 : Enforce layout of dependencies within a connect plugin to be deterministic __EoT__ Adds alphanumeric ordering of dependencies as they added to a Connect plugin 's class loader path . This makes the layout of the dependencies consistent across systems and deployments . Dependencies should still , in principle , not include conflicts and ideally order should not matter . # # # Committer Checklist ( excluded from commit message ) - [ ] Verify design and implementation - [ ] Verify test coverage and CI build status - [ ] Verify documentation ( including upgrade notes )
MINOR : refactored code duplicates in several files ( Streams project ) __EoT__ This PR is a reworked and improved version of [ 3049 ] ( https : //github.com/apache/kafka/pull/3049 ) . PR offers following to Kafka Streams project : * refactored code duplication from **InternalTopologyBuilder** ( extracted common function ) * refactored code duplication from **GlobalProcessorContextImpl** and from **ProcessorContextImpl** to parent class **AbstractProcessorContext** ( moved into parent ) * exchanged concrete implementations with interfaces to make code more maintainable
KAFKA-1621 : Standardize -- messages option __EoT__ As per review comments from @ nehanarkhede Thanks .
[ WEEX-639 ] [ iOS ] fix input component can not limit words number correctly __EoT__ fix input component can not limit words number correctly . you can see demo here : http : //dotwe.org/vue/96be65e58e982a719d412f8888a0609b
* [ core ] rm repeat code __EoT__
* [ Android ] Fix image.resize problem __EoT__ Fix the problem that changing image.resize in JS does n't work http : //dotwe.org/vue/a49cd5f19d332e822ffa32c07ae96a71
[ WEEX-645 ] [ iOS ] videocomponent support hide controls __EoT__ videocomponent support hide controls you can try demo here : http : //rax.alibaba-inc.com/playground/3f449805-49d7-4b80-ae92-e8c34039e521
Fix instance double render __EoT__ First of all , thank you for your contribution ! Please makes sure that these checkboxes are checked before submitting your PR , thank you ! < ! -- How to use github markdown ? # # # checkable example - [ x ] checked - [ ] not checked More github Markdown info to see https : //guides.github.com/features/mastering-markdown/ -- > CheckList : **if** *isBugFix* ** : ** * [ ] Make sure that you add at least one unit test for the bug which you had fixed . **elif** *isNewFeature* ** : ** * [ ] Update API docs for the component . * [ ] Update/Add demo to demonstrate new feature . * [ ] Update test scripts for the feature . * [ ] Add unit tests for the feature . < ! -- （请在***提交***前删除这段描述） Notes : Weex will move into Apache Software Foundation ( ASF ) on Feb 24 2017 . Our new GitHub repo is https : //github.com/apache/incubator-weex After Feb 24 2017 , we only accept pull requests from https : //github.com/apache/incubator-weex Thank you for your support . -- -- 注意：Weex 将于 2017-02-24 迁移至 Apache 基金会 届时我们会使用新的 GitHub 仓库：https :
* [ android ] Support miniapp debug __EoT__
[ core ] fix list column zero __EoT__
merge libweexjss.so to appache __EoT__ First of all , thank you for your contribution ! Please makes sure that these checkboxes are checked before submitting your PR , thank you ! < ! -- How to use github markdown ? # # # checkable example - [ x ] checked - [ ] not checked More github Markdown info to see https : //guides.github.com/features/mastering-markdown/ -- > CheckList : **if** *isBugFix* ** : ** * [ ] Make sure that you add at least one unit test for the bug which you had fixed . **elif** *isNewFeature* ** : ** * [ ] Update API docs for the component . * [ ] Update/Add demo to demonstrate new feature . * [ ] Update test scripts for the feature . * [ ] Add unit tests for the feature . < ! -- （请在***提交***前删除这段描述） Notes : Weex will move into Apache Software Foundation ( ASF ) on Feb 24 2017 . Our new GitHub repo is https : //github.com/apache/incubator-weex After Feb 24 2017 , we only accept pull requests from https : //github.com/apache/incubator-weex Thank you for your support . -- -- 注意：Weex 将于 2017-02-24 迁移至 Apache 基金会 届时我们会使用新的 GitHub 仓库：https :
[ WEEX-628 ] [ Android ] add jsframework load adapter __EoT__ https : //issues.apache.org/jira/browse/WEEX-628 [ WEEX-628 ] [ Android ] add jsframework load adapter add jsframework load adapter Bug : WEEX-628
[ iOS ] Remove object from ref map after delete . __EoT__ First of all , thank you for your contribution ! Please makes sure that these checkboxes are checked before submitting your PR , thank you ! < ! -- How to use github markdown ? # # # checkable example - [ x ] checked - [ ] not checked More github Markdown info to see https : //guides.github.com/features/mastering-markdown/ -- > CheckList : **if** *isBugFix* ** : ** * [ ] Make sure that you add at least one unit test for the bug which you had fixed . **elif** *isNewFeature* ** : ** * [ ] Update API docs for the component . * [ ] Update/Add demo to demonstrate new feature . * [ ] Update test scripts for the feature . * [ ] Add unit tests for the feature . < ! -- （请在***提交***前删除这段描述） Notes : Weex will move into Apache Software Foundation ( ASF ) on Feb 24 2017 . Our new GitHub repo is https : //github.com/apache/incubator-weex After Feb 24 2017 , we only accept pull requests from https : //github.com/apache/incubator-weex Thank you for your support . -- -- 注意：Weex 将于 2017-02-24
* [ android ] Add deviation to meta __EoT__
[ WEEX-620 ] [ iOS ] pageName check and render_error report modify __EoT__ - before render , check pagename is nil or `` '' , if yes , set pagename order url - > vcname - > `` unKnowSet '' - revert interaction code ( revert ignore countDown top10 view )
default multiProgress , if failed in multiProgress turn to singleProgr… __EoT__ https : //issues.apache.org/jira/browse/WEEX-617 [ WEEX-617 ] [ Android ] set multi progress as default default multiProgress , if failed in multiProgress turn to singleProgress according to the switch Bug : WEEX-617
* [ Android ] Stop sync if exception occurs __EoT__ * [ Android ] Stop sync if exception occurs ( cherry picked from commit 139c0bd )
[ WEEX-614 ] [ Android ] apm monitor logic fix __EoT__ * [ Android ] ignore the count down 10 view for interaction time calculate * [ Android ] modify imageSize logic * [ Android ] fix origin fsRender time , and newFsRenderTime
[ WEEX-611 ] [ Android ] Fix java.lang.ArrayIndexOutOfBoundsException __EoT__ [ WEEX-611 ] [ Android ] Fix java.lang.ArrayIndexOutOfBoundsException arrayList is not thread safe , if arraylist add item in multithread may produce ArrayIndexOutOfBoundsException Bug : WEEX-611
refector code , Make jsengine can run on multi thread environment __EoT__ [ WEEX-610 ] [ Android ] WeexCore refactoring refector code , Make jsengine can run on multi thread environment Bug : WEEX-610 https : //issues.apache.org/jira/browse/WEEX-610
[ WEEX-586 ] [ Android ] add synchronized for recycle list template layout __EoT__ [ WEEX-586 ] [ Android ] add synchronized for recycle list template layout
More accurately name call adapter list field . __EoT__
Do n't catch fatal errors . __EoT__
Why ErrorHandler is only for synchronous call ? __EoT__ I am using Retrofit with : - synchronous calls , - Observable < ... > calls My application needs to check and raise events for 401 and some specific custom 4XX responses ( Like if the client version is not supported anymore ) . For the synchronous calls , I wrote the following custom ` ErrorHandler ` `` ` java @ Override public Throwable handleError ( RetrofitError cause ) { Response r = cause.getResponse ( ) ; if ( r ! = null & & r.getStatus ( ) > = 400 & & r.getStatus ( ) < = 500 ) { ApiError apiError = null ; try { apiError = ApiUtils.getApiError ( gson , r ) ; } catch ( ConversionException e ) { Timber.e ( e , `` Unable to parse ApiError '' ) ; } ApiClientException apiClientException = new ApiClientException ( cause , r.getStatus ( ) , apiError ) ; if ( apiClientException.isKilled ) { onUnAuthorized.onNext ( new UnauthorizedEvent ( true ) ) ; } else if ( r.getStatus ( ) == 401 ) { onUnAuthorized.onNext ( new UnauthorizedEvent ( false ) ) ; } return apiClientException ; }
Hide non public resources __EoT__ https : //plus.google.com/+ChrisBanes/posts/8Rip6rQGK32
ClipboardUIManager memory leak on Samsung __EoT__ Samsung Galaxy Note 3 . Ca n't avoid next leak : `` ` * .MainActivity $ CardFragment has leaked : * GC ROOT android.view.Choreographer $ FrameDisplayEventReceiver.mMessageQueue * references android.os.MessageQueue.mMessages * references android.os.Message.callback * references android.widget.Editor $ Blink.this $ 0 * references android.widget.Editor.mTextView * references android.support.v7.widget.AppCompatEditText.mClipboardExManager * references android.sec.clipboard.ClipboardExManager.mClipboardUIManager * references android.sec.clipboard.ClipboardUIManager.mContext * references .MainActivity.mFragments * references android.app.FragmentManagerImpl.mAdded * references java.util.ArrayList.array * references array java.lang.Object [ ] . [ 0 ] * leaks .MainActivity $ CardFragment instance [ 05-19 16:06:47.798 22049:24915 D/LeakCanary ] * Reference Key : b6225f48-2840-4d34-a7db-3819d8f77dbf * Device : samsung samsung SM-N900 ha3gxx * Android Version : 5.0 API : 21 LeakCanary : 1.3.1 * Durations : watch=5449ms , gc=167ms , heap dump=7515ms , analysis=47645ms [ 05-19 16:06:47.798 22049:24915 D/LeakCanary ] * Details : * Instance of android.view.Choreographer $ FrameDisplayEventReceiver | this $ 0 = android.view.Choreographer [ id=0x12dc7780 ] | mFrame = 1511856 | mTimestampNanos = 280338446797948 | mHavePendingVsync = false | mCloseGuard = dalvik.system.CloseGuard [ id=0x7302e730 ] | mMessageQueue = android.os.MessageQueue [ id=0x12cb0370 ] | mReceiverPtr = -1361116128 * Instance of android.os.MessageQueue | mIdleHandlers = java.util.ArrayList [ id=0x12cb13c0 ] | mMessages = android.os.Message [ id=0x12cbe140 ] | mPendingIdleHandlers = android.os.MessageQueue $ IdleHandler
Recover from executor shutdowns gracefully . __EoT__ This turns out to be pretty difficult because of the way our dispatcher works . Calls can be rejected either immediately when the user calls enqueue ( ) , or later when a queued call is promoted . It 's also awkward because we do n't want to hold locks when calling the user 's callFailed ( ) method .
Add maven bom __EoT__ See gh-4329
Support header redaction in HttpLoggingInterceptor __EoT__ This implements the enhancement discussed in https : //github.com/square/okhttp/issues/3826 .
Nullable route annotation __EoT__ Related to https : //github.com/square/okhttp/issues/4238 Currently ( by code structure ) route may be null when used internally . In addition as an API for handling authentication challenges , it makes sense that route may not be always available , even though it can be useful when determining when to apply a authentication method .
Test for local port used in mock web server __EoT__
TLSv1.3 with JDK 11 __EoT__ https : //tools.ietf.org/html/draft-ietf-tls-tls13-28 Output : `` ` h2 TLS_AES_128_GCM_SHA256 TLS_1_3 < html xmlns= '' http : //www.w3.org/1999/xhtml '' > < head > < title > Test < /title > < /head > < body > < h1 > Test < /h1 > < p > Testing < /p > < /body > < /html > `` `
Rename TlsNode to HandshakeCertificates __EoT__
Do n't pass a null route to the authenticator . __EoT__ Closes : https : //github.com/square/okhttp/issues/3809
Improve progress example __EoT__
Do n't summarize the request and response headers . __EoT__ Just pass the Request and Response objects in directly .
Improve handling of HEAD requests with a Content-Length specified . __EoT__ Rather than getting the content length from a header on demand , this gets it at the time that the RealResponseBody is created . This means that HEAD requests can have a non-zero Content-Length header while their bodies have no content . Closes : https : //github.com/square/okhttp/issues/3365
Do n't call EventListener methods while holding locks . __EoT__
Include and implement connection found event . __EoT__
Website only : Update first example to use try with resources __EoT__ This changes the first example on the website from using try/finally to using try with resources . This fixes 2 issues with my previous PR for the first website example . - The actual linked GetExample.java uses try with resources ( not try finally so my change did n't match the linked GetExample.java ) - My try/finally example had issues . It did n't initialise the Response properly and close if non-null etc Apologies for getting this wrong in the first PR . I think this fixes those 2 issues in my previous PR and I think it is nice if the first example code seen is as simple and clean ( and correct ) as possible ( I think try with resources is a bit cleaner/nicer than try/finally ) .
update http2 to draft 9 and hpack to draft 5 __EoT__ This also includes testing via OkHttp and MWS via ` HttpOverHttp20Draft09Test ` there are TODO 's for followup including huffman encoding for hpack .
API 24 __EoT__ > Seems like the timetable for v24 would be when N is released , which might be months away still - A pessimistic fool . Tested with Travis and worked fine as well ( ! ! ) : https : //github.com/hzsweers/picasso/pull/1 Also resolves # 903
OutOfMemoryError with ViewPager __EoT__ I noticed in an application I 'm currently working on that your library together with a ViewPager gives an OutOfMemoryError when you rotate the screen several times and doing some swipes in between . When examing logcat , I noticed the heap allocation slowly increasing every time I rotated . Setting android : configchanges in the manifest to `` orientation|screensize '' seems to fix the problem , but I thought I would share my findings anyway . To isolate the issue , I made a small test project : https : //github.com/AlexKolpa/PicassoTest . Hopefully that helps .
